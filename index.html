<!DOCTYPE html>
<html lang="en">
<head>
<script>
if (typeof window.showSection !== 'function') {
  window.showSection = function(sectionName){
    try {
      const sections = document.querySelectorAll('.section');
      sections.forEach(s=> { if (s) s.style.display='none'; });
      const target = document.getElementById(sectionName + 'Section');
      if (target) target.style.display = 'block';
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(t => t.classList.remove('active'));
      const activeTab = document.getElementById(sectionName + 'Tab');
      if (activeTab) activeTab.classList.add('active');
    } catch(e) { console.warn('fallback showSection error', e); }
  };
}
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: wss: data: blob:; connect-src 'self' https: wss: *.firebasedatabase.app *.googleapis.com *.gstatic.com; frame-src 'self' https: *.firebasedatabase.app *.googleapis.com *.gstatic.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: *.gstatic.com *.googleapis.com *.firebasedatabase.app; style-src 'self' 'unsafe-inline' https:;">
    <title>Dragon Coin - Tap to Earn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        import { getDatabase, ref, set, get, onValue, push, update } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDShZAo9lg-SxpQViCT27uXVni1UK7TGYU",
            authDomain: "dragon-92897.firebaseapp.com",
            databaseURL: "https://dragon-92897-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dragon-92897",
            storageBucket: "dragon-92897.firebasestorage.app",
            messagingSenderId: "40351345340",
            appId: "1:40351345340:web:632388a9b45d3c7905feb9",
            measurementId: "G-FXT1F3NPCD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
        window.firebasePush = push;
        window.firebaseUpdate = update;
    </script>
<script>
(function(){
  // 1) Tekshir: Firebase initsiyalizatsiyasi mavjudmi?
  if (!window.firebaseDatabase || !window.firebaseRef || !window.firebaseSet || !window.firebaseGet || !window.firebaseOnValue) {
    console.error('Firebase SDK topilmadi yoki toʻliq initsiyalash amalga oshmagan. Iltimos modul import scriptini sahifada tekshiring.');
    return;
  }

  // 2) PlayerId olish / yaratish
  let playerId = localStorage.getItem('dragonPlayerId');
  if (!playerId) {
    playerId = 'p_' + Math.random().toString(36).slice(2, 10);
    localStorage.setItem('dragonPlayerId', playerId);
    console.log('Yangi playerId yaratildi:', playerId);
  } else {
    console.log('playerId:', playerId);
  }
  window.playerId = playerId;

  // 3) Global state
  window.coins = Number(localStorage.getItem('dragonCoins') || 0);
  window.tapPower = Number(localStorage.getItem('dragonTapPower') || 1);

  // UI update helper
  function updateUI() {
    const bal = document.getElementById('balance');
    if (bal) bal.textContent = (window.coins || 0);
    const tp = document.getElementById('tapPower');
    if (tp) tp.textContent = (window.tapPower || 1);
  }
  window.updateUI = updateUI;
  updateUI();

  // 4) Realtime DB refs
  const playerRef = window.firebaseRef(window.firebaseDatabase, 'players/' + playerId);

  // 5) Inicial lokal -> server sinkronizatsiya
  window.firebaseGet(playerRef)
    .then(snapshot => {
       if (!snapshot.exists()) {
         // serverda yo'q — saqlaymiz
         const initial = { coins: window.coins || 0, tapPower: window.tapPower || 1, created: Date.now(), lastUpdate: Date.now() };
         return window.firebaseSet(playerRef, initial).then(()=> {
           console.log('Serverda yangi player yaratiladi:', initial);
         });
       } else {
         // serverda bor — localni yangilaymiz
         const data = snapshot.val();
         if (typeof data.coins === 'number') { window.coins = data.coins; localStorage.setItem('dragonCoins', window.coins); }
         if (typeof data.tapPower === 'number') { window.tapPower = data.tapPower; localStorage.setItem('dragonTapPower', window.tapPower); }
         updateUI();
         console.log('Serverdan player yuklandi:', data);
       }
    })
    .catch(err => {
       console.error('Firebase get() xato:', err);
    });

  // 6) Serverdagi o'zgarishlarni tinglash — boshqa qurilmalardan ham sync bo'ladi
  try {
    window.firebaseOnValue(playerRef, snapshot => {
      const data = snapshot.val();
      if (!data) return;
      // agar serverdagi qiymat farq qilsa, localni yangilash
      if (typeof data.coins === 'number' && data.coins !== window.coins) {
        window.coins = data.coins;
        localStorage.setItem('dragonCoins', window.coins);
        updateUI();
      }
      if (typeof data.tapPower === 'number' && data.tapPower !== window.tapPower) {
        window.tapPower = data.tapPower;
        localStorage.setItem('dragonTapPower', window.tapPower);
        updateUI();
      }
    });
  } catch (e) { console.warn('firebaseOnValue attach muammosi:', e); }

  // 7) tapCoin funksiyasi — coin qo'shadi va Firebase-ga yozadi
  window.tapCoin = function(event) {
    try {
      const add = Number(window.tapPower || 1);
      window.coins = (Number(window.coins) || 0) + add;
      localStorage.setItem('dragonCoins', window.coins);
      updateUI();

      // write to firebase (non-blocking)
      window.firebaseSet(playerRef, { coins: window.coins, tapPower: window.tapPower, lastUpdate: Date.now() })
        .then(()=> {
          // ok
        })
        .catch(err => {
          console.error('Firebasega coins yozishda xato:', err);
        });
    } catch (err) {
      console.error('tapCoin error', err);
    }
    // prevent default if event exists (for touch)
    if (event && typeof event.preventDefault === 'function') event.preventDefault();
  };

  // 8) Qo'shimcha: saveGlobalTaskSettings() promiseful formatga o'tkazish uchun yordamchi
  window.saveGlobalTaskSettings = function() {
    if (!window.firebaseDatabase || !window.firebaseRef || !window.firebaseSet) {
      console.warn('Firebase mavjud emas — global sozlamalar saqlanmadi.');
      return Promise.reject(new Error('no firebase'));
    }
    try {
      const standardTaskIds = ['taps','level','level3','level7','level10','coins','referral','referral1','referral3','referral10','telegram','youtube','code'];
      const hiddenTasks = [];
      const deletedTasks = [];
      standardTaskIds.forEach(taskId => {
        if (localStorage.getItem('hiddenTask_' + taskId) === 'true') hiddenTasks.push(taskId);
        if (localStorage.getItem('deletedTask_' + taskId) === 'true') deletedTasks.push(taskId);
      });

      const taskSettingsRef = window.firebaseRef(window.firebaseDatabase, 'globalTaskSettings');
      const customTasksRef = window.firebaseRef(window.firebaseDatabase, 'globalCustomTasks');

      // return a Promise that resolves when both saves are done
      const p1 = window.firebaseSet(taskSettingsRef, { hiddenTasks: hiddenTasks, deletedTasks: deletedTasks, lastUpdate: Date.now() });
      const customTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
      const p2 = window.firebaseSet(customTasksRef, { tasks: customTasks, lastUpdate: Date.now() });

      return Promise.all([p1, p2]).then(() => {
        console.log('Global sozlamalar Firebase ga yuborildi.');
      }).catch(err => {
        console.error('Global sozlamalar saqlash xatosi:', err);
        throw err;
      });
    } catch (err) {
      return Promise.reject(err);
    }
  };

  // 9) Qisqa diagnostika funksiyasi
  window.checkFirebaseConnection = function() {
    if (!window.firebaseDatabase) {
      console.error('Firebase Database mavjud emas.');
      return false;
    }
    // oddiy ping: get root (quyidagi sizga read ruxsatlari kerak bo'ladi)
    const rootRef = window.firebaseRef(window.firebaseDatabase, '/');
    return window.firebaseGet(rootRef)
      .then(() => { console.log('Firebase bilan bogʻlanildi.'); return true; })
      .catch(err => { console.error('Firebase bilan bogʻlanishda xato:', err); return false; });
  };

  console.log('Firebase helper script yuklandi. PlayerId:', playerId);

})();
</script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a0a1a 25%, #0f0a1a 50%, #1a1a0f 75%, #0a0f1a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 98px,
                    rgba(0, 255, 136, 0.03) 100px
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 98px,
                    rgba(255, 107, 53, 0.03) 100px
                );
            pointer-events: none;
            z-index: -1;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        .firebase-status {
            position: fixed;
            top: 70px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            transition: all 0.5s ease;
            opacity: 1;
        }

        .firebase-connected {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .firebase-disconnected {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
            border: 1px solid #ff6b35;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .level-badge {
            background: #00ff88;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .energy-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .energy-fill {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .energy-progress {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .main-container {
            padding: 20px;
            text-align: center;
        }

        .navigation-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000000;
            border-color: #00ff88;
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .balance-display {
            margin-bottom: 30px;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
            text-shadow: 
                0 0 10px #00ff88,
                0 0 20px #00ff88,
                0 0 30px #00ff88,
                0 0 40px #00ff88;
            animation: balanceGlow 3s ease-in-out infinite alternate;
        }

        @keyframes balanceGlow {
            0% {
                text-shadow: 
                    0 0 10px #00ff88,
                    0 0 20px #00ff88,
                    0 0 30px #00ff88,
                    0 0 40px #00ff88;
            }
            100% {
                text-shadow: 
                    0 0 15px #00ff88,
                    0 0 30px #00ff88,
                    0 0 45px #00ff88,
                    0 0 60px #00ff88;
            }
        }

        .balance-label {
            color: #cccccc;
            font-size: 16px;
        }

        .coin-container {
            position: relative;
            margin: 40px auto;
            width: 280px;
            height: 280px;
            perspective: 1000px;
        }

        .main-coin {
            width: 280px;
            height: 280px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 25%, #FFD700 50%, #FFED4E 75%, #FFD700 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            cursor: pointer;
            transition: transform 0.05s ease;
            position: relative;
            overflow: hidden;
            border: 8px solid #FFA500;
            box-shadow: 
                0 20px 40px rgba(255, 165, 0, 0.4),
                0 10px 20px rgba(0, 0, 0, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.3),
                inset 0 -4px 8px rgba(255, 140, 0, 0.3);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            will-change: transform;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .main-coin::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 15%;
            width: 30%;
            height: 30%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
        }

        .main-coin:hover {
            transform: scale(1.02);
        }

        .main-coin:active {
            transform: scale(0.96) !important;
        }
        
        .main-coin.tap-animation {
            transform: scale(0.94);
            transition: transform 0.03s ease-out;
        }

        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            .main-coin {
                transition: transform 0.03s ease-out;
            }
            
            .main-coin:active {
                transform: scale(0.95) !important;
            }
            
            .main-coin.tap-animation {
                transform: scale(0.93);
                transition: transform 0.02s ease-out;
            }
        }

        .tap-effect {
            position: absolute;
            color: #00ff88;
            font-size: 28px;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 
                0 0 15px #00ff88,
                0 0 30px #00ff88,
                0 0 45px #00ff88,
                0 0 60px #00ff88;
            animation: neonFloatUp 1s ease-out forwards;
            z-index: 10;
            user-select: none;
            -webkit-user-select: none;
        }

        @keyframes neonFloatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(0.8);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(0, 255, 136, 0.6);
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }

        .stat-label {
            font-size: 12px;
            color: #cccccc;
            margin-top: 5px;
        }

        .conditions-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .condition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .condition-item:last-child {
            border-bottom: none;
        }

        .condition-item[style*="cursor: pointer"]:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .task-button {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .task-button.completed {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            cursor: default;
        }

        .task-button.completed:hover {
            transform: none;
            box-shadow: none;
        }

        .task-button.task-ready {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            animation: taskPulse 2s ease-in-out infinite;
        }

        @keyframes taskPulse {
            0% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
            100% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
        }

        .condition-text {
            flex: 1;
        }

        .condition-reward {
            color: #00ff88;
            font-weight: bold;
        }

        .condition-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .condition-completed {
            background: #00ff88;
        }

        .condition-pending {
            background: rgba(255, 255, 255, 0.3);
        }

        .completed-tasks-section {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .completed-task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .completed-task-item:last-child {
            margin-bottom: 0;
        }

        .completed-task-text {
            flex: 1;
            color: #00ff88;
        }

        .completed-task-reward {
            color: #00ff88;
            font-weight: bold;
            background: rgba(0, 255, 136, 0.2);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .completed-task-check {
            color: #00ff88;
            font-size: 18px;
            margin-left: 10px;
        }

        .section {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }

        .notification.error {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid #ff6b35;
            color: #ff6b35;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-selector:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .country-flag {
            font-size: 20px;
            margin-right: 8px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .main-container {
                padding: 15px;
            }

            .main-coin {
                width: 220px;
                height: 220px;
                font-size: 90px;
            }
            
            .coin-container {
                width: 220px;
                height: 220px;
                margin: 30px auto;
            }
            
            .balance-amount {
                font-size: 32px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 20px 0;
            }

            .navigation-tabs {
                gap: 4px;
                margin-bottom: 15px;
            }

            .nav-tab {
                padding: 8px 10px;
                font-size: 11px;
                flex: 1;
                min-width: 0;
            }
        }
    </style>
</head>
<body>

    <!-- Firebase Status Indicator -->
    <div class="firebase-status firebase-disconnected" id="firebaseStatus">
        🔄 Firebase ulanmoqda...
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <span class="country-flag" id="countryFlag">🇺🇿</span>
        <span id="languageText">UZ</span>
    </div>

    <div class="header">
        <div class="user-info">
            <div class="avatar">🐉</div>
            <div>
                <div style="font-weight: bold;" id="playerName">Dragon Miner</div>
                <div class="level-badge" id="levelBadge">Level 1</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="energy-bar">
                <span>⚡</span>
                <div class="energy-fill">
                    <div class="energy-progress" id="energyProgress"></div>
                </div>
                <span id="energyText">1000/1000</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="navigation-tabs">
            <button class="nav-tab active" id="tapTab">🐉 <span data-translate="tap">Tapping</span></button>
            <button class="nav-tab" id="tasksTab">📋 <span data-translate="tasks">Vazifalar</span></button>
            <button class="nav-tab" id="referralTab">👥 <span data-translate="referral">Referral</span></button>
            <button class="nav-tab" id="leaderboardTab">🏆 <span data-translate="leaderboard">Reyting</span></button>
            <button class="nav-tab" id="boostTab">⚡ <span data-translate="boost">Boostlar</span></button>
            <button class="nav-tab" id="adminTab" style="display: none;">⚙️ <span data-translate="admin">Admin</span></button>
            <button class="nav-tab" id="profileTab">👤 <span data-translate="profile">Profil</span></button>
        </div>

        <div class="balance-display">
            <div class="balance-amount" id="balance">0</div>
            <div class="balance-label">Dragon Coins</div>
        </div>

        <div class="section" id="tapSection">
            <div class="coin-container">
                <div class="main-coin" id="mainCoin">
                    <span style="
                        font-size: 120px; 
                        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                        z-index: 2;
                        position: relative;
                        pointer-events: none;
                    ">🐉</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="tapPower">1</div>
                    <div class="stat-label" data-translate="coinsPerTap">Coins per tap</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTaps">0</div>
                    <div class="stat-label" data-translate="totalTaps">Total taps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label" data-translate="level">Level</div>
                    <div class="stat-label" id="levelName" style="color: #00ff88; font-size: 10px; margin-top: 2px;">Wood</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="referralCount">0</div>
                    <div class="stat-label" data-translate="referrals">Referrals</div>
                </div>
            </div>

            <!-- Level Progress Bar -->
            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="font-size: 16px; font-weight: bold;" id="currentLevelDisplay">Level 1 - Wood</div>
                    <div style="font-size: 14px; color: #ccc;" id="nextLevelDisplay">Next: Level 2 - Bronze</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgressBar" style="width: 0%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-top: 5px;">
                    <span id="currentTapsDisplay">0 taps</span>
                    <span id="requiredTapsDisplay">500 taps kerak</span>
                </div>
            </div>

            <div id="energyWarning" class="notification error" style="display: none; position: relative; top: auto; right: auto; margin: 20px 0;">
                <span data-translate="energyWarning">⚠️ Energy bo'sh! Energiya to'lishi uchun kutib turing.</span>
            </div>
        </div>

        <div class="section" id="tasksSection" style="display: none;">
            <!-- Task Categories Navigation -->
            <div style="display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap;">
                <button class="nav-tab active" id="basicTasksTab" style="padding: 8px 12px; font-size: 12px;">
                    📋 <span data-translate="basicTasks">Asosiy Vazifalar</span>
                </button>
                <button class="nav-tab" id="levelTasksTab" style="padding: 8px 12px; font-size: 12px;">
                    🏆 <span data-translate="levelTasks">Level Vazifalari</span>
                </button>
                <button class="nav-tab" id="referralTasksTab" style="padding: 8px 12px; font-size: 12px;">
                    👥 <span data-translate="referralTasks">Referral Vazifalari</span>
                </button>
                <button class="nav-tab" id="customTasksTab" style="padding: 8px 12px; font-size: 12px;">
                    ⭐ <span data-translate="customTasks">Maxsus Vazifalar</span>
                </button>
                <button class="nav-tab" id="completedTasksTab" style="padding: 8px 12px; font-size: 12px;">
                    ✅ <span data-translate="completedTasks">Bajarilgan</span>
                    <span style="background: rgba(0, 255, 136, 0.3); color: #00ff88; padding: 2px 6px; border-radius: 8px; font-size: 10px; margin-left: 4px;" id="completedTasksTabCount">0</span>
                </button>
            </div>

            <!-- Basic Tasks Panel -->
            <div class="conditions-panel" id="basicTasksPanel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">📋 <span data-translate="basicTasks">Asosiy Vazifalar</span></h3>
                <div id="basicTasksList">
                    <!-- Basic tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Level Tasks Panel -->
            <div class="conditions-panel" id="levelTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #FFD700;">🏆 <span data-translate="levelTasks">Level Vazifalari</span></h3>
                <div id="levelTasksList">
                    <!-- Level tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Referral Tasks Panel -->
            <div class="conditions-panel" id="referralTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #8A2BE2;">👥 <span data-translate="referralTasks">Referral Vazifalari</span></h3>
                <div id="referralTasksList">
                    <!-- Referral tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Custom Tasks Panel -->
            <div class="conditions-panel" id="customTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #00ff88;">⭐ <span data-translate="customTasks">Maxsus Vazifalar</span></h3>
                <div id="customTasksList">
                    <!-- Custom tasks will be populated here -->
                </div>
            </div>

            <!-- Completed Tasks Panel -->
            <div class="conditions-panel" id="completedTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #00ff88; display: flex; align-items: center; gap: 10px;">
                    ✅ <span data-translate="completedTasks">Bajarilgan Vazifalar</span>
                    <span style="background: rgba(0, 255, 136, 0.2); color: #00ff88; padding: 4px 8px; border-radius: 12px; font-size: 12px;" id="completedTasksCount">0</span>
                </h3>
                <div id="completedTasksList">
                    <!-- Completed tasks will be populated here -->
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div class="section" id="referralSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">👥 <span data-translate="referralSystem">Referral Tizimi</span></h3>
                
                <div style="margin-bottom: 20px;">
                    <h4 data-translate="yourReferralLink">Sizning referral linkingiz:</h4>
                    <div style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; border-radius: 10px; padding: 15px; margin: 15px 0; word-break: break-all; font-family: monospace; font-size: 14px;" id="referralLink">
                        https://t.me/Dragon_coin_money_bot?start=ref_<span id="userReferralCode">123456</span>
                    </div>
                    <button style="background: #00ff88; color: #000; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px 0; transition: all 0.3s ease;">
                        📋 <span data-translate="copyLink">Linkni nusxalash</span>
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label" data-translate="totalReferrals">Jami referrallar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="referralEarnings">0</div>
                        <div class="stat-label" data-translate="referralEarnings">Referral daromadi</div>
                    </div>
                </div>

                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 10px; padding: 15px; margin: 20px 0;">
                    <h4 data-translate="referralRewards">Referral mukofotlari:</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li data-translate="reward1">Har bir referral uchun: +500 DRC</li>
                        <li data-translate="reward2">Referral birinchi marta tap qilganda: +200 DRC</li>
                        <li data-translate="reward3">Referral Level 5 ga yetganda: +1000 DRC</li>
                        <li data-translate="reward4">Referral 10000 coin to'plaganda: +2000 DRC</li>
                    </ul>
                </div>

                <h4 data-translate="yourReferrals">Sizning referrallaringiz:</h4>
                <div id="referralList">
                    <div style="text-align: center; color: #ccc; padding: 20px;" data-translate="noReferrals">
                        Hali referrallaringiz yo'q. Do'stlaringizni taklif qiling!
                    </div>
                </div>
            </div>
        </div>

        <!-- Boost Section -->
        <div class="section" id="boostSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">⚡ <span data-translate="boost">Boostlar</span></h3>
                
                <!-- Current Stats -->
                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="currentTapPower">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="tapPower">Tap Power</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="currentMaxEnergy">1000</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="maxEnergy">Max Energy</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="currentMultitap">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="multitap">Multitap</div>
                        </div>
                    </div>
                </div>

                <!-- Tap Power Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">👆 <span data-translate="tapPowerBoosts">Tap Power</span></h4>
                    
                    <div class="condition-item task-button" id="tapPowerBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Energy Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #ff6b35; margin-bottom: 15px;">🔋 <span data-translate="energyBoosts">Energy Limit</span></h4>
                    
                    <div class="condition-item task-button" id="energyBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Multitap Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">👆 <span data-translate="multitapBoosts">Multitap</span></h4>
                    
                    <div class="condition-item task-button" id="multitapBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Energy Recharge Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">⚡ <span data-translate="rechargeBoosts">Energy Recharging Speed</span></h4>
                    
                    <div class="condition-item task-button" id="rechargeBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Special Boosts -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">🌟 <span data-translate="specialBoosts">Special Boosts</span></h4>
                    
                    <div class="condition-item task-button" id="energyRefillBoost">
                        <div class="condition-text">
                            <div style="font-weight: bold;">⚡ Full Energy</div>
                            <div style="font-size: 12px; color: #ccc;">Instantly refill energy</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="condition-reward">500 DRC</div>
                            <div class="condition-status condition-pending" id="energyRefillStatus"></div>
                        </div>
                    </div>

                    <div class="condition-item task-button" id="turboBoost">
                        <div class="condition-text">
                            <div style="font-weight: bold;">🚀 Turbo (20 seconds)</div>
                            <div style="font-size: 12px; color: #ccc;">Unlimited energy for 20 seconds</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="condition-reward">2,500 DRC</div>
                            <div class="condition-status condition-pending" id="turboStatus"></div>
                        </div>
                    </div>
                </div>

                <!-- Active Boosts -->
                <div id="activeBoostsSection" style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0; display: none;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">🔥 <span data-translate="activeBoosts">Active Boosts</span></h4>
                    <div id="activeBoostsList">
                        <!-- Active boosts will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="section" id="leaderboardSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">🏆 <span data-translate="leaderboard">Reyting Jadvali</span></h3>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                    <button class="nav-tab active" id="coinsLeaderboard" style="padding: 8px 16px;">
                        💰 <span data-translate="byCoins">Coinlar bo'yicha</span>
                    </button>
                    <button class="nav-tab" id="referralsLeaderboard" style="padding: 8px 16px;">
                        👥 <span data-translate="byReferrals">Referrallar bo'yicha</span>
                    </button>
                </div>

                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 18px; font-weight: bold; color: #00ff88;" data-translate="yourRank">Sizning o'rningiz:</div>
                    <div style="font-size: 24px; font-weight: bold; margin-top: 5px;" id="playerRank">#-</div>
                </div>

                <div id="leaderboardList">
                    <!-- Leaderboard items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Player Profile Modal -->
        <div id="playerProfileModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; backdrop-filter: blur(10px);">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 15, 0.95); border-radius: 20px; padding: 30px; max-width: 400px; width: 90%; border: 2px solid rgba(0, 255, 136, 0.3); box-shadow: 0 0 50px rgba(0, 255, 136, 0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #00ff88; margin: 0;">👤 <span data-translate="playerProfile">O'yinchi Profili</span></h3>
                    <button style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">×</button>
                </div>
                
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #ff6b35, #f7931e); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 15px;">🐉</div>
                    <h2 style="color: #00ff88; margin-bottom: 5px;" id="modalPlayerName">Player Name</h2>
                    <div style="color: #ccc; font-size: 14px;" id="modalPlayerCountry">🇺🇿 UZ</div>
                    <div style="color: #ccc; font-size: 12px; margin-top: 5px;" id="modalPlayerStatus">🟢 Online</div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px; border: 1px solid rgba(0, 255, 136, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #00ff88;" id="modalPlayerBalance">0</div>
                        <div style="font-size: 12px; color: #ccc;">Dragon Coins</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px; border: 1px solid rgba(255, 107, 53, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #ff6b35;" id="modalPlayerLevel">1</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="level">Level</div>
                        <div style="font-size: 10px; color: #ff6b35; margin-top: 2px;" id="modalPlayerLevelName">Wood</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #FFD700;" id="modalPlayerTaps">0</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="totalTaps">Total Taps</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px; border: 1px solid rgba(138, 43, 226, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #8A2BE2;" id="modalPlayerReferrals">0</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="referrals">Referrals</div>
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="color: #00ff88; margin-bottom: 10px; font-size: 14px;">📊 <span data-translate="playerStats">O'yinchi Statistikasi</span></h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="rankPosition">Reyting pozitsiyasi:</span>
                        <span style="color: #00ff88; font-weight: bold; font-size: 12px;" id="modalPlayerRank">#1</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="lastSeen">Oxirgi faollik:</span>
                        <span style="color: #ccc; font-size: 12px;" id="modalPlayerLastSeen">Hozir</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="playerType">O'yinchi turi:</span>
                        <span style="color: #00ff88; font-size: 12px;" id="modalPlayerType">Real Player</span>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                        <span data-translate="close">Yopish</span>
                    </button>
                    <button style="flex: 1; background: linear-gradient(45deg, #00ff88, #00cc6a); border: none; color: #000; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                        <span data-translate="challenge">Raqobat</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div class="section" id="adminSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">⚙️ <span data-translate="admin">Admin Panel</span></h3>
                
                <!-- Player Management -->
                <div style="background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #ff6b35; margin-bottom: 15px;">👥 <span data-translate="playerManagement">O'yinchi Boshqaruvi</span></h4>
                    
                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="totalPlayers">Jami o'yinchilar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="registeredUsers">Ro'yxatdan o'tgan foydalanuvchilar</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;" id="totalPlayersCount">0</div>
                    </div>

                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="onlinePlayers">Online o'yinchilar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentlyActive">Hozir faol</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;" id="onlinePlayersCount">0</div>
                    </div>

                    <div class="condition-item">
                        <div>
                            <div style="font-weight: bold;" data-translate="totalCoins">Jami coinlar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="systemWide">Tizim bo'ylab</div>
                        </div>
                        <div style="color: #FFD700; font-weight: bold;" id="totalCoinsCount">0</div>
                    </div>
                </div>

                <!-- System Controls -->
                <div style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">🎮 <span data-translate="systemControls">Tizim Boshqaruvi</span></h4>
                    
                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="addCoinsToPlayer">O'yinchiga coin qo'shish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="addCoinsDesc">Tanlangan o'yinchiga coin berish</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">💰</div>
                    </div>

                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="resetPlayer">O'yinchini qayta boshlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="resetPlayerDesc">O'yinchi ma'lumotlarini tozalash</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">🔄</div>
                    </div>

                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="broadcastMessage">Umumiy xabar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="broadcastDesc">Barcha o'yinchilarga xabar yuborish</div>
                        </div>
                        <div style="color: #8A2BE2; font-weight: bold;">📢</div>
                    </div>

                    <div class="condition-item task-button">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="systemMaintenance">Tizim texnik xizmati</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="maintenanceDesc">Tizimni texnik xizmatga o'tkazish</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">🔧</div>
                    </div>
                </div>

                <!-- Task Management -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">📋 <span data-translate="taskManagement">Vazifa Boshqaruvi</span></h4>
                    
                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="addNewTask">Yangi vazifa qo'shish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="addTaskDesc">Tizimga yangi vazifa qo'shish</div>
                        </div>
                        <div style="color: #FFD700; font-weight: bold;">➕</div>
                    </div>

                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="removeTask">Vazifani o'chirish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="removeTaskDesc">Mavjud vazifani o'chirish</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">➖</div>
                    </div>

                    <div class="condition-item task-button" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="editTask">Vazifani tahrirlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="editTaskDesc">Mavjud vazifa ma'lumotlarini o'zgartirish</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">✏️</div>
                    </div>

                    <div class="condition-item task-button">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="viewAllTasks">Barcha vazifalarni ko'rish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="viewTasksDesc">Tizimda mavjud barcha vazifalar</div>
                        </div>
                        <div style="color: #8A2BE2; font-weight: bold;">👁️</div>
                    </div>
                </div>

                <!-- Game Statistics -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">📊 <span data-translate="gameStatistics">O'yin Statistikasi</span></h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="totalTapsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="totalTapsSystem">Jami taplar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #8A2BE2;" id="totalReferralsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="totalReferralsSystem">Jami referrallar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="completedTasksSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="completedTasksSystem">Bajarilgan vazifalar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="activeBoostsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="activeBoostsSystem">Faol boostlar</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">📈 <span data-translate="recentActivity">So'nggi Faollik</span></h4>
                    <div id="recentActivityList">
                        <!-- Recent activity will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div class="section" id="profileSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">👤 <span data-translate="profile">Foydalanuvchi Profili</span></h3>
                
                <!-- User Avatar and Basic Info -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(45deg, #ff6b35, #f7931e); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 50px; margin: 0 auto 15px;">🐉</div>
                    <h2 style="color: #00ff88; margin-bottom: 5px;" id="profilePlayerName">Dragon Miner</h2>
                    <div style="color: #ccc; font-size: 14px;" id="profilePlayerId">ID: loading...</div>
                    <div style="color: #ccc; font-size: 14px; margin-top: 5px;">
                        <span data-translate="joinedDate">Qo'shilgan sana:</span> <span id="profileJoinDate">2024</span>
                    </div>
                </div>

                <!-- Detailed Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-value" id="profileBalance">0</div>
                        <div class="stat-label">Dragon Coins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileLevel">1</div>
                        <div class="stat-label" data-translate="level">Level</div>
                        <div class="stat-label" id="profileLevelName" style="color: #00ff88; font-size: 10px; margin-top: 2px;">Wood</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileTotalTaps">0</div>
                        <div class="stat-label" data-translate="totalTaps">Jami taplar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileReferrals">0</div>
                        <div class="stat-label" data-translate="referrals">Referrallar</div>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        🏆 <span data-translate="achievements">Yutuqlar</span>
                        <span style="background: rgba(255, 215, 0, 0.2); color: #FFD700; padding: 4px 8px; border-radius: 12px; font-size: 12px;" id="achievementsCount">0</span>
                    </h4>
                    <div id="achievementsList">
                        <!-- Achievements will be populated here -->
                    </div>
                </div>

                <!-- Game Statistics -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">📊 <span data-translate="gameStats">O'yin Statistikasi</span></h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="profileTapPower">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="tapPower">Tap kuchi</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="profileEnergy">1000</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentEnergy">Hozirgi energiya</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="profileCompletedTasks">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="completedTasksCount">Bajarilgan vazifalar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #8A2BE2;" id="profileReferralEarnings">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="referralEarnings">Referral daromadi</div>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">⚙️ <span data-translate="settings">Sozlamalar</span></h4>
                    
                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="language">Til</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentLanguage">Hozirgi til</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="currentLanguageDisplay">🇺🇿 UZ</span>
                            <button style="background: #00ff88; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                <span data-translate="change">O'zgartirish</span>
                            </button>
                        </div>
                    </div>

                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="dataStorage">Ma'lumotlar saqlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="localStorage">Mahalliy xotira</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">
                            <span data-translate="active">Faol</span> ✅
                        </div>
                    </div>

                    <div class="condition-item">
                        <div>
                            <div style="font-weight: bold;" data-translate="firebaseSync">Firebase sinxronizatsiya</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="cloudSync">Bulut sinxronizatsiya</div>
                        </div>
                        <div id="firebaseSyncStatus" style="color: #ff6b35; font-weight: bold;">
                            <span data-translate="checking">Tekshirilmoqda...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Multi-language support
        const translations = {
            uz: {
                tap: "Tapping",
                tasks: "Vazifalar",
                referral: "Referral",
                leaderboard: "Reyting",
                coinsPerTap: "Har tap uchun coin",
                totalTaps: "Jami taplar",
                level: "Level",
                referrals: "Referrallar",
                energyWarning: "⚠️ Energy bo'sh! Energiya to'lishi uchun kutib turing.",
                task500taps: "500 marta tap qiling",
                taskLevel5: "Level 5 ga yeting",
                task10000coins: "10000 coin to'plang",
                taskReferral: "5 ta do'st taklif qiling",
                taskTelegram: "Telegram kanalga obuna bo'ling",
                taskYoutube: "YouTube kanalga obuna bo'ling",
                taskCode: "Maxsus kodni kiriting",
                progress: "Progress",
                currentLevel: "Hozirgi level",
                referralSystem: "Referral Tizimi",
                yourReferralLink: "Sizning referral linkingiz:",
                copyLink: "Linkni nusxalash",
                totalReferrals: "Jami referrallar",
                referralEarnings: "Referral daromadi",
                referralRewards: "Referral mukofotlari:",
                reward1: "Har bir referral uchun: +500 DRC",
                reward2: "Referral birinchi marta tap qilganda: +200 DRC",
                reward3: "Referral Level 5 ga yetganda: +1000 DRC",
                reward4: "Referral 10000 coin to'plaganda: +2000 DRC",
                yourReferrals: "Sizning referrallaringiz:",
                noReferrals: "Hali referrallaringiz yo'q. Do'stlaringizni taklif qiling!",
                byCoins: "Coinlar bo'yicha",
                byReferrals: "Referrallar bo'yicha",
                yourRank: "Sizning o'rningiz:",
                completedTasks: "Bajarilgan Vazifalar",
                profile: "Profil",
                joinedDate: "Qo'shilgan sana",
                achievements: "Yutuqlar",
                gameStats: "O'yin Statistikasi",
                tapPower: "Tap kuchi",
                currentEnergy: "Hozirgi energiya",
                completedTasksCount: "Bajarilgan vazifalar",
                settings: "Sozlamalar",
                language: "Til",
                currentLanguage: "Hozirgi til",
                change: "O'zgartirish",
                dataStorage: "Ma'lumotlar saqlash",
                localStorage: "Mahalliy xotira",
                active: "Faol",
                firebaseSync: "Firebase sinxronizatsiya",
                cloudSync: "Bulut sinxronizatsiya",
                checking: "Tekshirilmoqda",
                playerProfile: "O'yinchi Profili",
                playerStats: "O'yinchi Statistikasi",
                rankPosition: "Reyting pozitsiyasi",
                lastSeen: "Oxirgi faollik",
                playerType: "O'yinchi turi",
                close: "Yopish",
                challenge: "Raqobat",
                boost: "Boostlar",
                currentBoosts: "Hozirgi Boostlar",
                maxEnergy: "Max energiya",
                tapPowerBoosts: "Tap Kuchi Boostlari",
                tapPowerDesc: "Har tap uchun 2 coin oling",
                tapPowerDesc2: "Har tap uchun 3 coin oling",
                tapPowerDesc3: "Har tap uchun 5 coin oling",
                tapPowerDesc4: "Har tap uchun 10 coin oling",
                energyBoosts: "Energiya Boostlari",
                energyDesc: "Max energiya 1500 ga oshadi",
                energyDesc2: "Max energiya 2500 ga oshadi",
                energyDesc3: "Max energiya 5000 ga oshadi",
                specialBoosts: "Maxsus Boostlar",
                autoTapDesc: "1 soat davomida avtomatik tap",
                energyRefillDesc: "Energiyani darhol to'ldiradi",
                doubleCoinsDesc: "30 daqiqa ikki barobar coin",
                activeBoosts: "Faol Boostlar",
                admin: "Admin",
                playerManagement: "O'yinchi Boshqaruvi",
                totalPlayers: "Jami o'yinchilar",
                registeredUsers: "Ro'yxatdan o'tgan foydalanuvchilar",
                onlinePlayers: "Online o'yinchilar",
                currentlyActive: "Hozir faol",
                totalCoins: "Jami coinlar",
                systemWide: "Tizim bo'ylab",
                systemControls: "Tizim Boshqaruvi",
                addCoinsToPlayer: "O'yinchiga coin qo'shish",
                addCoinsDesc: "Tanlangan o'yinchiga coin berish",
                resetPlayer: "O'yinchini qayta boshlash",
                resetPlayerDesc: "O'yinchi ma'lumotlarini tozalash",
                broadcastMessage: "Umumiy xabar",
                broadcastDesc: "Barcha o'yinchilarga xabar yuborish",
                systemMaintenance: "Tizim texnik xizmati",
                maintenanceDesc: "Tizimni texnik xizmatga o'tkazish",
                gameStatistics: "O'yin Statistikasi",
                totalTapsSystem: "Jami taplar",
                totalReferralsSystem: "Jami referrallar",
                completedTasksSystem: "Bajarilgan vazifalar",
                activeBoostsSystem: "Faol boostlar",
                recentActivity: "So'nggi Faollik",
                comingSoon: "Tez Orada!",
                boostComingSoon: "Boostlar tizimi tez orada qo'shiladi. Kuting!",
                taskManagement: "Vazifa Boshqaruvi",
                addNewTask: "Yangi vazifa qo'shish",
                addTaskDesc: "Tizimga yangi vazifa qo'shish",
                removeTask: "Vazifani o'chirish",
                removeTaskDesc: "Mavjud vazifani o'chirish",
                editTask: "Vazifani tahrirlash",
                editTaskDesc: "Mavjud vazifa ma'lumotlarini o'zgartirish",
                viewAllTasks: "Barcha vazifalarni ko'rish",
                viewTasksDesc: "Tizimda mavjud barcha vazifalar",
                multitap: "Multitap",
                multitapBoosts: "Multitap",
                rechargeBoosts: "Energy Recharging Speed",
                basicTasks: "Basic Tasks",
                levelTasks: "Level Tasks",
                referralTasks: "Referral Tasks",
                customTasks: "Custom Tasks",
                taskLevel3: "Reach Level 3",
                taskLevel7: "Reach Level 7",
                taskLevel10: "Reach Level 10",
                taskReferral1: "Invite first friend",
                taskReferral3: "Invite 3 friends",
                taskReferral10: "Invite 10 friends"
            },
            en: {
                tap: "Tapping",
                tasks: "Tasks",
                referral: "Referral",
                leaderboard: "Leaderboard",
                coinsPerTap: "Coins per tap",
                totalTaps: "Total taps",
                level: "Level",
                referrals: "Referrals",
                energyWarning: "⚠️ Energy empty! Wait for energy to refill.",
                task500taps: "Tap 500 times",
                taskLevel5: "Reach Level 5",
                task10000coins: "Collect 10000 coins",
                taskReferral: "Invite 5 friends",
                progress: "Progress",
                currentLevel: "Current level",
                referralSystem: "Referral System",
                yourReferralLink: "Your referral link:",
                copyLink: "Copy Link",
                totalReferrals: "Total Referrals",
                referralEarnings: "Referral Earnings",
                referralRewards: "Referral Rewards:",
                reward1: "For each referral: +500 DRC",
                reward2: "When referral first taps: +200 DRC",
                reward3: "When referral reaches Level 5: +1000 DRC",
                reward4: "When referral collects 10000 coins: +2000 DRC",
                yourReferrals: "Your Referrals:",
                noReferrals: "No referrals yet. Invite your friends!",
                byCoins: "By Coins",
                byReferrals: "By Referrals",
                yourRank: "Your Rank:",
                completedTasks: "Completed Tasks",
                profile: "Profile",
                joinedDate: "Joined Date",
                achievements: "Achievements",
                gameStats: "Game Statistics",
                tapPower: "Tap Power",
                currentEnergy: "Current Energy",
                completedTasksCount: "Completed Tasks",
                settings: "Settings",
                language: "Language",
                currentLanguage: "Current Language",
                change: "Change",
                dataStorage: "Data Storage",
                localStorage: "Local Storage",
                active: "Active",
                firebaseSync: "Firebase Sync",
                cloudSync: "Cloud Sync",
                checking: "Checking",
                playerProfile: "Player Profile",
                playerStats: "Player Statistics",
                rankPosition: "Rank Position",
                lastSeen: "Last Seen",
                playerType: "Player Type",
                close: "Close",
                challenge: "Challenge",
                boost: "Boosts",
                currentBoosts: "Current Boosts",
                maxEnergy: "Max Energy",
                tapPowerBoosts: "Tap Power Boosts",
                tapPowerDesc: "Get 2 coins per tap",
                tapPowerDesc2: "Get 3 coins per tap",
                tapPowerDesc3: "Get 5 coins per tap",
                tapPowerDesc4: "Get 10 coins per tap",
                energyBoosts: "Energy Boosts",
                energyDesc: "Max energy increases to 1500",
                energyDesc2: "Max energy increases to 2500",
                energyDesc3: "Max energy increases to 5000",
                specialBoosts: "Special Boosts",
                autoTapDesc: "Auto tap for 1 hour",
                energyRefillDesc: "Instantly refill energy",
                doubleCoinsDesc: "Double coins for 30 minutes",
                activeBoosts: "Active Boosts",
                admin: "Admin",
                playerManagement: "Player Management",
                totalPlayers: "Total Players",
                registeredUsers: "Registered Users",
                onlinePlayers: "Online Players",
                currentlyActive: "Currently Active",
                totalCoins: "Total Coins",
                systemWide: "System Wide",
                systemControls: "System Controls",
                addCoinsToPlayer: "Add Coins to Player",
                addCoinsDesc: "Give coins to selected player",
                resetPlayer: "Reset Player",
                resetPlayerDesc: "Clear player data",
                broadcastMessage: "Broadcast Message",
                broadcastDesc: "Send message to all players",
                systemMaintenance: "System Maintenance",
                maintenanceDesc: "Put system in maintenance mode",
                gameStatistics: "Game Statistics",
                totalTapsSystem: "Total Taps",
                totalReferralsSystem: "Total Referrals",
                completedTasksSystem: "Completed Tasks",
                activeBoostsSystem: "Active Boosts",
                recentActivity: "Recent Activity",
                comingSoon: "Coming Soon!",
                boostComingSoon: "Boost system will be added soon. Stay tuned!",
                taskManagement: "Task Management",
                addNewTask: "Add New Task",
                addTaskDesc: "Add new task to system",
                removeTask: "Remove Task",
                removeTaskDesc: "Remove existing task",
                editTask: "Edit Task",
                editTaskDesc: "Edit existing task data",
                viewAllTasks: "View All Tasks",
                viewTasksDesc: "All tasks in the system",
                multitap: "Multitap",
                multitapBoosts: "Multitap",
                rechargeBoosts: "Energy Recharging Speed",
                basicTasks: "Basic Tasks",
                levelTasks: "Level Tasks",
                referralTasks: "Referral Tasks",
                customTasks: "Custom Tasks",
                taskLevel3: "Reach Level 3",
                taskLevel7: "Reach Level 7",
                taskLevel10: "Reach Level 10",
                taskReferral1: "Invite first friend",
                taskReferral3: "Invite 3 friends",
                taskReferral10: "Invite 10 friends"
            },
            ru: {
                tap: "Тапинг",
                tasks: "Задания",
                referral: "Реферал",
                leaderboard: "Рейтинг",
                coinsPerTap: "Монет за тап",
                totalTaps: "Всего тапов",
                level: "Уровень",
                referrals: "Рефералы",
                energyWarning: "⚠️ Энергия закончилась! Подождите восстановления.",
                task500taps: "Тапните 500 раз",
                taskLevel5: "Достигните 5 уровня",
                task10000coins: "Соберите 10000 монет",
                taskReferral: "Пригласите 5 друзей",
                progress: "Прогресс",
                currentLevel: "Текущий уровень",
                referralSystem: "Реферальная Система",
                yourReferralLink: "Ваша реферальная ссылка:",
                copyLink: "Копировать ссылку",
                totalReferrals: "Всего рефералов",
                referralEarnings: "Доход с рефералов",
                referralRewards: "Награды за рефералов:",
                reward1: "За каждого реферала: +500 DRC",
                reward2: "Когда реферал первый раз тапнет: +200 DRC",
                reward3: "Когда реферал достигнет 5 уровня: +1000 DRC",
                reward4: "Когда реферал соберет 10000 монет: +2000 DRC",
                yourReferrals: "Ваши рефералы:",
                noReferrals: "Пока нет рефералов. Пригласите друзей!",
                byCoins: "По монетам",
                byReferrals: "По рефералам",
                yourRank: "Ваше место:",
                completedTasks: "Выполненные Задания",
                profile: "Профиль",
                joinedDate: "Дата регистрации",
                achievements: "Достижения",
                gameStats: "Игровая Статистика",
                tapPower: "Сила тапа",
                currentEnergy: "Текущая энергия",
                completedTasksCount: "Выполненные задания",
                settings: "Настройки",
                language: "Язык",
                currentLanguage: "Текущий язык",
                change: "Изменить",
                dataStorage: "Хранение данных",
                localStorage: "Локальное хранилище",
                active: "Активно",
                firebaseSync: "Firebase синхронизация",
                cloudSync: "Облачная синхронизация",
                checking: "Проверяется",
                playerProfile: "Профиль Игрока",
                playerStats: "Статистика Игрока",
                rankPosition: "Позиция в рейтинге",
                lastSeen: "Последняя активность",
                playerType: "Тип игрока",
                close: "Закрыть",
                challenge: "Вызов",
                boost: "Бусты",
                currentBoosts: "Текущие Бусты",
                maxEnergy: "Макс Энергия",
                tapPowerBoosts: "Бусты Силы Тапа",
                tapPowerDesc: "Получайте 2 монеты за тап",
                tapPowerDesc2: "Получайте 3 монеты за тап",
                tapPowerDesc3: "Получайте 5 монет за тап",
                tapPowerDesc4: "Получайте 10 монет за тап",
                energyBoosts: "Бусты Энергии",
                energyDesc: "Макс энергия увеличивается до 1500",
                energyDesc2: "Макс энергия увеличивается до 2500",
                energyDesc3: "Макс энергия увеличивается до 5000",
                specialBoosts: "Специальные Бусты",
                autoTapDesc: "Авто тап на 1 час",
                energyRefillDesc: "Мгновенно восстановить энергию",
                doubleCoinsDesc: "Двойные монеты на 30 минут",
                activeBoosts: "Активные Бусты",
                admin: "Админ",
                playerManagement: "Управление Игроками",
                totalPlayers: "Всего Игроков",
                registeredUsers: "Зарегистрированные Пользователи",
                onlinePlayers: "Онлайн Игроки",
                currentlyActive: "Сейчас Активны",
                totalCoins: "Всего Монет",
                systemWide: "По Всей Системе",
                systemControls: "Управление Системой",
                addCoinsToPlayer: "Добавить Монеты Игроку",
                addCoinsDesc: "Дать монеты выбранному игроку",
                resetPlayer: "Сбросить Игрока",
                resetPlayerDesc: "Очистить данные игрока",
                broadcastMessage: "Общее Сообщение",
                broadcastDesc: "Отправить сообщение всем игрокам",
                systemMaintenance: "Техническое Обслуживание",
                maintenanceDesc: "Перевести систему в режим обслуживания",
                gameStatistics: "Игровая Статистика",
                totalTapsSystem: "Всего Тапов",
                totalReferralsSystem: "Всего Рефералов",
                completedTasksSystem: "Выполненные Задания",
                activeBoostsSystem: "Активные Бусты",
                recentActivity: "Недавняя Активность",
                comingSoon: "Скоро!",
                boostComingSoon: "Система бустов будет добавлена в ближайшее время. Ждите!",
                taskManagement: "Управление Заданиями",
                addNewTask: "Добавить Новое Задание",
                addTaskDesc: "Добавить новое задание в систему",
                removeTask: "Удалить Задание",
                removeTaskDesc: "Удалить существующее задание",
                editTask: "Редактировать Задание",
                editTaskDesc: "Изменить данные существующего задания",
                viewAllTasks: "Просмотреть Все Задания",
                viewTasksDesc: "Все задания в системе",
                multitap: "Мультитап",
                multitapBoosts: "Мультитап",
                rechargeBoosts: "Скорость Восстановления Энергии",
                basicTasks: "Основные Задания",
                levelTasks: "Задания по Уровню",
                referralTasks: "Реферальные Задания",
                customTasks: "Особые Задания",
                taskLevel3: "Достигните 3 уровня",
                taskLevel7: "Достигните 7 уровня",
                taskLevel10: "Достигните 10 уровня",
                taskReferral1: "Пригласите первого друга",
                taskReferral3: "Пригласите 3 друзей",
                taskReferral10: "Пригласите 10 друзей"
            }
        };

        let currentLanguage = 'uz';
        const countryFlags = {
            uz: '🇺🇿',
            en: '🇺🇸',
            ru: '🇷🇺'
        };

        // Level system with names and requirements
        const levelSystem = {
            1: { name: 'Wood', tapsRequired: 0, color: '#8B4513' },
            2: { name: 'Bronze', tapsRequired: 500, color: '#CD7F32' },
            3: { name: 'Silver', tapsRequired: 1500, color: '#C0C0C0' },
            4: { name: 'Gold', tapsRequired: 3500, color: '#FFD700' },
            5: { name: 'Platinum', tapsRequired: 7000, color: '#E5E4E2' },
            6: { name: 'Diamond', tapsRequired: 12000, color: '#B9F2FF' },
            7: { name: 'Master', tapsRequired: 20000, color: '#FF6B35' },
            8: { name: 'Grandmaster', tapsRequired: 35000, color: '#9932CC' },
            9: { name: 'Legend', tapsRequired: 60000, color: '#FF1493' },
            10: { name: 'Mythic', tapsRequired: 100000, color: '#00FFFF' }
        };

        // Game state
        let gameState = {
            balance: 0,
            energy: 1000,
            maxEnergy: 1000,
            tapPower: 1,
            multitap: 1,
            rechargeSpeed: 5000, // milliseconds per energy point
            totalTaps: 0,
            level: 1,
            completedTasks: {
                taps: false,
                level: false,
                coins: false,
                referral: false,
                telegram: false,
                youtube: false,
                code: false,
                level3: false,
                level7: false,
                level10: false,
                referral1: false,
                referral3: false,
                referral10: false
            },
            lastSaveTime: Date.now(),
            referralCode: generateReferralCode(),
            referrals: [],
            referralEarnings: 0,
            referredBy: null,
            playerName: 'Dragon Miner',
            country: 'UZ',
            boosts: {
                tapPower: 1,
                maxEnergy: 1000,
                multitap: 1,
                rechargeSpeed: 5000,
                purchased: {
                    tapPower2: false,
                    tapPower3: false,
                    tapPower5: false,
                    tapPower10: false,
                    energy1500: false,
                    energy2500: false,
                    energy5000: false,
                    multitap2: false,
                    multitap3: false,
                    multitap5: false,
                    recharge2: false,
                    recharge3: false,
                    recharge5: false
                }
            },
            activeBoosts: {
                turbo: { active: false, endTime: 0 }
            }
        };

        let globalPlayers = [];
        let firebaseConnected = false;
        let tapEffectPool = [];
        let lastUIUpdate = 0;
        let pendingUIUpdate = false;
        let lastTapTime = 0;

        // Generate unique referral code
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Firebase connection
        function initializeFirebaseConnection() {
            console.log('🔄 Firebase ulanishni tekshirish...');
            updateFirebaseStatus(false);
            
            setTimeout(() => {
                try {
                    if (window.firebaseDatabase) {
                        console.log('✅ Firebase muvaffaqiyatli ulandi');
                        firebaseConnected = true;
                        updateFirebaseStatus(true);
                        loadPlayersFromFirebase();
                        savePlayerToFirebase();
                        loadGlobalTaskSettings(); // Load global task settings
                    } else {
                        throw new Error('Firebase not available');
                    }
                } catch (error) {
                    console.log('⚠️ Firebase mavjud emas, mahalliy rejimda ishlash');
                    firebaseConnected = false;
                    updateFirebaseStatus(false);
                    generateDemoPlayers();
                }
            }, 2000);
        }

        function updateFirebaseStatus(connected) {
            const statusElement = document.getElementById('firebaseStatus');
            if (connected) {
                statusElement.textContent = '🔥 Firebase Ulandi - Real-time sinxronizatsiya';
                statusElement.className = 'firebase-status firebase-connected';
                
                setTimeout(() => {
                    statusElement.style.opacity = '0';
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 500);
                }, 3000);
            } else {
                statusElement.textContent = '📱 Mahalliy rejim - Firebase mavjud emas';
                statusElement.className = 'firebase-status firebase-disconnected';
                
                setTimeout(() => {
                    statusElement.style.opacity = '0';
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 500);
                }, 2000);
            }
        }

        function savePlayerToFirebase() {
            if (!firebaseConnected || !window.firebaseDatabase) return;
            
            try {
                const playerId = getUniquePlayerId();
                const playerRef = window.firebaseRef(window.firebaseDatabase, `players/${playerId}`);
                
                const playerData = {
                    id: playerId,
                    name: gameState.playerName,
                    balance: gameState.balance,
                    level: gameState.level,
                    totalTaps: gameState.totalTaps,
                    referrals: gameState.referrals.length,
                    country: gameState.country,
                    lastUpdate: Date.now(),
                    isOnline: true,
                    referralCode: gameState.referralCode
                };
                
                window.firebaseSet(playerRef, playerData);
            } catch (error) {
                console.error('❌ Firebase ga saqlashda xatolik:', error);
            }
        }

        // Global task management functions
        function saveGlobalTaskSettings() {
            if (!firebaseConnected || !window.firebaseDatabase) return;
            
            try {
                // Save hidden/deleted standard tasks
                const hiddenTasks = [];
                const deletedTasks = [];
                
                const standardTaskIds = ['taps', 'level', 'level3', 'level7', 'level10', 'coins', 'referral', 'referral1', 'referral3', 'referral10', 'telegram', 'youtube', 'code'];
                
                standardTaskIds.forEach(taskId => {
                    if (localStorage.getItem(`hiddenTask_${taskId}`) === 'true') {
                        hiddenTasks.push(taskId);
                    }
                    if (localStorage.getItem(`deletedTask_${taskId}`) === 'true') {
                        deletedTasks.push(taskId);
                    }
                });
                
                const taskSettingsRef = window.firebaseRef(window.firebaseDatabase, 'globalTaskSettings');
                window.firebaseSet(taskSettingsRef, {
                    hiddenTasks: hiddenTasks,
                    deletedTasks: deletedTasks,
                    lastUpdate: Date.now()
                });
                
                // Save custom tasks globally
                const customTasksRef = window.firebaseRef(window.firebaseDatabase, 'globalCustomTasks');
                window.firebaseSet(customTasksRef, {
                    tasks: customTasks,
                    lastUpdate: Date.now()
                });
                
                console.log('✅ Global vazifa sozlamalari saqlandi');
            } catch (error) {
                console.error('❌ Global vazifa sozlamalarini saqlashda xatolik:', error);
            }
        }

        function loadGlobalTaskSettings() {
    if (!window.firebaseDatabase || !window.firebaseRef || !window.firebaseOnValue) {
        console.warn('Firebase SDK mavjud emas — global vazifa sozlamalari yuklanmaydi.');
    }
    try {
        const taskSettingsRef = window.firebaseRef(window.firebaseDatabase, 'globalTaskSettings');
        window.firebaseOnValue(taskSettingsRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                console.log('📥 Global vazifa sozlamalari yuklandi:', data);
                const standardTaskIds = ['taps','level','level3','level7','level10','coins','referral','referral1','referral3','referral10','telegram','youtube','code'];
                standardTaskIds.forEach(taskId => {
                    localStorage.removeItem(`hiddenTask_${taskId}`);
                    localStorage.removeItem(`deletedTask_${taskId}`);
                });
                if (data.hiddenTasks) data.hiddenTasks.forEach(taskId => localStorage.setItem(`hiddenTask_${taskId}`, 'true'));
                if (data.deletedTasks) data.deletedTasks.forEach(taskId => localStorage.setItem(`deletedTask_${taskId}`, 'true'));
                setTimeout(() => updateTasksDisplay(), 100);
            }
        });
        const customTasksRef = window.firebaseRef(window.firebaseDatabase, 'globalCustomTasks');
        window.firebaseOnValue(customTasksRef, (snapshot) => {
            const data = snapshot.val();
            if (data && data.tasks) {
                console.log('📥 Global maxsus vazifalar yuklandi:', data.tasks.length, 'ta vazifa');
                const existingCustomTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
                const mergedTasks = data.tasks.map(globalTask => {
                    const existingTask = existingCustomTasks.find(t => t.id === globalTask.id);
                    return existingTask ? { ...globalTask, completed: existingTask.completed, completedDate: existingTask.completedDate } : globalTask;
                });
                customTasks = mergedTasks;
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                setTimeout(() => updateTasksDisplay(), 100);
            }
        });
    } catch (error) {
        console.error('❌ Global vazifa sozlamalarini yuklashda xatolik:', error);
    }
}
            
            // Additional validation for level and referral tasks
            if (taskType === 'level' && (!taskLevel || isNaN(taskLevel) || taskLevel < 1)) {
                showNotification("❌ Level raqamini to'g'ri kiriting!", 'error');
            }
            
            if (taskType === 'referral' && (!taskReferralCount || isNaN(taskReferralCount) || taskReferralCount < 1)) {
                showNotification("❌ Referral sonini to'g'ri kiriting!", 'error');
            }
            
            const newTask = {
                id: 'custom_' + Date.now(),
                type: taskType,
                name: taskName,
                description: taskDesc,
                link: taskLink,
                reward: taskReward,
                code: taskCode,
                level: taskLevel,
                referralCount: taskReferralCount,
                completed: false,
                dateAdded: new Date().toLocaleDateString()
            };
            
            customTasks.push(newTask);
            localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
            
            // Save to Firebase for all players immediately
            saveGlobalTaskSettings();
            
            // Close modal safely
            closeAddTaskModal();
            
            showNotification(`✅ "${taskName}" vazifasi barcha o'yinchilar uchun qo'shildi!`, 'success');
            
            // Update display immediately
            updateTasksDisplay();
            
            // Show notification about where the task was added
            const categoryName = getCategoryName(taskType);
            setTimeout(() => {
                showNotification(`📍 Vazifa "${categoryName}" bo'limiga joylashtirildi!`, 'success');
            }, 2000);
        }
        
        function getCategoryName(taskType) {
            switch(taskType) {
                case 'telegram':
                case 'youtube':
                case 'code':
                case 'website':
                case 'social':
                    return 'Asosiy Vazifalar';
                case 'level':
                    return 'Level Vazifalari';
                case 'referral':
                    return 'Referral Vazifalari';
                default:
                    return 'Maxsus Vazifalar';
            }
        }

        function showRemoveTaskModal() {
            // Load latest custom tasks
            customTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
            
            // Get all tasks (standard + custom)
            const standardTasks = [
                { id: 'taps', name: '500 marta tap qiling', reward: 1000, type: 'standard', category: 'Asosiy' },
                { id: 'level', name: 'Level 5 ga yeting', reward: 2000, type: 'standard', category: 'Asosiy' },
                { id: 'level3', name: 'Level 3 ga yeting', reward: 800, type: 'standard', category: 'Level' },
                { id: 'level7', name: 'Level 7 ga yeting', reward: 4000, type: 'standard', category: 'Level' },
                { id: 'level10', name: 'Level 10 ga yeting', reward: 8000, type: 'standard', category: 'Level' },
                { id: 'coins', name: '10000 coin to'plang', reward: 5000, type: 'standard', category: 'Asosiy' },
                { id: 'referral', name: '5 ta do'st taklif qiling', reward: 3000, type: 'standard', category: 'Asosiy' },
                { id: 'referral1', name: 'Birinchi do'stni taklif qiling', reward: 500, type: 'standard', category: 'Referral' },
                { id: 'referral3', name: '3 ta do'st taklif qiling', reward: 1500, type: 'standard', category: 'Referral' },
                { id: 'referral10', name: '10 ta do'st taklif qiling', reward: 6000, type: 'standard', category: 'Referral' },
                { id: 'telegram', name: 'Telegram kanalga obuna bo'ling', reward: 1500, type: 'standard', category: 'Asosiy' },
                { id: 'youtube', name: 'YouTube kanalga obuna bo'ling', reward: 2000, type: 'standard', category: 'Asosiy' },
                { id: 'code', name: 'Maxsus kodni kiriting', reward: 5000, type: 'standard', category: 'Asosiy' }
            ];
            
            const allTasks = [ standardTasks.map(task => ({
                    ...task,
                    isHidden: localStorage.getItem(`hiddenTask_${task.id}`) === 'true',
                    dateAdded: 'Dastur tomonidan'
                })), customTasks.map(task => ({
                    ...task,
                    type: 'custom',
                    category: 'Admin qo'shgan',
                    isHidden: false
                }))
            ];
            
            if (allTasks.length === 0) {
                showNotification("❌ O'chiriladigan vazifa yo'q!", 'error');
            }
            
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="removeTask"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'removeTask');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const tasksList = allTasks.map(task => {
                const statusText = task.isHidden ? 'Yashirilgan' : 'Ko'rinmoqda';
                const statusColor = task.isHidden ? '#ff6b35' : '#00ff88';
                const isDeleted = localStorage.getItem(`deletedTask_${task.id}`) === 'true';
                
                if (isDeleted && task.type === 'standard') {
                    return ''; // Don't show deleted standard tasks
                }
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${task.type === 'standard' ? '#FFD700' : '#00ff88'};">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: ${statusColor};">${task.name}</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 2px;">
                                ${task.reward} DRC • ${task.category} • ${task.dateAdded}
                            </div>
                            <div style="font-size: 10px; color: ${statusColor}; margin-top: 2px;">
                                ${task.type === 'standard' ? '📋 Standart vazifa' : '⭐ Admin vazifasi'} • ${statusText}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${task.type === 'standard' ? `
                                <button style="background: ${task.isHidden ? '#00ff88' : '#FFD700'}; color: ${task.isHidden ? '#fff' : '#000'}; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px;">
                                    ${task.isHidden ? 'Ko'rsatish' : 'Yashirish'}
                                </button>
                                <button style="background: #ff6b35; color: #fff; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px;">
                                    O'chirish
                                </button>
                            ` : `
                                <button style="background: #ff6b35; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                    O'chirish
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }).filter(html => html !== '').join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; border: 2px solid rgba(255,107,53,0.3); box-shadow: 0 0 50px rgba(255,107,53,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #ff6b35; margin: 0;">🗑️ Vazifalarni Boshqarish</h3>
                        <button style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <div style="color: #FFD700; font-weight: bold; margin-bottom: 8px;">ℹ️ Ma'lumot:</div>
                        <div style="font-size: 12px; color: #ccc; line-height: 1.4;">
                            • <strong>Standart vazifalar</strong> - dastur tomonidan yaratilgan, faqat yashirish/ko'rsatish mumkin<br>
                            • <strong>Admin vazifalari</strong> - siz qo'shgan, to'liq o'chirish mumkin<br>
                            • Yashirilgan vazifalar o'yinchilarga ko'rinmaydi
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button style="flex: 1; background: #FFD700; color: #000; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Barcha Standart Vazifalarni Qayta Tiklash</button>
                        <button style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Yopish</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeRemoveTaskModal();
                }
            });
        }

        function closeRemoveTaskModal() {
            const modal = document.querySelector('[data-modal="removeTask"]');
            if (modal) {
                modal.remove();
            }
        }

        function removeCustomTask(taskId) {
            const taskToRemove = customTasks.find(task => task.id === taskId);
            if (!taskToRemove) return;
            
            if (confirm(`"${taskToRemove.name
    saveGlobalTaskSettings();
}" vazifasini barcha o'yinchilar uchun o'chirishni tasdiqlaysizmi?`)) {
                customTasks = customTasks.filter(task => task.id !== taskId);
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Save to Firebase for all players immediately
                saveGlobalTaskSettings();
                
                // Close modal and refresh
                closeRemoveTaskModal();
                showNotification("✅ Vazifa barcha o'yinchilar uchun o'chirildi!", 'success');
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function hideStandardTask(taskId) {
            localStorage.setItem(`hiddenTask_${taskId}`, 'true');
            
            // Save to Firebase for all players immediately
            saveGlobalTaskSettings();
            
            closeRemoveTaskModal();
            showNotification("✅ Vazifa barcha o'yinchilar uchun yashirildi!", 'success');
            
            // Update display immediately
            updateTasksDisplay();
        }

        function showStandardTask(taskId) {
            localStorage.removeItem(`hiddenTask_${taskId}`);
            
            // Save to Firebase for all players immediately
            saveGlobalTaskSettings();
            
            closeRemoveTaskModal();
            showNotification("✅ Vazifa barcha o'yinchilar uchun ko'rsatildi!", 'success');
            
            // Update display immediately
            updateTasksDisplay();
        }

        function deleteStandardTask(taskId) {
            const taskNames = {
                taps: '500 marta tap qiling',
                level: 'Level 5 ga yeting',
                level3: 'Level 3 ga yeting',
                level7: 'Level 7 ga yeting',
                level10: 'Level 10 ga yeting',
                coins: '10000 coin to'plang',
                referral: '5 ta do'st taklif qiling',
                referral1: 'Birinchi do'stni taklif qiling',
                referral3: '3 ta do'st taklif qiling',
                referral10: '10 ta do'st taklif qiling',
                telegram: 'Telegram kanalga obuna bo'ling',
                youtube: 'YouTube kanalga obuna bo'ling',
                code: 'Maxsus kodni kiriting'
            };
            
            const taskName = taskNames[taskId] || taskId;
            
            if (confirm(`"${taskName}" vazifasini barcha o'yinchilar uchun butunlay o'chirishni tasdiqlaysizmi?\n\nBu vazifa hech kimga ko'rinmaydi.`)) {
                localStorage.setItem(`deletedTask_${taskId}`, 'true');
                
                // Save to Firebase for all players immediately
                saveGlobalTaskSettings();
                
                closeRemoveTaskModal();
                showNotification("✅ Vazifa barcha o'yinchilar uchun o'chirildi!", 'success');
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function resetAllStandardTasks() {
            if (confirm('Barcha standart vazifalarni barcha o'yinchilar uchun qayta tiklashni tasdiqlaysizmi?\n\nBu barcha yashirilgan va o'chirilgan standart vazifalarni qaytaradi.')) {
                const standardTaskIds = ['taps', 'level', 'level3', 'level7', 'level10', 'coins', 'referral', 'referral1', 'referral3', 'referral10', 'telegram', 'youtube', 'code'];
                
                standardTaskIds.forEach(taskId => {
                    localStorage.removeItem(`hiddenTask_${taskId}`);
                    localStorage.removeItem(`deletedTask_${taskId}`);
                });
                
                // Save to Firebase for all players immediately
                saveGlobalTaskSettings();
                
                closeRemoveTaskModal();
                showNotification("✅ Barcha vazifalar barcha o'yinchilar uchun qayta tiklandi!", 'success');
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function showViewTasksModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="viewTasks"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'viewTasks');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const allTasks = [
                Object.entries(gameState.completedTasks).map(([key, completed]) => ({
                    name: getTaskName(key),
                    type: 'Standart',
                    completed: completed,
                    reward: getTaskReward(key)
                })), customTasks.map(task => ({
                    name: task.name,
                    type: 'Maxsus',
                    completed: task.completed,
                    reward: task.reward
                }))
            ];
            
            const tasksList = allTasks.map(task => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${task.completed ? '#00ff88' : '#ff6b35'};">
                    <div>
                        <div style="font-weight: bold; color: ${task.completed ? '#00ff88' : '#fff'};">${task.name}</div>
                        <div style="font-size: 12px; color: #ccc;">${task.type} vazifa • ${task.reward} DRC</div>
                    </div>
                    <div style="color: ${task.completed ? '#00ff88' : '#ff6b35'}; font-size: 18px;">
                        ${task.completed ? '✅' : '⏳'}
                    </div>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; border: 2px solid rgba(255,215,0,0.3); box-shadow: 0 0 50px rgba(255,215,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #FFD700; margin: 0;">📋 Barcha Vazifalar</h3>
                        <button style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; text-align: center;">
                        <div style="flex: 1; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${allTasks.filter(t => t.completed).length}</div>
                            <div style="font-size: 12px; color: #ccc;">Bajarilgan</div>
                        </div>
                        <div style="flex: 1; padding: 15px; background: rgba(255,107,53,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;">${allTasks.filter(t => !t.completed).length}</div>
                            <div style="font-size: 12px; color: #ccc;">Kutilmoqda</div>
                        </div>
                        <div style="flex: 1; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;">${allTasks.length}</div>
                            <div style="font-size: 12px; color: #ccc;">Jami</div>
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button style="flex: 1; background: #ff6b35; color: #fff; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Barcha Maxsus Vazifalarni O'chirish</button>
                        <button style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Yopish</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeViewTasksModal();
                }
            });
        }

        function closeViewTasksModal() {
            const modal = document.querySelector('[data-modal="viewTasks"]');
            if (modal) {
                modal.remove();
            }
        }

        function clearAllCustomTasks() {
            if (confirm('Barcha maxsus vazifalarni barcha o'yinchilar uchun o'chirishni tasdiqlaysizmi? Bu amalni bekor qilib bo'lmaydi!')) {
                customTasks = [];
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Save to Firebase for all players
                saveGlobalTaskSettings();
                
                closeViewTasksModal();
                showNotification("✅ Barcha maxsus vazifalar barcha o'yinchilar uchun o'chirildi!", 'success');
                updateTasksDisplay();
            }
        }

        function getTaskName(taskKey) {
            const names = {
                taps: '500 marta tap qiling',
                level: 'Level 5 ga yeting',
                level3: 'Level 3 ga yeting',
                level7: 'Level 7 ga yeting',
                level10: 'Level 10 ga yeting',
                coins: '10000 coin to'plang',
                referral: '5 ta do'st taklif qiling',
                referral1: 'Birinchi do'stni taklif qiling',
                referral3: '3 ta do'st taklif qiling',
                referral10: '10 ta do'st taklif qiling',
                telegram: 'Telegram kanalga obuna bo'ling',
                youtube: 'YouTube kanalga obuna bo'ling',
                code: 'Maxsus kodni kiriting'
            };
            return names[taskKey] || taskKey;
        }

        function getTaskReward(taskKey) {
            const rewards = {
                taps: 1000,
                level: 2000,
                level3: 800,
                level7: 4000,
                level10: 8000,
                coins: 5000,
                referral: 3000,
                referral1: 500,
                referral3: 1500,
                referral10: 6000,
                telegram: 1500,
                youtube: 2000,
                code: 5000
            };
            return rewards[taskKey] || 0;
        }

        function showEditTaskModal() {
            if (customTasks.length === 0) {
                showNotification("❌ Tahrirlanadigan vazifa yo'q!", 'error');
            }
            
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="editTask"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'editTask');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const tasksList = customTasks.map(task => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: bold; color: #00ff88;">${task.name}</div>
                        <div style="font-size: 12px; color: #ccc;">${task.reward} DRC • ${task.type} • ${task.dateAdded}</div>
                    </div>
                    <button style="background: #00ff88; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Tahrirlash</button>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; border: 2px solid rgba(0,255,136,0.3); box-shadow: 0 0 50px rgba(0,255,136,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #00ff88; margin: 0;">✏️ Vazifalarni Tahrirlash</h3>
                        <button style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <button style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; margin-top: 15px;">Yopish</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditTaskModal();
                }
            });
        }

        function closeEditTaskModal() {
            const modal = document.querySelector('[data-modal="editTask"]');
            if (modal) {
                modal.remove();
            }
        }

        function editCustomTask(taskId) {
            const task = customTasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Close current modal
            closeEditTaskModal();
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'editTaskForm');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2001; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; border: 2px solid rgba(0,255,136,0.3); box-shadow: 0 0 50px rgba(0,255,136,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #00ff88; margin: 0;">✏️ Vazifani Tahrirlash</h3>
                        <button style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa turi:</label>
                        <select id="editTaskType" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                            <option value="telegram" ${task.type === 'telegram' ? 'selected' : ''}>📱 Telegram kanalga obuna</option>
                            <option value="youtube" ${task.type === 'youtube' ? 'selected' : ''}>📺 YouTube kanalga obuna</option>
                            <option value="code" ${task.type === 'code' ? 'selected' : ''}>🔐 Maxsus kod kiritish</option>
                            <option value="website" ${task.type === 'website' ? 'selected' : ''}>🌐 Websitega tashrif</option>
                            <option value="social" ${task.type === 'social' ? 'selected' : ''}>📲 Ijtimoiy tarmoq</option>
                            <option value="level" ${task.type === 'level' ? 'selected' : ''}>🏆 Level vazifasi</option>
                            <option value="referral" ${task.type === 'referral' ? 'selected' : ''}>👥 Referral vazifasi</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa nomi:</label>
                        <input type="text" id="editTaskName" value="${task.name}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Tavsif:</label>
                        <input type="text" id="editTaskDesc" value="${task.description || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editLinkSection" style="margin-bottom: 15px; display: ${['telegram', 'youtube', 'website', 'social'].includes(task.type) ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Link/Kanal nomi:</label>
                        <input type="text" id="editTaskLink" value="${task.link || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Mukofot (DRC):</label>
                        <input type="number" id="editTaskReward" value="${task.reward}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editCodeSection" style="margin-bottom: 15px; display: ${task.type === 'code' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">To'g'ri kod:</label>
                        <input type="text" id="editTaskCode" value="${task.code || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editLevelSection" style="margin-bottom: 15px; display: ${task.type === 'level' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli level:</label>
                        <input type="number" id="editTaskLevel" value="${task.level || ''}" min="1" max="50" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editReferralSection" style="margin-bottom: 15px; display: ${task.type === 'referral' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli referral soni:</label>
                        <input type="number" id="editTaskReferralCount" value="${task.referralCount || ''}" min="1" max="100" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Bekor qilish</button>
                        <button style="flex: 1; background: linear-gradient(45deg, #00ff88, #00cc6a); border: none; color: #000; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Saqlash</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show/hide sections based on task type
            document.getElementById('editTaskType').addEventListener('change', function() {
                const codeSection = document.getElementById('editCodeSection');
                const levelSection = document.getElementById('editLevelSection');
                const referralSection = document.getElementById('editReferralSection');
                const linkSection = document.getElementById('editLinkSection');
                
                // Hide all sections first
                codeSection.style.display = 'none';
                levelSection.style.display = 'none';
                referralSection.style.display = 'none';
                linkSection.style.display = 'block';
                
                // Show relevant section
                if (this.value === 'code') {
                    codeSection.style.display = 'block';
                } else if (this.value === 'level') {
                    levelSection.style.display = 'block';
                    linkSection.style.display = 'none';
                } else if (this.value === 'referral') {
                    referralSection.style.display = 'block';
                    linkSection.style.display = 'none';
                }
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditTaskFormModal();
                }
            });
        }

        function closeEditTaskFormModal() {
            const modal = document.querySelector('[data-modal="editTaskForm"]');
            if (modal) {
                modal.remove();
            }
        }

        function saveEditedTask(taskId) {
            const taskType = document.getElementById('editTaskType').value;
            const taskName = document.getElementById('editTaskName').value;
            const taskDesc = document.getElementById('editTaskDesc').value;
            const taskLink = document.getElementById('editTaskLink') ? document.getElementById('editTaskLink').value : '';
            const taskReward = parseInt(document.getElementById('editTaskReward').value);
            const taskCode = document.getElementById('editTaskCode') ? document.getElementById('editTaskCode').value : '';
            const taskLevel = document.getElementById('editTaskLevel') ? parseInt(document.getElementById('editTaskLevel').value) : null;
            const taskReferralCount = document.getElementById('editTaskReferralCount') ? parseInt(document.getElementById('editTaskReferralCount').value) : null;
            
            if (!taskName || !taskReward || isNaN(taskReward)) {
                showNotification("❌ Barcha maydonlarni to'ldiring!", 'error');
            }
            
            // Additional validation for level and referral tasks
            if (taskType === 'level' && (!taskLevel || isNaN(taskLevel) || taskLevel < 1)) {
                showNotification("❌ Level raqamini to'g'ri kiriting!", 'error');
            }
            
            if (taskType === 'referral' && (!taskReferralCount || isNaN(taskReferralCount) || taskReferralCount < 1)) {
                showNotification("❌ Referral sonini to'g'ri kiriting!", 'error');
            }
            
            const taskIndex = customTasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                customTasks[taskIndex] = {
                    customTasks[taskIndex],
                    type: taskType,
                    name: taskName,
                    description: taskDesc,
                    link: taskLink,
                    reward: taskReward,
                    code: taskCode,
                    level: taskLevel,
                    referralCount: taskReferralCount,
                    lastEdited: new Date().toLocaleDateString()
                };
                
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Save to Firebase for all players immediately
                saveGlobalTaskSettings();
                
                // Close modal
                closeEditTaskFormModal();
                
                showNotification(`✅ "${taskName}" vazifasi barcha o'yinchilar uchun tahrirlandi!`, 'success');
                
                // Update display immediately
                updateTasksDisplay();
                
                // Show notification about category change if applicable
                const categoryName = getCategoryName(taskType);
                setTimeout(() => {
                    showNotification(`📍 Vazifa "${categoryName}" bo'limiga ko'chirildi!`, 'success');
                }, 2000);
            }
        }

        // Progressive boost system
        const boostLevels = {
            tapPower: [
                { level: 2, value: 2, cost: 1000, description: '+1 coin per tap' },
                { level: 3, value: 3, cost: 2500, description: '+2 coins per tap' },
                { level: 5, value: 5, cost: 6000, description: '+4 coins per tap' },
                { level: 10, value: 10, cost: 15000, description: '+9 coins per tap' }
            ],
            energy: [
                { level: 2, value: 1500, cost: 1500, description: '1,500 max energy' },
                { level: 3, value: 2500, cost: 3500, description: '2,500 max energy' },
                { level: 5, value: 5000, cost: 8500, description: '5,000 max energy' }
            ],
            multitap: [
                { level: 2, value: 2, cost: 2000, description: '+1 tap per click' },
                { level: 3, value: 3, cost: 5000, description: '+2 taps per click' },
                { level: 5, value: 5, cost: 12000, description: '+4 taps per click' }
            ],
            recharge: [
                { level: 2, value: 3000, cost: 3000, description: '+1 energy per 3 seconds' },
                { level: 3, value: 2000, cost: 7500, description: '+1 energy per 2 seconds' },
                { level: 5, value: 1000, cost: 18000, description: '+1 energy per 1 second' }
            ]
        };

        function getNextBoostLevel(boostType) {
            const levels = boostLevels[boostType];
            const currentLevel = gameState.boosts[boostType === 'energy' ? 'maxEnergy' : boostType];
            
            for (let boost of levels) {
                if (boostType === 'tapPower' && boost.value > currentLevel) return boost;
                if (boostType === 'energy' && boost.value > currentLevel) return boost;
                if (boostType === 'multitap' && boost.value > currentLevel) return boost;
                if (boostType === 'recharge' && boost.value < gameState.rechargeSpeed) return boost;
            }
            return null; // Max level reached
        }

        function buyCurrentTapPowerBoost() {
            const nextBoost = getNextBoostLevel('tapPower');
            if (!nextBoost) {
                showNotification("✅ Tap Power maksimal darajada!", 'success');
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification("❌ Yetarli coin yo'q!", 'error');
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.tapPower = nextBoost.value;
            gameState.tapPower = nextBoost.value;
            
            showNotification(`✅ Tap Power Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentEnergyBoost() {
            const nextBoost = getNextBoostLevel('energy');
            if (!nextBoost) {
                showNotification("✅ Energy maksimal darajada!", 'success');
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification("❌ Yetarli coin yo'q!", 'error');
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.maxEnergy = nextBoost.value;
            gameState.maxEnergy = nextBoost.value;
            gameState.energy = nextBoost.value; // Fill energy when upgrading
            
            showNotification(`✅ Max Energy Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentMultitapBoost() {
            const nextBoost = getNextBoostLevel('multitap');
            if (!nextBoost) {
                showNotification("✅ Multitap maksimal darajada!", 'success');
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification("❌ Yetarli coin yo'q!", 'error');
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.multitap = nextBoost.value;
            gameState.multitap = nextBoost.value;
            
            showNotification(`✅ Multitap Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentRechargeBoost() {
            const nextBoost = getNextBoostLevel('recharge');
            if (!nextBoost) {
                showNotification("✅ Energy Recharge maksimal darajada!", 'success');
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification("❌ Yetarli coin yo'q!", 'error');
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.rechargeSpeed = nextBoost.value;
            gameState.boosts.rechargeSpeed = nextBoost.value;
            
            showNotification(`✅ Energy Recharge Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        // Special boosts (unchanged)
        function buyBoost(boostType, value, cost) {
            // Check if player has enough coins
            if (gameState.balance < cost) {
                showNotification("❌ Yetarli coin yo'q!", 'error');
            }

            switch (boostType) {
                case 'energyRefill':
                    gameState.balance -= cost;
                    gameState.energy = gameState.maxEnergy;
                    showNotification("✅ Energiya to'ldirildi!", 'success');
                    break;

                case 'turbo':
                    gameState.balance -= cost;
                    gameState.activeBoosts.turbo = {
                        active: true,
                        endTime: Date.now() + (20 * 1000) // 20 seconds
                    };
                    showNotification("✅ Turbo 20 soniyaga faollashtirildi!", 'success');
                    break;
            }

            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function updateBoostDisplay() {
            // Update current boost status
            document.getElementById('currentTapPower').textContent = gameState.boosts.tapPower;
            document.getElementById('currentMaxEnergy').textContent = gameState.boosts.maxEnergy;
            document.getElementById('currentMultitap').textContent = gameState.boosts.multitap;

            // Update progressive boost displays
            updateProgressiveBoostDisplay('tapPower', 'tapPowerBoostCurrent');
            updateProgressiveBoostDisplay('energy', 'energyBoostCurrent');
            updateProgressiveBoostDisplay('multitap', 'multitapBoostCurrent');
            updateProgressiveBoostDisplay('recharge', 'rechargeBoostCurrent');

            // Update active boosts
            updateActiveBoosts();
        }

        function updateProgressiveBoostDisplay(boostType, elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const nextBoost = getNextBoostLevel(boostType);
            
            if (!nextBoost) {
                // Max level reached
                element.innerHTML = `
                    <div class="condition-text">
                        <div style="font-weight: bold; color: #00ff88;">✅ ${getBoostTitle(boostType)} - MAX LEVEL</div>
                        <div style="font-size: 12px; color: #ccc;">Maksimal darajaga yetildi</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="color: #00ff88; font-weight: bold;">MAX</div>
                        <div class="condition-status condition-completed"></div>
                    </div>
                `;
                element.classList.add('completed');
                element.onclick= null;
            } else {
                // Show next level
                const canAfford = gameState.balance >= nextBoost.cost;
                element.innerHTML = `
                    <div class="condition-text">
                        <div style="font-weight: bold;">${getBoostEmoji(boostType, nextBoost.level)} ${getBoostTitle(boostType)} Level ${nextBoost.level}</div>
                        <div style="font-size: 12px; color: #ccc;">${nextBoost.description}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="condition-reward" style="color: ${canAfford ? '#00ff88' : '#ff6b35'}">${nextBoost.cost.toLocaleString()} DRC</div>
                        <div class="condition-status ${canAfford ? 'condition-completed' : 'condition-pending'}"></div>
                    </div>
                `;
                element.classList.remove('completed');
                if (canAfford) {
                    element.classList.add('task-ready');
                } else {
                    element.classList.remove('task-ready');
                }
            }
        }

        function getBoostTitle(boostType) {
            switch (boostType) {
                case 'tapPower': return 'Tap Power';
                case 'energy': return 'Energy Limit';
                case 'multitap': return 'Multitap';
                case 'recharge': return 'Energy Recharge';
                default: return 'Boost';
            }
        }

        function getBoostEmoji(boostType, level) {
            const emojis = {
                tapPower: '⚡',
                energy: '🔋',
                multitap: '👆',
                recharge: '⚡'
            };
            return emojis[boostType].repeat(Math.min(level - 1, 3));
        }

        function updateActiveBoosts() {
            const activeBoostsSection = document.getElementById('activeBoostsSection');
            const activeBoostsList = document.getElementById('activeBoostsList');
            
            const activeBoosts = [];
            const now = Date.now();
            
            // Check turbo
            if (gameState.activeBoosts.turbo.active && gameState.activeBoosts.turbo.endTime > now) {
                const timeLeft = Math.ceil((gameState.activeBoosts.turbo.endTime - now) / 1000);
                activeBoosts.push({
                    name: '🚀 Turbo',
                    timeLeft: `${timeLeft} soniya qoldi`
                });
            } else if (gameState.activeBoosts.turbo.active) {
                gameState.activeBoosts.turbo.active = false;
            }
            
            if (activeBoosts.length > 0) {
                activeBoostsSection.style.display = 'block';
                activeBoostsList.innerHTML = activeBoosts.map(boost => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0, 255, 136, 0.05); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(0, 255, 136, 0.2);">
                        <div style="font-weight: bold; color: #00ff88;">${boost.name}</div>
                        <div style="color: #ccc; font-size: 12px;">${boost.timeLeft}</div>
                    </div>
                `).join('');
            } else {
                activeBoostsSection.style.display = 'none';
            }
        }

        // Start the game when page loads
        window.addEventListener('load', initGame);
        
        // Save before page unload
        window.addEventListener('beforeunload', saveGameState);
    </script>
<script></script>
<script>
// Safe fallback for tapCoin to avoid "tapCoin is not defined" errors.
// If your app has its own tap handler, this will try to call it (tap or handleTap).
function tapCoin(e){
    try {
        if (typeof tap === 'function') { return tap(e); }
        if (typeof handleTap === 'function') { return handleTap(e); }
    } catch (err) {
        console.error('tapCoin wrapper error:', err);
    }
    // Minimal fallback: if there's a global variable for coins, increment it for UX purposes.
    try {
        if (typeof window.coins === 'number') {
            window.coins += 1;
            console.log('tapCoin: coins incremented to', window.coins);
        }
    } catch(err) {}
    // No-op otherwise to prevent JS errors.
    return;
}
</script>

<script>
// Attach touch handlers to mainCoin safely (prevents default scrolling but not break parsing)
try {
  document.addEventListener('DOMContentLoaded', function() {
    const mainCoin = document.getElementById('mainCoin');
    if (mainCoin) {
      mainCoin.addEventListener('touchend', function(e){ e.preventDefault(); }, {passive:false});
      mainCoin.addEventListener('touchmove', function(e){ e.preventDefault(); }, {passive:false});
    }
  });
} catch (e) { console.warn('Touch listener attach failed', e); }
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function safeCall(fnName, arg) {
    try {
      if (typeof window[fnName] === 'function') {
        window[fnName](arg);
      } else {
        console.warn(fnName + ' is not defined');
      }
    } catch (e) { console.error('Error calling', fnName, e); }
  }

  var map = {
    'tapTab': 'tap',
    'tasksTab': 'tasks',
    'referralTab': 'referral',
    'leaderboardTab': 'leaderboard',
    'boostTab': 'boost',
    'adminTab': 'admin',
    'profileTab': 'profile'
  };
  Object.keys(map).forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.addEventListener('click', function(){ safeCall('showSection', map[id]); });
  });

  var mainCoin = document.getElementById('mainCoin');
  if (mainCoin) {
    mainCoin.addEventListener('click', function(e){ safeCall('tapCoin', e); });
    mainCoin.addEventListener('touchstart', function(e){ safeCall('tapCoin', e); }, {passive:false});
  }
});
</script>

<script>
// Global event delegation for buttons and elements with data-action or id-based mapping.
// This prevents inline JS and reduces syntax errors from malformed attributes.
document.addEventListener('DOMContentLoaded', function() {
  document.body.addEventListener('click', function(e) {
    var el = e.target;
    // climb up to button if clicked on inner span
    while (el && el !== document.body) {
      if (el.dataset && el.dataset.action) {
        var parts = el.dataset.action.split(':');
        var fn = parts[0];
        var arg = parts.slice(1).join(':');
        try { if (typeof window[fn] === 'function') window[fn](arg || e); else console.warn(fn + ' is not a function'); } catch(err) { console.error(err); }
        return;
      }
      if (el.id) {
        // mapping for known nav ids
        var map = { 'tapTab':'tap','tasksTab':'tasks','referralTab':'referral','leaderboardTab':'leaderboard','boostTab':'boost','adminTab':'admin','profileTab':'profile' };
        if (map[el.id]) {
          var fnName = 'showSection';
          try { if (typeof window[fnName] === 'function') window[fnName](map[el.id]); else console.warn(fnName + ' not defined'); } catch(err) { console.error(err); }
          return;
        }
      }
      el = el.parentElement;
    }
  }, false);

  // attach touch handlers to mainCoin safely
  var mainCoin = document.getElementById('mainCoin');
  if (mainCoin) {
    mainCoin.addEventListener('click', function(e){ if (typeof window.tapCoin === 'function') window.tapCoin(e); }, false);
    mainCoin.addEventListener('touchstart', function(e){ if (typeof window.tapCoin === 'function') window.tapCoin(e); }, {passive:false});
  }

  // Firebase check
  if (!window.firebase) {
    console.warn('Firebase SDK not detected. Firebase features will not work until firebase JS SDK and config are added.');
  }
});
</script>
</body>


</html>
