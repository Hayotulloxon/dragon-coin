<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: wss: data: blob:; connect-src 'self' https: wss: *.firebasedatabase.app *.googleapis.com *.gstatic.com; frame-src 'self' https: *.firebasedatabase.app *.googleapis.com *.gstatic.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: *.gstatic.com *.googleapis.com *.firebasedatabase.app; style-src 'self' 'unsafe-inline' https:;">
    <title>Dragon Coin - Tap to Earn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
    import { getDatabase, ref, set, get, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDShZAo9lg-SxpQViCT27uXVni1UK7TGYU",
        authDomain: "dragon-92897.firebaseapp.com",
        databaseURL: "https://dragon-92897-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "dragon-92897",
        storageBucket: "dragon-92897.firebasestorage.app",
        messagingSenderId: "40351345340",
        appId: "1:40351345340:web:632388a9b45d3c7905feb9",
        measurementId: "G-FXT1F3NPCD"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);
    const auth = getAuth(app);

    signInAnonymously(auth)
      .then(() => console.log("‚úÖ Anonymous login yuborildi"))
      .catch((error) => console.error("‚ùå Login xatosi:", error));

    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("üë§ Auth UID:", user.uid);
            window.firebaseApp = app;
            window.firebaseDatabase = database;
            window.firebaseRef = ref;
            window.firebaseSet = set;
            window.firebaseGet = get;
            window.firebaseOnValue = onValue;
            window.firebasePush = push;
            window.firebaseUpdate = update;
            window.firebaseRemove = remove;
            window.firebaseAuthUid = user.uid;

            // FIX: players path matches rules exactly
            const playerRef = ref(database, "players/" + user.uid);
            set(playerRef, { name: "Dragon Miner", coins: 0, level: 1 })
                .then(() => console.log("‚úÖ Player ma'lumotlari yozildi"))
                .catch((err) => console.error("‚ùå Player yozishda xato:", err));

            const tasksRef = ref(database, "globalCustomTasks");
            get(tasksRef)
                .then((snapshot) => {
                    if (snapshot.exists()) console.log("üìã Global tasks:", snapshot.val());
                    else console.log("‚ö†Ô∏è Global tasks topilmadi");
                })
                .catch((err) => console.error("‚ùå Global tasks o‚Äòqishda xato:", err));

            const settingsRef = ref(database, "globalTaskSettings");
            get(settingsRef)
                .then((snapshot) => {
                    if (snapshot.exists()) console.log("‚öôÔ∏è Global task settings:", snapshot.val());
                    else console.log("‚ö†Ô∏è Global task settings topilmadi");
                })
                .catch((err) => console.error("‚ùå Global task settings o‚Äòqishda xato:", err));
        }
    });
</script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a0a1a 25%, #0f0a1a 50%, #1a1a0f 75%, #0a0f1a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 98px,
                    rgba(0, 255, 136, 0.03) 100px
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 98px,
                    rgba(255, 107, 53, 0.03) 100px
                );
            pointer-events: none;
            z-index: -1;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        .firebase-status {
            position: fixed;
            top: 70px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            transition: all 0.5s ease;
            opacity: 1;
        }

        .firebase-connected {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .firebase-disconnected {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
            border: 1px solid #ff6b35;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .level-badge {
            background: #00ff88;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .energy-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .energy-fill {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .energy-progress {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .main-container {
            padding: 20px;
            text-align: center;
        }

        .navigation-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000000;
            border-color: #00ff88;
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .balance-display {
            margin-bottom: 30px;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
            text-shadow: 
                0 0 10px #00ff88,
                0 0 20px #00ff88,
                0 0 30px #00ff88,
                0 0 40px #00ff88;
            animation: balanceGlow 3s ease-in-out infinite alternate;
        }

        @keyframes balanceGlow {
            0% {
                text-shadow: 
                    0 0 10px #00ff88,
                    0 0 20px #00ff88,
                    0 0 30px #00ff88,
                    0 0 40px #00ff88;
            }
            100% {
                text-shadow: 
                    0 0 15px #00ff88,
                    0 0 30px #00ff88,
                    0 0 45px #00ff88,
                    0 0 60px #00ff88;
            }
        }

        .balance-label {
            color: #cccccc;
            font-size: 16px;
        }

        .coin-container {
            position: relative;
            margin: 40px auto;
            width: 280px;
            height: 280px;
            perspective: 1000px;
        }

        .main-coin {
            width: 280px;
            height: 280px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 25%, #FFD700 50%, #FFED4E 75%, #FFD700 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            cursor: pointer;
            transition: transform 0.05s ease;
            position: relative;
            overflow: hidden;
            border: 8px solid #FFA500;
            box-shadow: 
                0 20px 40px rgba(255, 165, 0, 0.4),
                0 10px 20px rgba(0, 0, 0, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.3),
                inset 0 -4px 8px rgba(255, 140, 0, 0.3);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            will-change: transform;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .main-coin::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 15%;
            width: 30%;
            height: 30%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
        }

        .main-coin:hover {
            transform: scale(1.02);
        }

        .main-coin:active {
            transform: scale(0.96) !important;
        }
        
        .main-coin.tap-animation {
            transform: scale(0.94);
            transition: transform 0.03s ease-out;
        }

        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            .main-coin {
                transition: transform 0.03s ease-out;
            }
            
            .main-coin:active {
                transform: scale(0.95) !important;
            }
            
            .main-coin.tap-animation {
                transform: scale(0.93);
                transition: transform 0.02s ease-out;
            }
        }

        .tap-effect {
            position: absolute;
            color: #00ff88;
            font-size: 28px;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 
                0 0 15px #00ff88,
                0 0 30px #00ff88,
                0 0 45px #00ff88,
                0 0 60px #00ff88;
            animation: neonFloatUp 1s ease-out forwards;
            z-index: 10;
            user-select: none;
            -webkit-user-select: none;
        }

        @keyframes neonFloatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(0.8);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(0, 255, 136, 0.6);
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }

        .stat-label {
            font-size: 12px;
            color: #cccccc;
            margin-top: 5px;
        }

        .conditions-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .condition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .condition-item:last-child {
            border-bottom: none;
        }

        .condition-item[style*="cursor: pointer"]:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .task-button {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .task-button.completed {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            cursor: default;
        }

        .task-button.completed:hover {
            transform: none;
            box-shadow: none;
        }

        .task-button.task-ready {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            animation: taskPulse 2s ease-in-out infinite;
        }

        @keyframes taskPulse {
            0% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
            100% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
        }

        .condition-text {
            flex: 1;
        }

        .condition-reward {
            color: #00ff88;
            font-weight: bold;
        }

        .condition-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .condition-completed {
            background: #00ff88;
        }

        .condition-pending {
            background: rgba(255, 255, 255, 0.3);
        }

        .completed-tasks-section {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .completed-task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .completed-task-item:last-child {
            margin-bottom: 0;
        }

        .completed-task-text {
            flex: 1;
            color: #00ff88;
        }

        .completed-task-reward {
            color: #00ff88;
            font-weight: bold;
            background: rgba(0, 255, 136, 0.2);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .completed-task-check {
            color: #00ff88;
            font-size: 18px;
            margin-left: 10px;
        }

        .section {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }

        .notification.error {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid #ff6b35;
            color: #ff6b35;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-selector:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .country-flag {
            font-size: 20px;
            margin-right: 8px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .main-container {
                padding: 15px;
            }

            .main-coin {
                width: 220px;
                height: 220px;
                font-size: 90px;
            }
            
            .coin-container {
                width: 220px;
                height: 220px;
                margin: 30px auto;
            }
            
            .balance-amount {
                font-size: 32px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 20px 0;
            }

            .navigation-tabs {
                gap: 4px;
                margin-bottom: 15px;
            }

            .nav-tab {
                padding: 8px 10px;
                font-size: 11px;
                flex: 1;
                min-width: 0;
            }
        }
    </style>
</head>
<body>

    <!-- Firebase Status Indicator -->
    <div class="firebase-status firebase-disconnected" id="firebaseStatus">
        üîÑ Firebase ulanmoqda...
    </div>

    <!-- Language Selector -->
    <div class="language-selector" onclick="toggleLanguage()">
        <span class="country-flag" id="countryFlag">üá∫üáø</span>
        <span id="languageText">UZ</span>
    </div>

    <div class="header">
        <div class="user-info">
            <div class="avatar">üêâ</div>
            <div>
                <div style="font-weight: bold;" id="playerName">Dragon Miner</div>
                <div class="level-badge" id="levelBadge">Level 1</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="energy-bar">
                <span>‚ö°</span>
                <div class="energy-fill">
                    <div class="energy-progress" id="energyProgress"></div>
                </div>
                <span id="energyText">1000/1000</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="navigation-tabs">
            <button class="nav-tab active" id="tapTab" onclick="showSection('tap')">üêâ <span data-translate="tap">Tapping</span></button>
            <button class="nav-tab" id="tasksTab" onclick="showSection('tasks')">üìã <span data-translate="tasks">Vazifalar</span></button>
            <button class="nav-tab" id="referralTab" onclick="showSection('referral')">üë• <span data-translate="referral">Referral</span></button>
            <button class="nav-tab" id="leaderboardTab" onclick="showSection('leaderboard')">üèÜ <span data-translate="leaderboard">Reyting</span></button>
            <button class="nav-tab" id="boostTab" onclick="showSection('boost')">‚ö° <span data-translate="boost">Boostlar</span></button>
            <button class="nav-tab" id="adminTab" onclick="showSection('admin')" style="display: none;">‚öôÔ∏è <span data-translate="admin">Admin</span></button>
            <button class="nav-tab" id="profileTab" onclick="showSection('profile')">üë§ <span data-translate="profile">Profil</span></button>
        </div>

        <div class="balance-display">
            <div class="balance-amount" id="balance">0</div>
            <div class="balance-label">Dragon Coins</div>
        </div>

        <div class="section" id="tapSection">
            <div class="coin-container">
                <div class="main-coin" id="mainCoin" 
                     onclick="tapCoin(event)" 
                     ontouchstart="tapCoin(event)" 
                     ontouchend="event.preventDefault()"
                     ontouchmove="event.preventDefault()">
                    <span style="
                        font-size: 120px; 
                        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                        z-index: 2;
                        position: relative;
                        pointer-events: none;
                    ">üêâ</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="tapPower">1</div>
                    <div class="stat-label" data-translate="coinsPerTap">Coins per tap</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTaps">0</div>
                    <div class="stat-label" data-translate="totalTaps">Total taps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label" data-translate="level">Level</div>
                    <div class="stat-label" id="levelName" style="color: #00ff88; font-size: 10px; margin-top: 2px;">Wood</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="referralCount">0</div>
                    <div class="stat-label" data-translate="referrals">Referrals</div>
                </div>
            </div>

            <!-- Level Progress Bar -->
            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="font-size: 16px; font-weight: bold;" id="currentLevelDisplay">Level 1 - Wood</div>
                    <div style="font-size: 14px; color: #ccc;" id="nextLevelDisplay">Next: Level 2 - Bronze</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgressBar" style="width: 0%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-top: 5px;">
                    <span id="currentTapsDisplay">0 taps</span>
                    <span id="requiredTapsDisplay">500 taps kerak</span>
                </div>
            </div>

            <div id="energyWarning" class="notification error" style="display: none; position: relative; top: auto; right: auto; margin: 20px 0;">
                <span data-translate="energyWarning">‚ö†Ô∏è Energy bo'sh! Energiya to'lishi uchun kutib turing.</span>
            </div>
        </div>

        <div class="section" id="tasksSection" style="display: none;">
            <!-- Task Categories Navigation -->
            <div style="display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap;">
                <button class="nav-tab active" id="basicTasksTab" onclick="showTaskCategory('basic')" style="padding: 8px 12px; font-size: 12px;">
                    üìã <span data-translate="basicTasks">Asosiy Vazifalar</span>
                </button>
                <button class="nav-tab" id="levelTasksTab" onclick="showTaskCategory('level')" style="padding: 8px 12px; font-size: 12px;">
                    üèÜ <span data-translate="levelTasks">Level Vazifalari</span>
                </button>
                <button class="nav-tab" id="referralTasksTab" onclick="showTaskCategory('referral')" style="padding: 8px 12px; font-size: 12px;">
                    üë• <span data-translate="referralTasks">Referral Vazifalari</span>
                </button>
                <button class="nav-tab" id="customTasksTab" onclick="showTaskCategory('custom')" style="padding: 8px 12px; font-size: 12px;">
                    ‚≠ê <span data-translate="customTasks">Maxsus Vazifalar</span>
                </button>
                <button class="nav-tab" id="completedTasksTab" onclick="showTaskCategory('completed')" style="padding: 8px 12px; font-size: 12px;">
                    ‚úÖ <span data-translate="completedTasks">Bajarilgan</span>
                    <span style="background: rgba(0, 255, 136, 0.3); color: #00ff88; padding: 2px 6px; border-radius: 8px; font-size: 10px; margin-left: 4px;" id="completedTasksTabCount">0</span>
                </button>
            </div>

            <!-- Basic Tasks Panel -->
            <div class="conditions-panel" id="basicTasksPanel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">üìã <span data-translate="basicTasks">Asosiy Vazifalar</span></h3>
                <div id="basicTasksList">
                    <!-- Basic tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Level Tasks Panel -->
            <div class="conditions-panel" id="levelTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #FFD700;">üèÜ <span data-translate="levelTasks">Level Vazifalari</span></h3>
                <div id="levelTasksList">
                    <!-- Level tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Referral Tasks Panel -->
            <div class="conditions-panel" id="referralTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #8A2BE2;">üë• <span data-translate="referralTasks">Referral Vazifalari</span></h3>
                <div id="referralTasksList">
                    <!-- Referral tasks will be populated dynamically -->
                </div>
            </div>

            <!-- Custom Tasks Panel -->
            <div class="conditions-panel" id="customTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #00ff88;">‚≠ê <span data-translate="customTasks">Maxsus Vazifalar</span></h3>
                <div id="customTasksList">
                    <!-- Custom tasks will be populated here -->
                </div>
            </div>

            <!-- Completed Tasks Panel -->
            <div class="conditions-panel" id="completedTasksPanel" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #00ff88; display: flex; align-items: center; gap: 10px;">
                    ‚úÖ <span data-translate="completedTasks">Bajarilgan Vazifalar</span>
                    <span style="background: rgba(0, 255, 136, 0.2); color: #00ff88; padding: 4px 8px; border-radius: 12px; font-size: 12px;" id="completedTasksCount">0</span>
                </h3>
                <div id="completedTasksList">
                    <!-- Completed tasks will be populated here -->
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div class="section" id="referralSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">üë• <span data-translate="referralSystem">Referral Tizimi</span></h3>
                
                <div style="margin-bottom: 20px;">
                    <h4 data-translate="yourReferralLink">Sizning referral linkingiz:</h4>
                    <div style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; border-radius: 10px; padding: 15px; margin: 15px 0; word-break: break-all; font-family: monospace; font-size: 14px;" id="referralLink">
                        https://t.me/Dragon_coin_money_bot?start=ref_<span id="userReferralCode">123456</span>
                    </div>
                    <button style="background: #00ff88; color: #000; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px 0; transition: all 0.3s ease;" onclick="copyReferralLink()">
                        üìã <span data-translate="copyLink">Linkni nusxalash</span>
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label" data-translate="totalReferrals">Jami referrallar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="referralEarnings">0</div>
                        <div class="stat-label" data-translate="referralEarnings">Referral daromadi</div>
                    </div>
                </div>

                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 10px; padding: 15px; margin: 20px 0;">
                    <h4 data-translate="referralRewards">Referral mukofotlari:</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li data-translate="reward1">Har bir referral uchun: +500 DRC</li>
                        <li data-translate="reward2">Referral birinchi marta tap qilganda: +200 DRC</li>
                        <li data-translate="reward3">Referral Level 5 ga yetganda: +1000 DRC</li>
                        <li data-translate="reward4">Referral 10000 coin to'plaganda: +2000 DRC</li>
                    </ul>
                </div>

                <h4 data-translate="yourReferrals">Sizning referrallaringiz:</h4>
                <div id="referralList">
                    <div style="text-align: center; color: #ccc; padding: 20px;" data-translate="noReferrals">
                        Hali referrallaringiz yo'q. Do'stlaringizni taklif qiling!
                    </div>
                </div>
            </div>
        </div>

        <!-- Boost Section -->
        <div class="section" id="boostSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">‚ö° <span data-translate="boost">Boostlar</span></h3>
                
                <!-- Current Stats -->
                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="currentTapPower">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="tapPower">Tap Power</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="currentMaxEnergy">1000</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="maxEnergy">Max Energy</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="currentMultitap">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="multitap">Multitap</div>
                        </div>
                    </div>
                </div>

                <!-- Tap Power Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">üëÜ <span data-translate="tapPowerBoosts">Tap Power</span></h4>
                    
                    <div class="condition-item task-button" onclick="buyCurrentTapPowerBoost()" id="tapPowerBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Energy Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #ff6b35; margin-bottom: 15px;">üîã <span data-translate="energyBoosts">Energy Limit</span></h4>
                    
                    <div class="condition-item task-button" onclick="buyCurrentEnergyBoost()" id="energyBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Multitap Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">üëÜ <span data-translate="multitapBoosts">Multitap</span></h4>
                    
                    <div class="condition-item task-button" onclick="buyCurrentMultitapBoost()" id="multitapBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Energy Recharge Boosts -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">‚ö° <span data-translate="rechargeBoosts">Energy Recharging Speed</span></h4>
                    
                    <div class="condition-item task-button" onclick="buyCurrentRechargeBoost()" id="rechargeBoostCurrent">
                        <!-- Content will be dynamically updated -->
                    </div>
                </div>

                <!-- Special Boosts -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">üåü <span data-translate="specialBoosts">Special Boosts</span></h4>
                    
                    <div class="condition-item task-button" onclick="buyBoost('energyRefill', 1, 500)" id="energyRefillBoost">
                        <div class="condition-text">
                            <div style="font-weight: bold;">‚ö° Full Energy</div>
                            <div style="font-size: 12px; color: #ccc;">Instantly refill energy</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="condition-reward">500 DRC</div>
                            <div class="condition-status condition-pending" id="energyRefillStatus"></div>
                        </div>
                    </div>

                    <div class="condition-item task-button" onclick="buyBoost('turbo', 1, 2500)" id="turboBoost">
                        <div class="condition-text">
                            <div style="font-weight: bold;">üöÄ Turbo (20 seconds)</div>
                            <div style="font-size: 12px; color: #ccc;">Unlimited energy for 20 seconds</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="condition-reward">2,500 DRC</div>
                            <div class="condition-status condition-pending" id="turboStatus"></div>
                        </div>
                    </div>
                </div>

                <!-- Active Boosts -->
                <div id="activeBoostsSection" style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0; display: none;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">üî• <span data-translate="activeBoosts">Active Boosts</span></h4>
                    <div id="activeBoostsList">
                        <!-- Active boosts will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="section" id="leaderboardSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">üèÜ <span data-translate="leaderboard">Reyting Jadvali</span></h3>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                    <button class="nav-tab active" id="coinsLeaderboard" onclick="showLeaderboard('coins')" style="padding: 8px 16px;">
                        üí∞ <span data-translate="byCoins">Coinlar bo'yicha</span>
                    </button>
                    <button class="nav-tab" id="referralsLeaderboard" onclick="showLeaderboard('referrals')" style="padding: 8px 16px;">
                        üë• <span data-translate="byReferrals">Referrallar bo'yicha</span>
                    </button>
                </div>

                <div style="background: rgba(0, 255, 136, 0.1); border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 18px; font-weight: bold; color: #00ff88;" data-translate="yourRank">Sizning o'rningiz:</div>
                    <div style="font-size: 24px; font-weight: bold; margin-top: 5px;" id="playerRank">#-</div>
                </div>

                <div id="leaderboardList">
                    <!-- Leaderboard items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Player Profile Modal -->
        <div id="playerProfileModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; backdrop-filter: blur(10px);">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 15, 0.95); border-radius: 20px; padding: 30px; max-width: 400px; width: 90%; border: 2px solid rgba(0, 255, 136, 0.3); box-shadow: 0 0 50px rgba(0, 255, 136, 0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #00ff88; margin: 0;">üë§ <span data-translate="playerProfile">O'yinchi Profili</span></h3>
                    <button onclick="closePlayerModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">√ó</button>
                </div>
                
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #ff6b35, #f7931e); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 15px;">üêâ</div>
                    <h2 style="color: #00ff88; margin-bottom: 5px;" id="modalPlayerName">Player Name</h2>
                    <div style="color: #ccc; font-size: 14px;" id="modalPlayerCountry">üá∫üáø UZ</div>
                    <div style="color: #ccc; font-size: 12px; margin-top: 5px;" id="modalPlayerStatus">üü¢ Online</div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px; border: 1px solid rgba(0, 255, 136, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #00ff88;" id="modalPlayerBalance">0</div>
                        <div style="font-size: 12px; color: #ccc;">Dragon Coins</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px; border: 1px solid rgba(255, 107, 53, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #ff6b35;" id="modalPlayerLevel">1</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="level">Level</div>
                        <div style="font-size: 10px; color: #ff6b35; margin-top: 2px;" id="modalPlayerLevelName">Wood</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #FFD700;" id="modalPlayerTaps">0</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="totalTaps">Total Taps</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px; border: 1px solid rgba(138, 43, 226, 0.3);">
                        <div style="font-size: 20px; font-weight: bold; color: #8A2BE2;" id="modalPlayerReferrals">0</div>
                        <div style="font-size: 12px; color: #ccc;" data-translate="referrals">Referrals</div>
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="color: #00ff88; margin-bottom: 10px; font-size: 14px;">üìä <span data-translate="playerStats">O'yinchi Statistikasi</span></h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="rankPosition">Reyting pozitsiyasi:</span>
                        <span style="color: #00ff88; font-weight: bold; font-size: 12px;" id="modalPlayerRank">#1</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="lastSeen">Oxirgi faollik:</span>
                        <span style="color: #ccc; font-size: 12px;" id="modalPlayerLastSeen">Hozir</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #ccc; font-size: 12px;" data-translate="playerType">O'yinchi turi:</span>
                        <span style="color: #00ff88; font-size: 12px;" id="modalPlayerType">Real Player</span>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button onclick="closePlayerModal()" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                        <span data-translate="close">Yopish</span>
                    </button>
                    <button onclick="challengePlayer()" style="flex: 1; background: linear-gradient(45deg, #00ff88, #00cc6a); border: none; color: #000; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                        <span data-translate="challenge">Raqobat</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div class="section" id="adminSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">‚öôÔ∏è <span data-translate="admin">Admin Panel</span></h3>
                
                <!-- Player Management -->
                <div style="background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #ff6b35; margin-bottom: 15px;">üë• <span data-translate="playerManagement">O'yinchi Boshqaruvi</span></h4>
                    
                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="totalPlayers">Jami o'yinchilar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="registeredUsers">Ro'yxatdan o'tgan foydalanuvchilar</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;" id="totalPlayersCount">0</div>
                    </div>

                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="onlinePlayers">Online o'yinchilar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentlyActive">Hozir faol</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;" id="onlinePlayersCount">0</div>
                    </div>

                    <div class="condition-item">
                        <div>
                            <div style="font-weight: bold;" data-translate="totalCoins">Jami coinlar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="systemWide">Tizim bo'ylab</div>
                        </div>
                        <div style="color: #FFD700; font-weight: bold;" id="totalCoinsCount">0</div>
                    </div>
                </div>

                <!-- System Controls -->
                <div style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">üéÆ <span data-translate="systemControls">Tizim Boshqaruvi</span></h4>
                    
                    <div class="condition-item task-button" onclick="adminAction('addCoins')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="addCoinsToPlayer">O'yinchiga coin qo'shish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="addCoinsDesc">Tanlangan o'yinchiga coin berish</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">üí∞</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('resetPlayer')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="resetPlayer">O'yinchini qayta boshlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="resetPlayerDesc">O'yinchi ma'lumotlarini tozalash</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">üîÑ</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('broadcastMessage')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="broadcastMessage">Umumiy xabar</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="broadcastDesc">Barcha o'yinchilarga xabar yuborish</div>
                        </div>
                        <div style="color: #8A2BE2; font-weight: bold;">üì¢</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('systemMaintenance')">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="systemMaintenance">Tizim texnik xizmati</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="maintenanceDesc">Tizimni texnik xizmatga o'tkazish</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">üîß</div>
                    </div>
                </div>

                <!-- Task Management -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">üìã <span data-translate="taskManagement">Vazifa Boshqaruvi</span></h4>
                    
                    <div class="condition-item task-button" onclick="adminAction('addTask')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="addNewTask">Yangi vazifa qo'shish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="addTaskDesc">Tizimga yangi vazifa qo'shish</div>
                        </div>
                        <div style="color: #FFD700; font-weight: bold;">‚ûï</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('removeTask')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="removeTask">Vazifani o'chirish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="removeTaskDesc">Mavjud vazifani o'chirish</div>
                        </div>
                        <div style="color: #ff6b35; font-weight: bold;">‚ûñ</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('editTask')" style="margin-bottom: 10px;">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="editTask">Vazifani tahrirlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="editTaskDesc">Mavjud vazifa ma'lumotlarini o'zgartirish</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">‚úèÔ∏è</div>
                    </div>

                    <div class="condition-item task-button" onclick="adminAction('viewTasks')">
                        <div class="condition-text">
                            <div style="font-weight: bold;" data-translate="viewAllTasks">Barcha vazifalarni ko'rish</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="viewTasksDesc">Tizimda mavjud barcha vazifalar</div>
                        </div>
                        <div style="color: #8A2BE2; font-weight: bold;">üëÅÔ∏è</div>
                    </div>
                </div>

                <!-- Game Statistics -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px;">üìä <span data-translate="gameStatistics">O'yin Statistikasi</span></h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="totalTapsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="totalTapsSystem">Jami taplar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #8A2BE2;" id="totalReferralsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="totalReferralsSystem">Jami referrallar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="completedTasksSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="completedTasksSystem">Bajarilgan vazifalar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="activeBoostsSystem">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="activeBoostsSystem">Faol boostlar</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">üìà <span data-translate="recentActivity">So'nggi Faollik</span></h4>
                    <div id="recentActivityList">
                        <!-- Recent activity will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div class="section" id="profileSection" style="display: none;">
            <div class="conditions-panel">
                <h3 style="margin-bottom: 15px; color: #ff6b35;">üë§ <span data-translate="profile">Foydalanuvchi Profili</span></h3>
                
                <!-- User Avatar and Basic Info -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(45deg, #ff6b35, #f7931e); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 50px; margin: 0 auto 15px;">üêâ</div>
                    <h2 style="color: #00ff88; margin-bottom: 5px;" id="profilePlayerName">Dragon Miner</h2>
                    <div style="color: #ccc; font-size: 14px;" id="profilePlayerId">ID: loading...</div>
                    <div style="color: #ccc; font-size: 14px; margin-top: 5px;">
                        <span data-translate="joinedDate">Qo'shilgan sana:</span> <span id="profileJoinDate">2024</span>
                    </div>
                </div>

                <!-- Detailed Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-value" id="profileBalance">0</div>
                        <div class="stat-label">Dragon Coins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileLevel">1</div>
                        <div class="stat-label" data-translate="level">Level</div>
                        <div class="stat-label" id="profileLevelName" style="color: #00ff88; font-size: 10px; margin-top: 2px;">Wood</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileTotalTaps">0</div>
                        <div class="stat-label" data-translate="totalTaps">Jami taplar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileReferrals">0</div>
                        <div class="stat-label" data-translate="referrals">Referrallar</div>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #FFD700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        üèÜ <span data-translate="achievements">Yutuqlar</span>
                        <span style="background: rgba(255, 215, 0, 0.2); color: #FFD700; padding: 4px 8px; border-radius: 12px; font-size: 12px;" id="achievementsCount">0</span>
                    </h4>
                    <div id="achievementsList">
                        <!-- Achievements will be populated here -->
                    </div>
                </div>

                <!-- Game Statistics -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">üìä <span data-translate="gameStats">O'yin Statistikasi</span></h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="profileTapPower">1</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="tapPower">Tap kuchi</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;" id="profileEnergy">1000</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentEnergy">Hozirgi energiya</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;" id="profileCompletedTasks">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="completedTasksCount">Bajarilgan vazifalar</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #8A2BE2;" id="profileReferralEarnings">0</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="referralEarnings">Referral daromadi</div>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #00ff88; margin-bottom: 15px;">‚öôÔ∏è <span data-translate="settings">Sozlamalar</span></h4>
                    
                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="language">Til</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="currentLanguage">Hozirgi til</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="currentLanguageDisplay">üá∫üáø UZ</span>
                            <button onclick="toggleLanguage()" style="background: #00ff88; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                <span data-translate="change">O'zgartirish</span>
                            </button>
                        </div>
                    </div>

                    <div class="condition-item" style="margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: bold;" data-translate="dataStorage">Ma'lumotlar saqlash</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="localStorage">Mahalliy xotira</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">
                            <span data-translate="active">Faol</span> ‚úÖ
                        </div>
                    </div>

                    <div class="condition-item">
                        <div>
                            <div style="font-weight: bold;" data-translate="firebaseSync">Firebase sinxronizatsiya</div>
                            <div style="font-size: 12px; color: #ccc;" data-translate="cloudSync">Bulut sinxronizatsiya</div>
                        </div>
                        <div id="firebaseSyncStatus" style="color: #ff6b35; font-weight: bold;">
                            <span data-translate="checking">Tekshirilmoqda...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Multi-language support
        const translations = {
            uz: {
                tap: "Tapping",
                tasks: "Vazifalar",
                referral: "Referral",
                leaderboard: "Reyting",
                coinsPerTap: "Har tap uchun coin",
                totalTaps: "Jami taplar",
                level: "Level",
                referrals: "Referrallar",
                energyWarning: "‚ö†Ô∏è Energy bo'sh! Energiya to'lishi uchun kutib turing.",
                task500taps: "500 marta tap qiling",
                taskLevel5: "Level 5 ga yeting",
                task10000coins: "10000 coin to'plang",
                taskReferral: "5 ta do'st taklif qiling",
                taskTelegram: "Telegram kanalga obuna bo'ling",
                taskYoutube: "YouTube kanalga obuna bo'ling",
                taskCode: "Maxsus kodni kiriting",
                progress: "Progress",
                currentLevel: "Hozirgi level",
                referralSystem: "Referral Tizimi",
                yourReferralLink: "Sizning referral linkingiz:",
                copyLink: "Linkni nusxalash",
                totalReferrals: "Jami referrallar",
                referralEarnings: "Referral daromadi",
                referralRewards: "Referral mukofotlari:",
                reward1: "Har bir referral uchun: +500 DRC",
                reward2: "Referral birinchi marta tap qilganda: +200 DRC",
                reward3: "Referral Level 5 ga yetganda: +1000 DRC",
                reward4: "Referral 10000 coin to'plaganda: +2000 DRC",
                yourReferrals: "Sizning referrallaringiz:",
                noReferrals: "Hali referrallaringiz yo'q. Do'stlaringizni taklif qiling!",
                byCoins: "Coinlar bo'yicha",
                byReferrals: "Referrallar bo'yicha",
                yourRank: "Sizning o'rningiz:",
                completedTasks: "Bajarilgan Vazifalar",
                profile: "Profil",
                joinedDate: "Qo'shilgan sana",
                achievements: "Yutuqlar",
                gameStats: "O'yin Statistikasi",
                tapPower: "Tap kuchi",
                currentEnergy: "Hozirgi energiya",
                completedTasksCount: "Bajarilgan vazifalar",
                settings: "Sozlamalar",
                language: "Til",
                currentLanguage: "Hozirgi til",
                change: "O'zgartirish",
                dataStorage: "Ma'lumotlar saqlash",
                localStorage: "Mahalliy xotira",
                active: "Faol",
                firebaseSync: "Firebase sinxronizatsiya",
                cloudSync: "Bulut sinxronizatsiya",
                checking: "Tekshirilmoqda",
                playerProfile: "O'yinchi Profili",
                playerStats: "O'yinchi Statistikasi",
                rankPosition: "Reyting pozitsiyasi",
                lastSeen: "Oxirgi faollik",
                playerType: "O'yinchi turi",
                close: "Yopish",
                challenge: "Raqobat",
                boost: "Boostlar",
                currentBoosts: "Hozirgi Boostlar",
                maxEnergy: "Max energiya",
                tapPowerBoosts: "Tap Kuchi Boostlari",
                tapPowerDesc: "Har tap uchun 2 coin oling",
                tapPowerDesc2: "Har tap uchun 3 coin oling",
                tapPowerDesc3: "Har tap uchun 5 coin oling",
                tapPowerDesc4: "Har tap uchun 10 coin oling",
                energyBoosts: "Energiya Boostlari",
                energyDesc: "Max energiya 1500 ga oshadi",
                energyDesc2: "Max energiya 2500 ga oshadi",
                energyDesc3: "Max energiya 5000 ga oshadi",
                specialBoosts: "Maxsus Boostlar",
                autoTapDesc: "1 soat davomida avtomatik tap",
                energyRefillDesc: "Energiyani darhol to'ldiradi",
                doubleCoinsDesc: "30 daqiqa ikki barobar coin",
                activeBoosts: "Faol Boostlar",
                admin: "Admin",
                playerManagement: "O'yinchi Boshqaruvi",
                totalPlayers: "Jami o'yinchilar",
                registeredUsers: "Ro'yxatdan o'tgan foydalanuvchilar",
                onlinePlayers: "Online o'yinchilar",
                currentlyActive: "Hozir faol",
                totalCoins: "Jami coinlar",
                systemWide: "Tizim bo'ylab",
                systemControls: "Tizim Boshqaruvi",
                addCoinsToPlayer: "O'yinchiga coin qo'shish",
                addCoinsDesc: "Tanlangan o'yinchiga coin berish",
                resetPlayer: "O'yinchini qayta boshlash",
                resetPlayerDesc: "O'yinchi ma'lumotlarini tozalash",
                broadcastMessage: "Umumiy xabar",
                broadcastDesc: "Barcha o'yinchilarga xabar yuborish",
                systemMaintenance: "Tizim texnik xizmati",
                maintenanceDesc: "Tizimni texnik xizmatga o'tkazish",
                gameStatistics: "O'yin Statistikasi",
                totalTapsSystem: "Jami taplar",
                totalReferralsSystem: "Jami referrallar",
                completedTasksSystem: "Bajarilgan vazifalar",
                activeBoostsSystem: "Faol boostlar",
                recentActivity: "So'nggi Faollik",
                comingSoon: "Tez Orada!",
                boostComingSoon: "Boostlar tizimi tez orada qo'shiladi. Kuting!",
                taskManagement: "Vazifa Boshqaruvi",
                addNewTask: "Yangi vazifa qo'shish",
                addTaskDesc: "Tizimga yangi vazifa qo'shish",
                removeTask: "Vazifani o'chirish",
                removeTaskDesc: "Mavjud vazifani o'chirish",
                editTask: "Vazifani tahrirlash",
                editTaskDesc: "Mavjud vazifa ma'lumotlarini o'zgartirish",
                viewAllTasks: "Barcha vazifalarni ko'rish",
                viewTasksDesc: "Tizimda mavjud barcha vazifalar",
                multitap: "Multitap",
                multitapBoosts: "Multitap",
                rechargeBoosts: "Energy Recharging Speed",
                basicTasks: "Basic Tasks",
                levelTasks: "Level Tasks",
                referralTasks: "Referral Tasks",
                customTasks: "Custom Tasks",
                taskLevel3: "Reach Level 3",
                taskLevel7: "Reach Level 7",
                taskLevel10: "Reach Level 10",
                taskReferral1: "Invite first friend",
                taskReferral3: "Invite 3 friends",
                taskReferral10: "Invite 10 friends"
            },
            en: {
                tap: "Tapping",
                tasks: "Tasks",
                referral: "Referral",
                leaderboard: "Leaderboard",
                coinsPerTap: "Coins per tap",
                totalTaps: "Total taps",
                level: "Level",
                referrals: "Referrals",
                energyWarning: "‚ö†Ô∏è Energy empty! Wait for energy to refill.",
                task500taps: "Tap 500 times",
                taskLevel5: "Reach Level 5",
                task10000coins: "Collect 10000 coins",
                taskReferral: "Invite 5 friends",
                progress: "Progress",
                currentLevel: "Current level",
                referralSystem: "Referral System",
                yourReferralLink: "Your referral link:",
                copyLink: "Copy Link",
                totalReferrals: "Total Referrals",
                referralEarnings: "Referral Earnings",
                referralRewards: "Referral Rewards:",
                reward1: "For each referral: +500 DRC",
                reward2: "When referral first taps: +200 DRC",
                reward3: "When referral reaches Level 5: +1000 DRC",
                reward4: "When referral collects 10000 coins: +2000 DRC",
                yourReferrals: "Your Referrals:",
                noReferrals: "No referrals yet. Invite your friends!",
                byCoins: "By Coins",
                byReferrals: "By Referrals",
                yourRank: "Your Rank:",
                completedTasks: "Completed Tasks",
                profile: "Profile",
                joinedDate: "Joined Date",
                achievements: "Achievements",
                gameStats: "Game Statistics",
                tapPower: "Tap Power",
                currentEnergy: "Current Energy",
                completedTasksCount: "Completed Tasks",
                settings: "Settings",
                language: "Language",
                currentLanguage: "Current Language",
                change: "Change",
                dataStorage: "Data Storage",
                localStorage: "Local Storage",
                active: "Active",
                firebaseSync: "Firebase Sync",
                cloudSync: "Cloud Sync",
                checking: "Checking",
                playerProfile: "Player Profile",
                playerStats: "Player Statistics",
                rankPosition: "Rank Position",
                lastSeen: "Last Seen",
                playerType: "Player Type",
                close: "Close",
                challenge: "Challenge",
                boost: "Boosts",
                currentBoosts: "Current Boosts",
                maxEnergy: "Max Energy",
                tapPowerBoosts: "Tap Power Boosts",
                tapPowerDesc: "Get 2 coins per tap",
                tapPowerDesc2: "Get 3 coins per tap",
                tapPowerDesc3: "Get 5 coins per tap",
                tapPowerDesc4: "Get 10 coins per tap",
                energyBoosts: "Energy Boosts",
                energyDesc: "Max energy increases to 1500",
                energyDesc2: "Max energy increases to 2500",
                energyDesc3: "Max energy increases to 5000",
                specialBoosts: "Special Boosts",
                autoTapDesc: "Auto tap for 1 hour",
                energyRefillDesc: "Instantly refill energy",
                doubleCoinsDesc: "Double coins for 30 minutes",
                activeBoosts: "Active Boosts",
                admin: "Admin",
                playerManagement: "Player Management",
                totalPlayers: "Total Players",
                registeredUsers: "Registered Users",
                onlinePlayers: "Online Players",
                currentlyActive: "Currently Active",
                totalCoins: "Total Coins",
                systemWide: "System Wide",
                systemControls: "System Controls",
                addCoinsToPlayer: "Add Coins to Player",
                addCoinsDesc: "Give coins to selected player",
                resetPlayer: "Reset Player",
                resetPlayerDesc: "Clear player data",
                broadcastMessage: "Broadcast Message",
                broadcastDesc: "Send message to all players",
                systemMaintenance: "System Maintenance",
                maintenanceDesc: "Put system in maintenance mode",
                gameStatistics: "Game Statistics",
                totalTapsSystem: "Total Taps",
                totalReferralsSystem: "Total Referrals",
                completedTasksSystem: "Completed Tasks",
                activeBoostsSystem: "Active Boosts",
                recentActivity: "Recent Activity",
                comingSoon: "Coming Soon!",
                boostComingSoon: "Boost system will be added soon. Stay tuned!",
                taskManagement: "Task Management",
                addNewTask: "Add New Task",
                addTaskDesc: "Add new task to system",
                removeTask: "Remove Task",
                removeTaskDesc: "Remove existing task",
                editTask: "Edit Task",
                editTaskDesc: "Edit existing task data",
                viewAllTasks: "View All Tasks",
                viewTasksDesc: "All tasks in the system",
                multitap: "Multitap",
                multitapBoosts: "Multitap",
                rechargeBoosts: "Energy Recharging Speed",
                basicTasks: "Basic Tasks",
                levelTasks: "Level Tasks",
                referralTasks: "Referral Tasks",
                customTasks: "Custom Tasks",
                taskLevel3: "Reach Level 3",
                taskLevel7: "Reach Level 7",
                taskLevel10: "Reach Level 10",
                taskReferral1: "Invite first friend",
                taskReferral3: "Invite 3 friends",
                taskReferral10: "Invite 10 friends"
            },
            ru: {
                tap: "–¢–∞–ø–∏–Ω–≥",
                tasks: "–ó–∞–¥–∞–Ω–∏—è",
                referral: "–†–µ—Ñ–µ—Ä–∞–ª",
                leaderboard: "–†–µ–π—Ç–∏–Ω–≥",
                coinsPerTap: "–ú–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø",
                totalTaps: "–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤",
                level: "–£—Ä–æ–≤–µ–Ω—å",
                referrals: "–†–µ—Ñ–µ—Ä–∞–ª—ã",
                energyWarning: "‚ö†Ô∏è –≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å! –ü–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.",
                task500taps: "–¢–∞–ø–Ω–∏—Ç–µ 500 —Ä–∞–∑",
                taskLevel5: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 5 —É—Ä–æ–≤–Ω—è",
                task10000coins: "–°–æ–±–µ—Ä–∏—Ç–µ 10000 –º–æ–Ω–µ—Ç",
                taskReferral: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 5 –¥—Ä—É–∑–µ–π",
                progress: "–ü—Ä–æ–≥—Ä–µ—Å—Å",
                currentLevel: "–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å",
                referralSystem: "–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞",
                yourReferralLink: "–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:",
                copyLink: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É",
                totalReferrals: "–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤",
                referralEarnings: "–î–æ—Ö–æ–¥ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤",
                referralRewards: "–ù–∞–≥—Ä–∞–¥—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:",
                reward1: "–ó–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞: +500 DRC",
                reward2: "–ö–æ–≥–¥–∞ —Ä–µ—Ñ–µ—Ä–∞–ª –ø–µ—Ä–≤—ã–π —Ä–∞–∑ —Ç–∞–ø–Ω–µ—Ç: +200 DRC",
                reward3: "–ö–æ–≥–¥–∞ —Ä–µ—Ñ–µ—Ä–∞–ª –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç 5 —É—Ä–æ–≤–Ω—è: +1000 DRC",
                reward4: "–ö–æ–≥–¥–∞ —Ä–µ—Ñ–µ—Ä–∞–ª —Å–æ–±–µ—Ä–µ—Ç 10000 –º–æ–Ω–µ—Ç: +2000 DRC",
                yourReferrals: "–í–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã:",
                noReferrals: "–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤. –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π!",
                byCoins: "–ü–æ –º–æ–Ω–µ—Ç–∞–º",
                byReferrals: "–ü–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º",
                yourRank: "–í–∞—à–µ –º–µ—Å—Ç–æ:",
                completedTasks: "–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è",
                profile: "–ü—Ä–æ—Ñ–∏–ª—å",
                joinedDate: "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
                achievements: "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
                gameStats: "–ò–≥—Ä–æ–≤–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                tapPower: "–°–∏–ª–∞ —Ç–∞–ø–∞",
                currentEnergy: "–¢–µ–∫—É—â–∞—è —ç–Ω–µ—Ä–≥–∏—è",
                completedTasksCount: "–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è",
                settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
                language: "–Ø–∑—ã–∫",
                currentLanguage: "–¢–µ–∫—É—â–∏–π —è–∑—ã–∫",
                change: "–ò–∑–º–µ–Ω–∏—Ç—å",
                dataStorage: "–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö",
                localStorage: "–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
                active: "–ê–∫—Ç–∏–≤–Ω–æ",
                firebaseSync: "Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è",
                cloudSync: "–û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è",
                checking: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è",
                playerProfile: "–ü—Ä–æ—Ñ–∏–ª—å –ò–≥—Ä–æ–∫–∞",
                playerStats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ò–≥—Ä–æ–∫–∞",
                rankPosition: "–ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ",
                lastSeen: "–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
                playerType: "–¢–∏–ø –∏–≥—Ä–æ–∫–∞",
                close: "–ó–∞–∫—Ä—ã—Ç—å",
                challenge: "–í—ã–∑–æ–≤",
                boost: "–ë—É—Å—Ç—ã",
                currentBoosts: "–¢–µ–∫—É—â–∏–µ –ë—É—Å—Ç—ã",
                maxEnergy: "–ú–∞–∫—Å –≠–Ω–µ—Ä–≥–∏—è",
                tapPowerBoosts: "–ë—É—Å—Ç—ã –°–∏–ª—ã –¢–∞–ø–∞",
                tapPowerDesc: "–ü–æ–ª—É—á–∞–π—Ç–µ 2 –º–æ–Ω–µ—Ç—ã –∑–∞ —Ç–∞–ø",
                tapPowerDesc2: "–ü–æ–ª—É—á–∞–π—Ç–µ 3 –º–æ–Ω–µ—Ç—ã –∑–∞ —Ç–∞–ø",
                tapPowerDesc3: "–ü–æ–ª—É—á–∞–π—Ç–µ 5 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø",
                tapPowerDesc4: "–ü–æ–ª—É—á–∞–π—Ç–µ 10 –º–æ–Ω–µ—Ç –∑–∞ —Ç–∞–ø",
                energyBoosts: "–ë—É—Å—Ç—ã –≠–Ω–µ—Ä–≥–∏–∏",
                energyDesc: "–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 1500",
                energyDesc2: "–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 2500",
                energyDesc3: "–ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 5000",
                specialBoosts: "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ë—É—Å—Ç—ã",
                autoTapDesc: "–ê–≤—Ç–æ —Ç–∞–ø –Ω–∞ 1 —á–∞—Å",
                energyRefillDesc: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é",
                doubleCoinsDesc: "–î–≤–æ–π–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –Ω–∞ 30 –º–∏–Ω—É—Ç",
                activeBoosts: "–ê–∫—Ç–∏–≤–Ω—ã–µ –ë—É—Å—Ç—ã",
                admin: "–ê–¥–º–∏–Ω",
                playerManagement: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–≥—Ä–æ–∫–∞–º–∏",
                totalPlayers: "–í—Å–µ–≥–æ –ò–≥—Ä–æ–∫–æ–≤",
                registeredUsers: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                onlinePlayers: "–û–Ω–ª–∞–π–Ω –ò–≥—Ä–æ–∫–∏",
                currentlyActive: "–°–µ–π—á–∞—Å –ê–∫—Ç–∏–≤–Ω—ã",
                totalCoins: "–í—Å–µ–≥–æ –ú–æ–Ω–µ—Ç",
                systemWide: "–ü–æ –í—Å–µ–π –°–∏—Å—Ç–µ–º–µ",
                systemControls: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–∏—Å—Ç–µ–º–æ–π",
                addCoinsToPlayer: "–î–æ–±–∞–≤–∏—Ç—å –ú–æ–Ω–µ—Ç—ã –ò–≥—Ä–æ–∫—É",
                addCoinsDesc: "–î–∞—Ç—å –º–æ–Ω–µ—Ç—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∏–≥—Ä–æ–∫—É",
                resetPlayer: "–°–±—Ä–æ—Å–∏—Ç—å –ò–≥—Ä–æ–∫–∞",
                resetPlayerDesc: "–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞",
                broadcastMessage: "–û–±—â–µ–µ –°–æ–æ–±—â–µ–Ω–∏–µ",
                broadcastDesc: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º",
                systemMaintenance: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
                maintenanceDesc: "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—É –≤ —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è",
                gameStatistics: "–ò–≥—Ä–æ–≤–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                totalTapsSystem: "–í—Å–µ–≥–æ –¢–∞–ø–æ–≤",
                totalReferralsSystem: "–í—Å–µ–≥–æ –†–µ—Ñ–µ—Ä–∞–ª–æ–≤",
                completedTasksSystem: "–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è",
                activeBoostsSystem: "–ê–∫—Ç–∏–≤–Ω—ã–µ –ë—É—Å—Ç—ã",
                recentActivity: "–ù–µ–¥–∞–≤–Ω—è—è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
                comingSoon: "–°–∫–æ—Ä–æ!",
                boostComingSoon: "–°–∏—Å—Ç–µ–º–∞ –±—É—Å—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è. –ñ–¥–∏—Ç–µ!",
                taskManagement: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ó–∞–¥–∞–Ω–∏—è–º–∏",
                addNewTask: "–î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤–æ–µ –ó–∞–¥–∞–Ω–∏–µ",
                addTaskDesc: "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º—É",
                removeTask: "–£–¥–∞–ª–∏—Ç—å –ó–∞–¥–∞–Ω–∏–µ",
                removeTaskDesc: "–£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ",
                editTask: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ó–∞–¥–∞–Ω–∏–µ",
                editTaskDesc: "–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è",
                viewAllTasks: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –í—Å–µ –ó–∞–¥–∞–Ω–∏—è",
                viewTasksDesc: "–í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ",
                multitap: "–ú—É–ª—å—Ç–∏—Ç–∞–ø",
                multitapBoosts: "–ú—É–ª—å—Ç–∏—Ç–∞–ø",
                rechargeBoosts: "–°–∫–æ—Ä–æ—Å—Ç—å –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≠–Ω–µ—Ä–≥–∏–∏",
                basicTasks: "–û—Å–Ω–æ–≤–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è",
                levelTasks: "–ó–∞–¥–∞–Ω–∏—è –ø–æ –£—Ä–æ–≤–Ω—é",
                referralTasks: "–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è",
                customTasks: "–û—Å–æ–±—ã–µ –ó–∞–¥–∞–Ω–∏—è",
                taskLevel3: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 3 —É—Ä–æ–≤–Ω—è",
                taskLevel7: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 7 —É—Ä–æ–≤–Ω—è",
                taskLevel10: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 10 —É—Ä–æ–≤–Ω—è",
                taskReferral1: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–≥–∞",
                taskReferral3: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 3 –¥—Ä—É–∑–µ–π",
                taskReferral10: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 10 –¥—Ä—É–∑–µ–π"
            }
        };

        let currentLanguage = 'uz';
        const countryFlags = {
            uz: 'üá∫üáø',
            en: 'üá∫üá∏',
            ru: 'üá∑üá∫'
        };

        // Level system with names and requirements
        const levelSystem = {
            1: { name: 'Wood', tapsRequired: 0, color: '#8B4513' },
            2: { name: 'Bronze', tapsRequired: 500, color: '#CD7F32' },
            3: { name: 'Silver', tapsRequired: 1500, color: '#C0C0C0' },
            4: { name: 'Gold', tapsRequired: 3500, color: '#FFD700' },
            5: { name: 'Platinum', tapsRequired: 7000, color: '#E5E4E2' },
            6: { name: 'Diamond', tapsRequired: 12000, color: '#B9F2FF' },
            7: { name: 'Master', tapsRequired: 20000, color: '#FF6B35' },
            8: { name: 'Grandmaster', tapsRequired: 35000, color: '#9932CC' },
            9: { name: 'Legend', tapsRequired: 60000, color: '#FF1493' },
            10: { name: 'Mythic', tapsRequired: 100000, color: '#00FFFF' }
        };

        // Game state
        let gameState = {
            balance: 0,
            energy: 1000,
            maxEnergy: 1000,
            tapPower: 1,
            multitap: 1,
            rechargeSpeed: 5000, // milliseconds per energy point
            totalTaps: 0,
            level: 1,
            completedTasks: {
                taps: false,
                level: false,
                coins: false,
                referral: false,
                telegram: false,
                youtube: false,
                code: false,
                level3: false,
                level7: false,
                level10: false,
                referral1: false,
                referral3: false,
                referral10: false
            },
            lastSaveTime: Date.now(),
            referralCode: generateReferralCode(),
            referrals: [],
            referralEarnings: 0,
            referredBy: null,
            playerName: 'Dragon Miner',
            country: 'UZ',
            boosts: {
                tapPower: 1,
                maxEnergy: 1000,
                multitap: 1,
                rechargeSpeed: 5000,
                purchased: {
                    tapPower2: false,
                    tapPower3: false,
                    tapPower5: false,
                    tapPower10: false,
                    energy1500: false,
                    energy2500: false,
                    energy5000: false,
                    multitap2: false,
                    multitap3: false,
                    multitap5: false,
                    recharge2: false,
                    recharge3: false,
                    recharge5: false
                }
            },
            activeBoosts: {
                turbo: { active: false, endTime: 0 }
            }
        };

        let globalPlayers = [];
        let firebaseConnected = false;
        let tapEffectPool = [];
        let lastUIUpdate = 0;
        let pendingUIUpdate = false;
        let lastTapTime = 0;

        // Generate unique referral code
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Firebase connection
        function initializeFirebaseConnection() {
            console.log('üîÑ Firebase ulanishni tekshirish...');
            updateFirebaseStatus(false);
            
            setTimeout(() => {
                try {
                    if (window.firebaseDatabase) {
                        console.log('‚úÖ Firebase muvaffaqiyatli ulandi');
                        firebaseConnected = true;
                        updateFirebaseStatus(true);
                        loadPlayersFromFirebase();
                        savePlayerToFirebase();
                        loadGlobalTaskSettings(); // Load global task settings
                    } else {
                        throw new Error('Firebase not available');
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è Firebase mavjud emas, mahalliy rejimda ishlash');
                    firebaseConnected = false;
                    updateFirebaseStatus(false);
                    generateDemoPlayers();
                }
            }, 2000);
        }

        function updateFirebaseStatus(connected) {
            const statusElement = document.getElementById('firebaseStatus');
            if (connected) {
                statusElement.textContent = 'üî• Firebase Ulandi - Real-time sinxronizatsiya';
                statusElement.className = 'firebase-status firebase-connected';
                
                setTimeout(() => {
                    statusElement.style.opacity = '0';
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 500);
                }, 3000);
            } else {
                statusElement.textContent = 'üì± Mahalliy rejim - Firebase mavjud emas';
                statusElement.className = 'firebase-status firebase-disconnected';
                
                setTimeout(() => {
                    statusElement.style.opacity = '0';
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 500);
                }, 2000);
            }
        }

        function savePlayerToFirebase() {
            if (!firebaseConnected || !window.firebaseDatabase) return;

            try {
                // Faqat Firebase Auth UID ni ishlatamiz
                const playerId = window.firebaseAuthUid;
                const playerRef = window.firebaseRef(window.firebaseDatabase, `players/${playerId}`);

                const playerData = {
                    id: playerId,
                    name: gameState.playerName,
                    balance: gameState.balance,
                    level: gameState.level,
                    totalTaps: gameState.totalTaps,
                    referrals: gameState.referrals.length,
                    country: gameState.country,
                    lastUpdate: Date.now(),
                    isOnline: true,
                    referralCode: gameState.referralCode
                };

                window.firebaseSet(playerRef, playerData);
            } catch (error) {
                console.error('‚ùå Firebase ga saqlashda xatolik:', error);
            }
        }

        // YANGI: Global task management functions - ASOSIY MUAMMO SHU YERDA EMAS
        function saveGlobalTaskSettings() {
            console.log('üíæ Global vazifa sozlamalarini saqlash boshlanmoqda...');
            
            if (!firebaseConnected || !window.firebaseDatabase) {
                console.log('‚ö†Ô∏è Firebase ulanmagan, mahalliy saqlash');
                return false;
            }
            
            try {
                // Save hidden/deleted standard tasks
                const hiddenTasks = [];
                const deletedTasks = [];
                
                const standardTaskIds = ['taps', 'level', 'level3', 'level7', 'level10', 'coins', 'referral', 'referral1', 'referral3', 'referral10', 'telegram', 'youtube', 'code'];
                
                standardTaskIds.forEach(taskId => {
                    if (localStorage.getItem(`hiddenTask_${taskId}`) === 'true') {
                        hiddenTasks.push(taskId);
                    }
                    if (localStorage.getItem(`deletedTask_${taskId}`) === 'true') {
                        deletedTasks.push(taskId);
                    }
                });
                
                // Save to Firebase with timestamp
                const taskSettingsRef = window.firebaseRef(window.firebaseDatabase, 'globalTaskSettings');
                const taskSettingsData = {
                    hiddenTasks: hiddenTasks,
                    deletedTasks: deletedTasks,
                    lastUpdate: Date.now(),
                    updatedBy: getUniquePlayerId(),
                    version: Date.now() // Add version for conflict resolution
                };
                
                // Use synchronous approach
                window.firebaseSet(taskSettingsRef, taskSettingsData);
                console.log('‚úÖ Global vazifa sozlamalari Firebase ga saqlandi:', taskSettingsData);
                
                // Save custom tasks globally with timestamp
                const customTasksRef = window.firebaseRef(window.firebaseDatabase, 'globalCustomTasks');
                const customTasksData = {
                    tasks: customTasks,
                    lastUpdate: Date.now(),
                    updatedBy: getUniquePlayerId(),
                    version: Date.now() // Add version for conflict resolution
                };
                
                // Use synchronous approach
                window.firebaseSet(customTasksRef, customTasksData);
                console.log('‚úÖ Global maxsus vazifalar Firebase ga saqlandi:', customTasks.length, 'ta vazifa');
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Global vazifa sozlamalarini saqlashda xatolik:', error);
                return false;
            }
        }

        // YANGI: Improved global task loading with real-time updates
        function loadGlobalTaskSettings() {
            console.log('üì• Global vazifa sozlamalarini yuklash boshlanmoqda...');
            
            // Set up periodic checking instead of onValue (which might not work properly)
            setInterval(() => {
                if (firebaseConnected && window.firebaseDatabase) {
                    checkForGlobalTaskUpdates();
                }
            }, 5000); // Check every 5 seconds
            
            // Also check immediately if Firebase is connected
            if (firebaseConnected && window.firebaseDatabase) {
                setTimeout(() => {
                    checkForGlobalTaskUpdates();
                }, 1000);
            }
        }
        
        // YANGI: Manual checking function instead of onValue
        function checkForGlobalTaskUpdates() {
            try {
                // Check task settings
                const taskSettingsRef = window.firebaseRef(window.firebaseDatabase, 'globalTaskSettings');
                window.firebaseGet(taskSettingsRef).then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const lastLocalUpdate = localStorage.getItem('lastGlobalTaskUpdate') || '0';
                        
                        // Only apply if this is a newer update and not from this user
                        if (data.version > parseInt(lastLocalUpdate) && data.updatedBy !== getUniquePlayerId()) {
                            console.log('üì• Yangi global vazifa sozlamalari topildi:', data);
                            
                            // Clear existing settings
                            const standardTaskIds = ['taps', 'level', 'level3', 'level7', 'level10', 'coins', 'referral', 'referral1', 'referral3', 'referral10', 'telegram', 'youtube', 'code'];
                            standardTaskIds.forEach(taskId => {
                                localStorage.removeItem(`hiddenTask_${taskId}`);
                                localStorage.removeItem(`deletedTask_${taskId}`);
                            });
                            
                            // Apply global settings
                            if (data.hiddenTasks) {
                                data.hiddenTasks.forEach(taskId => {
                                    localStorage.setItem(`hiddenTask_${taskId}`, 'true');
                                    console.log('üëÅÔ∏è Vazifa yashirildi:', taskId);
                                });
                            }
                            
                            if (data.deletedTasks) {
                                data.deletedTasks.forEach(taskId => {
                                    localStorage.setItem(`deletedTask_${taskId}`, 'true');
                                    console.log('üóëÔ∏è Vazifa o\'chirildi:', taskId);
                                });
                            }
                            
                            // Save the update timestamp
                            localStorage.setItem('lastGlobalTaskUpdate', data.version.toString());
                            
                            // Update task display
                            updateTasksDisplay();
                            showNotification('üîÑ Admin tomonidan vazifalar yangilandi!', 'success');
                        }
                    }
                }).catch(error => {
                    console.error('‚ùå Global vazifa sozlamalarini yuklashda xatolik:', error);
                });
                
                // Check custom tasks
                const customTasksRef = window.firebaseRef(window.firebaseDatabase, 'globalCustomTasks');
                window.firebaseGet(customTasksRef).then((snapshot) => {
                    const data = snapshot.val();
                    if (data && data.tasks) {
                        const lastLocalCustomUpdate = localStorage.getItem('lastGlobalCustomTaskUpdate') || '0';
                        
                        // Only apply if this is a newer update and not from this user
                        if (data.version > parseInt(lastLocalCustomUpdate) && data.updatedBy !== getUniquePlayerId()) {
                            console.log('üì• Yangi global maxsus vazifalar topildi:', data.tasks.length, 'ta vazifa');
                            
                            // Merge with existing completed tasks to preserve user progress
                            const existingCustomTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
                            const mergedTasks = data.tasks.map(globalTask => {
                                const existingTask = existingCustomTasks.find(t => t.id === globalTask.id);
                                return existingTask ? { ...globalTask, completed: existingTask.completed, completedDate: existingTask.completedDate } : globalTask;
                            });
                            
                            customTasks = mergedTasks;
                            localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                            
                            // Save the update timestamp
                            localStorage.setItem('lastGlobalCustomTaskUpdate', data.version.toString());
                            
                            // Update task display
                            updateTasksDisplay();
                            showNotification('‚ú® Yangi vazifalar qo\'shildi!', 'success');
                        }
                    }
                }).catch(error => {
                    console.error('‚ùå Global maxsus vazifalarni yuklashda xatolik:', error);
                });
                
            } catch (error) {
                console.error('‚ùå Global vazifa yangilanishlarini tekshirishda xatolik:', error);
            }
        }

        function loadPlayersFromFirebase() {
            if (!firebaseConnected || !window.firebaseDatabase) return;
            
            try {
                const playersRef = window.firebaseRef(window.firebaseDatabase, 'players');
                window.firebaseOnValue(playersRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const currentPlayerId = getUniquePlayerId();
                        globalPlayers = Object.values(data).filter(player => 
                            player.id !== currentPlayerId
                        );
                    }
                });
            } catch (error) {
                console.error('‚ùå Firebase dan yuklashda xatolik:', error);
                generateDemoPlayers();
            }
        }

        function generateDemoPlayers() {
            const names = [
                'CryptoKing', 'DragonMaster', 'CoinHunter', 'TapLegend', 'GoldDigger',
                'FastTapper', 'CoinCollector', 'DragonSlayer', 'TapMaster', 'CryptoMiner'
            ];
            
            const countries = ['UZ', 'RU', 'KZ', 'TR', 'KG', 'US', 'DE', 'FR'];
            globalPlayers = [];
            
            for (let i = 0; i < 10; i++) {
                const baseBalance = Math.floor(Math.random() * 50000) + 5000;
                const level = Math.max(1, Math.floor(baseBalance / 5000));
                const referrals = Math.floor(Math.random() * 20);
                
                globalPlayers.push({
                    id: 'demo_' + i,
                    name: names[i],
                    balance: baseBalance,
                    referrals: referrals,
                    level: level,
                    totalTaps: Math.floor(baseBalance * (1 + Math.random())),
                    country: countries[Math.floor(Math.random() * countries.length)],
                    isCurrentPlayer: false,
                    lastUpdate: Date.now() - Math.floor(Math.random() * 3600000),
                    isOnline: Math.random() > 0.3
                });
            }
        }

        function getUniquePlayerId() {
            // Try to get Telegram user data first
            const tgData = getTelegramUserData();
            if (tgData && tgData.id) {
                // Update player name from Telegram
                gameState.playerName = tgData.username;
                return tgData.id;
            }
            
            // Fallback to localStorage or generate new ID
            let playerId = localStorage.getItem('dragonCoinPlayerId');
            if (!playerId) {
                playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
                localStorage.setItem('dragonCoinPlayerId', playerId);
            }
            return playerId;
        }

        function getTelegramUserData() {
            try {
                // Check if we're in Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData) {
                    const webApp = window.Telegram.WebApp;
                    const user = webApp.initDataUnsafe?.user;
                    
                    if (user && user.id) {
                        // Create proper display name
                        let displayName = 'Telegram User';
                        
                        if (user.username) {
                            displayName = '@' + user.username;
                        } else if (user.first_name) {
                            displayName = user.first_name;
                            if (user.last_name) {
                                displayName += ' ' + user.last_name;
                            }
                        }
                        
                        console.log('‚úÖ Telegram foydalanuvchi topildi:', displayName);
                        
                        return {
                            id: 'tg_' + user.id,
                            username: displayName,
                            firstName: user.first_name || '',
                            lastName: user.last_name || '',
                            languageCode: user.language_code || 'uz'
                        };
                    }
                }
                
                // Alternative method - check URL parameters for Telegram data
                const urlParams = new URLSearchParams(window.location.search);
                const tgWebAppData = urlParams.get('tgWebAppData');
                if (tgWebAppData) {
                    try {
                        const decodedData = decodeURIComponent(tgWebAppData);
                        const userData = JSON.parse(decodedData);
                        if (userData.user) {
                            let displayName = 'Telegram User';
                            if (userData.user.username) {
                                displayName = '@' + userData.user.username;
                            } else if (userData.user.first_name) {
                                displayName = userData.user.first_name;
                                if (userData.user.last_name) {
                                    displayName += ' ' + userData.user.last_name;
                                }
                            }
                            
                            console.log('‚úÖ URL dan Telegram foydalanuvchi topildi:', displayName);
                            
                            return {
                                id: 'tg_' + userData.user.id,
                                username: displayName,
                                firstName: userData.user.first_name || '',
                                lastName: userData.user.last_name || '',
                                languageCode: userData.user.language_code || 'uz'
                            };
                        }
                    } catch (e) {
                        console.log('URL parametrlarini parse qilishda xatolik:', e);
                    }
                }
                
                console.log('‚ö†Ô∏è Telegram foydalanuvchi ma\'lumotlari topilmadi');
                return null;
            } catch (error) {
                console.log('‚ùå Telegram ma\'lumotlarini olishda xatolik:', error);
                return null;
            }
        }

        function detectCountryAndLanguage() {
            // First try to get from Telegram
            const tgData = getTelegramUserData();
            if (tgData && tgData.languageCode) {
                if (tgData.languageCode.includes('ru')) {
                    currentLanguage = 'ru';
                    gameState.country = 'RU';
                } else if (tgData.languageCode.includes('en')) {
                    currentLanguage = 'en';
                    gameState.country = 'US';
                } else {
                    currentLanguage = 'uz';
                    gameState.country = 'UZ';
                }
            } else {
                // Fallback to browser language
                const userLang = navigator.language.toLowerCase();
                if (userLang.includes('ru')) {
                    currentLanguage = 'ru';
                    gameState.country = 'RU';
                } else if (userLang.includes('en')) {
                    currentLanguage = 'en';
                    gameState.country = 'US';
                } else {
                    currentLanguage = 'uz';
                    gameState.country = 'UZ';
                }
            }
            updateLanguageDisplay();
            translatePage();
        }

        function updateLanguageDisplay() {
            document.getElementById('countryFlag').textContent = countryFlags[currentLanguage];
            document.getElementById('languageText').textContent = currentLanguage.toUpperCase();
        }

        function toggleLanguage() {
            const languages = ['uz', 'en', 'ru'];
            const currentIndex = languages.indexOf(currentLanguage);
            currentLanguage = languages[(currentIndex + 1) % languages.length];
            updateLanguageDisplay();
            translatePage();
            saveGameState();
        }

        function translatePage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
        }

        // Tap function - optimized for mobile
        function tapCoin(event) {
            const now = Date.now();
            
            // Prevent too frequent taps but allow faster tapping
            if (now - lastTapTime < 30) return;
            lastTapTime = now;
            
            // Prevent default touch behavior
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Check if turbo is active (unlimited energy)
            const isTurboActive = gameState.activeBoosts.turbo.active && gameState.activeBoosts.turbo.endTime > now;
            
            if (!isTurboActive && gameState.energy <= 0) {
                showEnergyWarning();
                return;
            }
            
            // Apply multitap
            const tapsToProcess = gameState.multitap;
            const coinsPerTap = gameState.tapPower;
            const totalCoins = coinsPerTap * tapsToProcess;
            
            gameState.balance += totalCoins;
            
            // Only consume energy if turbo is not active
            if (!isTurboActive) {
                gameState.energy = Math.max(0, gameState.energy - tapsToProcess);
            }
            
            gameState.totalTaps += tapsToProcess;
            
            // Optimize effects for mobile
            createTapEffectOptimized(event, totalCoins);
            animateCoinOptimized();
            
            // Batch UI updates for better performance
            if (!pendingUIUpdate) {
                pendingUIUpdate = true;
                requestAnimationFrame(() => {
                    updateUIOptimized();
                    pendingUIUpdate = false;
                });
            }
            
            checkLevelUp();
            
            // Save less frequently to reduce lag
            if (now - gameState.lastSaveTime > 10000) {
                saveGameState();
                gameState.lastSaveTime = now;
            }
        }

        function createTapEffect(event, coins) {
            const coinContainer = document.querySelector('.coin-container');
            const rect = coinContainer.getBoundingClientRect();
            
            let effect = tapEffectPool.pop();
            if (!effect) {
                effect = document.createElement('div');
                effect.className = 'tap-effect';
            }
            
            const x = (event.clientX || event.touches?.[0]?.clientX || rect.left + rect.width/2) - rect.left;
            const y = (event.clientY || event.touches?.[0]?.clientY || rect.top + rect.height/2) - rect.top;
            
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            effect.textContent = '+' + coins;
            
            coinContainer.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
                tapEffectPool.push(effect);
            }, 1000);
        }

        // Optimized version for mobile
        function createTapEffectOptimized(event, coins) {
            // Limit effects to prevent lag
            if (tapEffectPool.length > 5) return;
            
            const coinContainer = document.querySelector('.coin-container');
            const rect = coinContainer.getBoundingClientRect();
            
            let effect = tapEffectPool.pop();
            if (!effect) {
                effect = document.createElement('div');
                effect.className = 'tap-effect';
                effect.style.willChange = 'transform, opacity';
            }
            
            const x = (event?.clientX || event?.touches?.[0]?.clientX || rect.left + rect.width/2) - rect.left;
            const y = (event?.clientY || event?.touches?.[0]?.clientY || rect.top + rect.height/2) - rect.top;
            
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            effect.textContent = '+' + coins;
            
            coinContainer.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
                tapEffectPool.push(effect);
            }, 800); // Shorter duration
        }

        function animateCoin() {
            const coin = document.getElementById('mainCoin');
            coin.classList.add('tap-animation');
            
            setTimeout(() => {
                coin.classList.remove('tap-animation');
            }, 50);
        }

        // Optimized version for mobile
        function animateCoinOptimized() {
            const coin = document.getElementById('mainCoin');
            if (coin.classList.contains('tap-animation')) return; // Prevent multiple animations
            
            coin.classList.add('tap-animation');
            
            setTimeout(() => {
                coin.classList.remove('tap-animation');
            }, 30); // Shorter animation
        }

        function showEnergyWarning() {
            const warning = document.getElementById('energyWarning');
            warning.style.display = 'block';
            
            setTimeout(() => {
                warning.style.display = 'none';
            }, 3000);
        }

        function showSection(sectionName) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            const activeTab = document.getElementById(sectionName + 'Tab');
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            if (sectionName === 'tasks') {
                updateTasksDisplay();
                showTaskCategory('basic'); // Show basic tasks by default
            } else if (sectionName === 'referral') {
                updateReferralDisplay();
            } else if (sectionName === 'leaderboard') {
                updateLeaderboard();
            } else if (sectionName === 'profile') {
                updateProfileDisplay();
            } else if (sectionName === 'admin') {
                updateAdminDisplay();
            } else if (sectionName === 'boost') {
                updateBoostDisplay();
            }
        }

        function claimTask(taskType) {
            if (gameState.completedTasks[taskType]) {
                return;
            }
            
            let canClaim = false;
            let reward = 0;
            
            switch (taskType) {
                case 'taps':
                    canClaim = gameState.totalTaps >= 500;
                    reward = 1000;
                    break;
                case 'level':
                    canClaim = gameState.level >= 5;
                    reward = 2000;
                    break;
                case 'level3':
                    canClaim = gameState.level >= 3;
                    reward = 800;
                    break;
                case 'level7':
                    canClaim = gameState.level >= 7;
                    reward = 4000;
                    break;
                case 'level10':
                    canClaim = gameState.level >= 10;
                    reward = 8000;
                    break;
                case 'coins':
                    canClaim = gameState.balance >= 10000;
                    reward = 5000;
                    break;
                case 'referral':
                    canClaim = gameState.referrals.length >= 5;
                    reward = 3000;
                    break;
                case 'referral1':
                    canClaim = gameState.referrals.length >= 1;
                    reward = 500;
                    break;
                case 'referral3':
                    canClaim = gameState.referrals.length >= 3;
                    reward = 1500;
                    break;
                case 'referral10':
                    canClaim = gameState.referrals.length >= 10;
                    reward = 6000;
                    break;
                case 'telegram':
                    // Open Telegram channel and mark as completed after 3 seconds
                    window.open('https://t.me/DragonCoinChannel', '_blank');
                    setTimeout(() => {
                        gameState.completedTasks[taskType] = true;
                        gameState.balance += 1500;
                        showNotification('‚úÖ Telegram kanalga obuna bo\'lganingiz uchun rahmat! +1500 DRC', 'success');
                        updateTasksDisplay();
                        updateUI();
                        saveGameState();
                    }, 3000);
                    return;
                case 'youtube':
                    // Open YouTube channel and mark as completed after 3 seconds
                    window.open('https://youtube.com/@DragonCoinOfficial', '_blank');
                    setTimeout(() => {
                        gameState.completedTasks[taskType] = true;
                        gameState.balance += 2000;
                        showNotification('‚úÖ YouTube kanalga obuna bo\'lganingiz uchun rahmat! +2000 DRC', 'success');
                        updateTasksDisplay();
                        updateUI();
                        saveGameState();
                    }, 3000);
                    return;
                case 'code':
                    const code = prompt('Videoda ko\'rsatilgan kodni kiriting:');
                    if (code && code.toUpperCase() === 'DRAGON2024') {
                        gameState.completedTasks[taskType] = true;
                        gameState.balance += 5000;
                        showNotification('‚úÖ To\'g\'ri kod! +5000 DRC olindi!', 'success');
                        updateTasksDisplay();
                        updateUI();
                        saveGameState();
                    } else {
                        showNotification('‚ùå Noto\'g\'ri kod! Videoni qaytadan ko\'ring.', 'error');
                    }
                    return;
            }
            
            if (canClaim) {
                gameState.completedTasks[taskType] = true;
                gameState.balance += reward;
                
                showNotification(`‚úÖ Vazifa bajarildi! +${reward} DRC olindi!`, 'success');
                
                updateTasksDisplay();
                updateUI();
                saveGameState();
            } else {
                showNotification('‚ùå Vazifa hali bajarilmagan!', 'error');
            }
        }

        function updateTasksDisplay() {
            // Update all task categories
            displayBasicTasks();
            displayLevelTasks();
            displayReferralTasks();
            displayCustomTasks();
            updateCompletedTasksDisplay();
        }

        function displayBasicTasks() {
            const basicTasksList = document.getElementById('basicTasksList');
            if (!basicTasksList) return;

            const basicTasks = [
                { id: 'taps', name: '500 marta tap qiling', reward: 1000, progress: Math.min(gameState.totalTaps, 500), max: 500, desc: 'Progress' },
                { id: 'level', name: 'Level 5 ga yeting', reward: 2000, progress: gameState.level, max: 5, desc: 'Hozirgi level' },
                { id: 'coins', name: '10000 coin to\'plang', reward: 5000, progress: Math.min(gameState.balance, 10000), max: 10000, desc: 'Progress' },
                { id: 'referral', name: '5 ta do\'st taklif qiling', reward: 3000, progress: gameState.referrals.length, max: 5, desc: 'Progress' },
                { id: 'telegram', name: 'Telegram kanalga obuna bo\'ling', reward: 1500, desc: '@DragonCoinChannel' },
                { id: 'youtube', name: 'YouTube kanalga obuna bo\'ling', reward: 2000, desc: 'Dragon Coin Official' },
                { id: 'code', name: 'Maxsus kodni kiriting', reward: 5000, desc: 'Videoda ko\'rsatilgan kod' }
            ];

            // Add custom tasks that belong to basic category
            const basicCustomTasks = customTasks.filter(task => 
                ['telegram', 'youtube', 'code', 'website', 'social'].includes(task.type) && !task.completed
            );

            let tasksHTML = '';
            
            // Display standard basic tasks
            basicTasks.forEach(task => {
                // Check if task is hidden or deleted
                if (localStorage.getItem(`hiddenTask_${task.id}`) === 'true' || localStorage.getItem(`deletedTask_${task.id}`) === 'true') {
                    return; // Skip hidden or deleted tasks
                }

                const canClaim = getTaskCanClaim(task.id);
                const isCompleted = gameState.completedTasks[task.id];
                const statusClass = isCompleted ? 'completed' : (canClaim ? 'task-ready' : '');
                const conditionClass = isCompleted ? 'condition-completed' : (canClaim ? 'condition-completed' : 'condition-pending');

                let progressHTML = '';
                if (task.progress !== undefined) {
                    progressHTML = `<div style="font-size: 12px; color: #ccc;"><span>${task.desc}</span>: <span>${task.progress}</span>/${task.max}</div>`;
                } else {
                    progressHTML = `<div style="font-size: 12px; color: #ccc;">${task.desc}</div>`;
                }

                tasksHTML += `
                    <div class="condition-item task-button ${statusClass}" onclick="claimTask('${task.id}')" id="${task.id}Task">
                        <div class="condition-text">
                            <div>${task.name}</div>
                            ${progressHTML}
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status ${conditionClass}" id="${task.id}Condition"></div>
                    </div>
                `;
            });

            // Display custom basic tasks
            basicCustomTasks.forEach(task => {
                const icon = getTaskIcon(task.type);
                tasksHTML += `
                    <div class="condition-item task-button" onclick="claimCustomTask('${task.id}')" id="customTask_${task.id}">
                        <div class="condition-text">
                            <div>${icon} ${task.name}</div>
                            <div style="font-size: 12px; color: #ccc;">${task.description || task.link}</div>
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status condition-pending" id="customCondition_${task.id}"></div>
                    </div>
                `;
            });

            if (tasksHTML === '') {
                tasksHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hozircha asosiy vazifalar yo\'q.</div>';
            }

            basicTasksList.innerHTML = tasksHTML;
        }

        function displayLevelTasks() {
            const levelTasksList = document.getElementById('levelTasksList');
            if (!levelTasksList) return;

            const levelTasks = [
                { id: 'level3', name: 'Level 3 ga yeting', reward: 800, targetLevel: 3 },
                { id: 'level', name: 'Level 5 ga yeting', reward: 2000, targetLevel: 5 },
                { id: 'level7', name: 'Level 7 ga yeting', reward: 4000, targetLevel: 7 },
                { id: 'level10', name: 'Level 10 ga yeting', reward: 8000, targetLevel: 10 }
            ];

            // Add custom level tasks
            const levelCustomTasks = customTasks.filter(task => 
                task.type === 'level' && !task.completed
            );

            let tasksHTML = '';
            
            // Display standard level tasks
            levelTasks.forEach(task => {
                // Check if task is hidden or deleted
                if (localStorage.getItem(`hiddenTask_${task.id}`) === 'true' || localStorage.getItem(`deletedTask_${task.id}`) === 'true') {
                    return; // Skip hidden or deleted tasks
                }

                const canClaim = gameState.level >= task.targetLevel;
                const isCompleted = gameState.completedTasks[task.id];
                const statusClass = isCompleted ? 'completed' : (canClaim ? 'task-ready' : '');
                const conditionClass = isCompleted ? 'condition-completed' : (canClaim ? 'condition-completed' : 'condition-pending');

                tasksHTML += `
                    <div class="condition-item task-button ${statusClass}" onclick="claimTask('${task.id}')" id="${task.id}Task">
                        <div class="condition-text">
                            <div>${task.name}</div>
                            <div style="font-size: 12px; color: #ccc;">Hozirgi level: <span>${gameState.level}</span></div>
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status ${conditionClass}" id="${task.id}Condition"></div>
                    </div>
                `;
            });

            // Display custom level tasks
            levelCustomTasks.forEach(task => {
                const canClaim = gameState.level >= task.level;
                const statusClass = canClaim ? 'task-ready' : '';
                const conditionClass = canClaim ? 'condition-completed' : 'condition-pending';

                tasksHTML += `
                    <div class="condition-item task-button ${statusClass}" onclick="claimCustomTask('${task.id}')" id="customTask_${task.id}">
                        <div class="condition-text">
                            <div>üèÜ ${task.name}</div>
                            <div style="font-size: 12px; color: #ccc;">Kerakli level: ${task.level} ‚Ä¢ Hozirgi: ${gameState.level}</div>
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status ${conditionClass}" id="customCondition_${task.id}"></div>
                    </div>
                `;
            });

            if (tasksHTML === '') {
                tasksHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hozircha level vazifalari yo\'q.</div>';
            }

            levelTasksList.innerHTML = tasksHTML;
        }

        function displayReferralTasks() {
            const referralTasksList = document.getElementById('referralTasksList');
            if (!referralTasksList) return;

            const referralTasks = [
                { id: 'referral1', name: 'Birinchi do\'stni taklif qiling', reward: 500, targetReferrals: 1 },
                { id: 'referral3', name: '3 ta do\'st taklif qiling', reward: 1500, targetReferrals: 3 },
                { id: 'referral', name: '5 ta do\'st taklif qiling', reward: 3000, targetReferrals: 5 },
                { id: 'referral10', name: '10 ta do\'st taklif qiling', reward: 6000, targetReferrals: 10 }
            ];

            // Add custom referral tasks
            const referralCustomTasks = customTasks.filter(task => 
                task.type === 'referral' && !task.completed
            );

            let tasksHTML = '';
            
            // Display standard referral tasks
            referralTasks.forEach(task => {
                // Check if task is hidden or deleted
                if (localStorage.getItem(`hiddenTask_${task.id}`) === 'true' || localStorage.getItem(`deletedTask_${task.id}`) === 'true') {
                    return; // Skip hidden or deleted tasks
                }

                const canClaim = gameState.referrals.length >= task.targetReferrals;
                const isCompleted = gameState.completedTasks[task.id];
                const statusClass = isCompleted ? 'completed' : (canClaim ? 'task-ready' : '');
                const conditionClass = isCompleted ? 'condition-completed' : (canClaim ? 'condition-completed' : 'condition-pending');

                tasksHTML += `
                    <div class="condition-item task-button ${statusClass}" onclick="claimTask('${task.id}')" id="${task.id}Task">
                        <div class="condition-text">
                            <div>${task.name}</div>
                            <div style="font-size: 12px; color: #ccc;">Progress: <span>${Math.min(gameState.referrals.length, task.targetReferrals)}</span>/${task.targetReferrals}</div>
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status ${conditionClass}" id="${task.id}Condition"></div>
                    </div>
                `;
            });

            // Display custom referral tasks
            referralCustomTasks.forEach(task => {
                const canClaim = gameState.referrals.length >= task.referralCount;
                const statusClass = canClaim ? 'task-ready' : '';
                const conditionClass = canClaim ? 'condition-completed' : 'condition-pending';

                tasksHTML += `
                    <div class="condition-item task-button ${statusClass}" onclick="claimCustomTask('${task.id}')" id="customTask_${task.id}">
                        <div class="condition-text">
                            <div>üë• ${task.name}</div>
                            <div style="font-size: 12px; color: #ccc;">Kerakli: ${task.referralCount} ‚Ä¢ Hozirgi: ${gameState.referrals.length}</div>
                        </div>
                        <div class="condition-reward">+${task.reward} DRC</div>
                        <div class="condition-status ${conditionClass}" id="customCondition_${task.id}"></div>
                    </div>
                `;
            });

            if (tasksHTML === '') {
                tasksHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hozircha referral vazifalari yo\'q.</div>';
            }

            referralTasksList.innerHTML = tasksHTML;
        }

        function getTaskCanClaim(taskId) {
            switch (taskId) {
                case 'taps': return gameState.totalTaps >= 500;
                case 'level': return gameState.level >= 5;
                case 'level3': return gameState.level >= 3;
                case 'level7': return gameState.level >= 7;
                case 'level10': return gameState.level >= 10;
                case 'coins': return gameState.balance >= 10000;
                case 'referral': return gameState.referrals.length >= 5;
                case 'referral1': return gameState.referrals.length >= 1;
                case 'referral3': return gameState.referrals.length >= 3;
                case 'referral10': return gameState.referrals.length >= 10;
                case 'telegram': return false; // Special handling
                case 'youtube': return false; // Special handling
                case 'code': return false; // Special handling
                default: return false;
            }
        }

        function showTaskCategory(category) {
            // Hide all panels
            document.getElementById('basicTasksPanel').style.display = 'none';
            document.getElementById('levelTasksPanel').style.display = 'none';
            document.getElementById('referralTasksPanel').style.display = 'none';
            document.getElementById('customTasksPanel').style.display = 'none';
            document.getElementById('completedTasksPanel').style.display = 'none';
            
            // Remove active class from all tabs
            document.getElementById('basicTasksTab').classList.remove('active');
            document.getElementById('levelTasksTab').classList.remove('active');
            document.getElementById('referralTasksTab').classList.remove('active');
            document.getElementById('customTasksTab').classList.remove('active');
            document.getElementById('completedTasksTab').classList.remove('active');
            
            // Show selected panel and activate tab
            switch(category) {
                case 'basic':
                    document.getElementById('basicTasksPanel').style.display = 'block';
                    document.getElementById('basicTasksTab').classList.add('active');
                    break;
                case 'level':
                    document.getElementById('levelTasksPanel').style.display = 'block';
                    document.getElementById('levelTasksTab').classList.add('active');
                    updateLevelTasksProgress();
                    break;
                case 'referral':
                    document.getElementById('referralTasksPanel').style.display = 'block';
                    document.getElementById('referralTasksTab').classList.add('active');
                    updateReferralTasksProgress();
                    break;
                case 'custom':
                    document.getElementById('customTasksPanel').style.display = 'block';
                    document.getElementById('customTasksTab').classList.add('active');
                    displayCustomTasks();
                    break;
                case 'completed':
                    document.getElementById('completedTasksPanel').style.display = 'block';
                    document.getElementById('completedTasksTab').classList.add('active');
                    displayCompletedTasks();
                    break;
            }
        }

        function updateLevelTasksProgress() {
            const currentLevel3 = document.getElementById('currentLevel3');
            const currentLevel7 = document.getElementById('currentLevel7');
            const currentLevel10 = document.getElementById('currentLevel10');
            
            if (currentLevel3) currentLevel3.textContent = gameState.level;
            if (currentLevel7) currentLevel7.textContent = gameState.level;
            if (currentLevel10) currentLevel10.textContent = gameState.level;
        }

        function updateReferralTasksProgress() {
            const referralProgress1 = document.getElementById('referralProgress1');
            const referralProgress3 = document.getElementById('referralProgress3');
            const referralProgress10 = document.getElementById('referralProgress10');
            
            if (referralProgress1) referralProgress1.textContent = Math.min(gameState.referrals.length, 1);
            if (referralProgress3) referralProgress3.textContent = Math.min(gameState.referrals.length, 3);
            if (referralProgress10) referralProgress10.textContent = Math.min(gameState.referrals.length, 10);
        }

        function displayCustomTasks() {
            const customTasksList = document.getElementById('customTasksList');
            
            // Clear existing tasks
            customTasksList.innerHTML = '';
            
            // Load latest custom tasks
            customTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
            
            // Only show tasks that don't belong to other categories
            const miscCustomTasks = customTasks.filter(task => 
                !['telegram', 'youtube', 'code', 'website', 'social', 'level', 'referral'].includes(task.type) && !task.completed
            );
            
            if (miscCustomTasks.length === 0) {
                customTasksList.innerHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Maxsus vazifalar mos kategoriyalarga joylashtirildi. Boshqa bo\'limlarga qarang!</div>';
                return;
            }
            
            // Add miscellaneous custom tasks
            miscCustomTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'condition-item task-button';
                taskElement.id = `customTask_${task.id}`;
                taskElement.onclick = () => claimCustomTask(task.id);
                
                const icon = getTaskIcon(task.type);
                
                taskElement.innerHTML = `
                    <div class="condition-text">
                        <div>${icon} ${task.name}</div>
                        <div style="font-size: 12px; color: #ccc;">${task.description || task.link}</div>
                    </div>
                    <div class="condition-reward">+${task.reward} DRC</div>
                    <div class="condition-status condition-pending" id="customCondition_${task.id}"></div>
                `;
                
                customTasksList.appendChild(taskElement);
            });
        }

        function getTaskIcon(taskType) {
            const icons = {
                telegram: 'üì±',
                youtube: 'üì∫',
                code: 'üîê',
                website: 'üåê',
                social: 'üì≤'
            };
            return icons[taskType] || 'üìã';
        }

        function claimCustomTask(taskId) {
            const task = customTasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            switch (task.type) {
                case 'telegram':
                    claimTelegramTask(task);
                    break;
                case 'youtube':
                    claimYouTubeTask(task);
                    break;
                case 'code':
                    claimCodeTask(task);
                    break;
                case 'website':
                    claimWebsiteTask(task);
                    break;
                case 'social':
                    claimSocialTask(task);
                    break;
                case 'level':
                    claimLevelTask(task);
                    break;
                case 'referral':
                    claimReferralTask(task);
                    break;
            }
        }

        function claimLevelTask(task) {
            if (gameState.level >= task.level) {
                completeCustomTask(task);
            } else {
                showNotification(`‚ùå Level ${task.level} ga yetishingiz kerak! Hozirgi level: ${gameState.level}`, 'error');
            }
        }

        function claimReferralTask(task) {
            if (gameState.referrals.length >= task.referralCount) {
                completeCustomTask(task);
            } else {
                showNotification(`‚ùå ${task.referralCount} ta referral kerak! Hozirgi: ${gameState.referrals.length}`, 'error');
            }
        }

        function claimTelegramTask(task) {
            // Extract channel username from link
            let channelUsername = task.link;
            if (channelUsername.includes('t.me/')) {
                channelUsername = channelUsername.split('t.me/')[1];
            }
            if (channelUsername.startsWith('@')) {
                channelUsername = channelUsername.substring(1);
            }
            
            // Open Telegram channel
            const telegramUrl = `https://t.me/${channelUsername}`;
            window.open(telegramUrl, '_blank');
            
            // Show verification dialog after 3 seconds
            setTimeout(() => {
                if (confirm(`${task.name} vazifasini bajardingizmi?\n\nAgar kanalga obuna bo'lgan bo'lsangiz, "OK" tugmasini bosing.`)) {
                    // In a real app, this would verify subscription via Telegram Bot API
                    // For now, we'll trust the user
                    completeCustomTask(task);
                }
            }, 3000);
        }

        function claimYouTubeTask(task) {
            // Open YouTube channel
            window.open(task.link, '_blank');
            
            // Show verification dialog after 3 seconds
            setTimeout(() => {
                if (confirm(`${task.name} vazifasini bajardingizmi?\n\nAgar kanalga obuna bo'lgan bo'lsangiz, "OK" tugmasini bosing.`)) {
                    // In a real app, this would verify subscription via YouTube API
                    // For now, we'll trust the user
                    completeCustomTask(task);
                }
            }, 3000);
        }

        function claimCodeTask(task) {
            const userCode = prompt(`${task.name}\n\nKodni kiriting:`);
            if (userCode && userCode.toUpperCase() === task.code.toUpperCase()) {
                completeCustomTask(task);
            } else if (userCode) {
                showNotification('‚ùå Noto\'g\'ri kod! Qaytadan urinib ko\'ring.', 'error');
            }
        }

        function claimWebsiteTask(task) {
            // Open website
            window.open(task.link, '_blank');
            
            // Show verification dialog after 5 seconds
            setTimeout(() => {
                if (confirm(`${task.name} vazifasini bajardingizmi?\n\nAgar websitega tashrif buyurgan bo'lsangiz, "OK" tugmasini bosing.`)) {
                    completeCustomTask(task);
                }
            }, 5000);
        }

        function claimSocialTask(task) {
            // Open social media link
            window.open(task.link, '_blank');
            
            // Show verification dialog after 3 seconds
            setTimeout(() => {
                if (confirm(`${task.name} vazifasini bajardingizmi?\n\nAgar vazifani bajargan bo'lsangiz, "OK" tugmasini bosing.`)) {
                    completeCustomTask(task);
                }
            }, 3000);
        }

        function completeCustomTask(task) {
            // Mark task as completed
            const taskIndex = customTasks.findIndex(t => t.id === task.id);
            if (taskIndex !== -1) {
                customTasks[taskIndex].completed = true;
                customTasks[taskIndex].completedDate = new Date().toLocaleDateString();
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Give reward
                gameState.balance += task.reward;
                
                showNotification(`‚úÖ ${task.name} bajarildi! +${task.reward} DRC olindi!`, 'success');
                
                // Update displays
                updateTasksDisplay();
                updateUI();
                saveGameState();
            }
        }

        function updateTaskStatus(taskType, canClaim) {
            const taskElement = document.getElementById(taskType + 'Task');
            const conditionElement = document.getElementById(taskType + 'Condition');
            
            // Check if elements exist before accessing classList
            if (!taskElement || !conditionElement) {
                return;
            }
            
            if (gameState.completedTasks[taskType]) {
                taskElement.classList.add('completed');
                conditionElement.classList.remove('condition-pending');
                conditionElement.classList.add('condition-completed');
            } else if (canClaim) {
                taskElement.classList.add('task-ready');
                conditionElement.classList.remove('condition-pending');
                conditionElement.classList.add('condition-completed');
            } else {
                taskElement.classList.remove('task-ready', 'completed');
                conditionElement.classList.remove('condition-completed');
                conditionElement.classList.add('condition-pending');
            }
        }

        function displayCompletedTasks() {
            const completedTasksList = document.getElementById('completedTasksList');
            const completedTasksCount = document.getElementById('completedTasksCount');
            const completedTasksTabCount = document.getElementById('completedTasksTabCount');
            
            // Get completed standard tasks
            const completedStandardTasks = Object.entries(gameState.completedTasks).filter(([key, value]) => value);
            
            // Get completed custom tasks
            const completedCustomTasks = customTasks.filter(task => task.completed);
            
            const totalCompleted = completedStandardTasks.length + completedCustomTasks.length;
            
            // Update counters
            completedTasksCount.textContent = totalCompleted;
            completedTasksTabCount.textContent = totalCompleted;
            
            if (totalCompleted === 0) {
                completedTasksList.innerHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hali bajarilgan vazifalar yo\'q. Vazifalarni bajaring!</div>';
                return;
            }
            
            const taskNames = {
                taps: { name: '500 marta tap qiling', reward: 1000, icon: 'üëÜ' },
                level: { name: 'Level 5 ga yeting', reward: 2000, icon: 'üèÜ' },
                level3: { name: 'Level 3 ga yeting', reward: 800, icon: 'üèÜ' },
                level7: { name: 'Level 7 ga yeting', reward: 4000, icon: 'üèÜ' },
                level10: { name: 'Level 10 ga yeting', reward: 8000, icon: 'üèÜ' },
                coins: { name: '10000 coin to\'plang', reward: 5000, icon: 'üí∞' },
                referral: { name: '5 ta do\'st taklif qiling', reward: 3000, icon: 'üë•' },
                referral1: { name: 'Birinchi do\'stni taklif qiling', reward: 500, icon: 'üë•' },
                referral3: { name: '3 ta do\'st taklif qiling', reward: 1500, icon: 'üë•' },
                referral10: { name: '10 ta do\'st taklif qiling', reward: 6000, icon: 'üë•' },
                telegram: { name: 'Telegram kanalga obuna bo\'ling', reward: 1500, icon: 'üì±' },
                youtube: { name: 'YouTube kanalga obuna bo\'ling', reward: 2000, icon: 'üì∫' },
                code: { name: 'Maxsus kodni kiriting', reward: 5000, icon: 'üîê' }
            };
            
            let tasksHTML = '';
            
            // Add completed standard tasks
            completedStandardTasks.forEach(([taskType]) => {
                const task = taskNames[taskType];
                if (task) {
                    tasksHTML += `
                        <div class="completed-task-item">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 20px;">${task.icon}</div>
                                <div class="completed-task-text">${task.name}</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="completed-task-reward">+${task.reward} DRC</div>
                                <div class="completed-task-check">‚úÖ</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Add completed custom tasks
            completedCustomTasks.forEach(task => {
                const icon = getTaskIcon(task.type);
                tasksHTML += `
                    <div class="completed-task-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 20px;">${icon}</div>
                            <div class="completed-task-text">${task.name}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="completed-task-reward">+${task.reward} DRC</div>
                            <div class="completed-task-check">‚úÖ</div>
                        </div>
                    </div>
                `;
            });
            
            completedTasksList.innerHTML = tasksHTML;
        }

        function updateCompletedTasksDisplay() {
            // Update the tab counter
            const completedStandardTasks = Object.entries(gameState.completedTasks).filter(([key, value]) => value);
            const completedCustomTasks = customTasks.filter(task => task.completed);
            const totalCompleted = completedStandardTasks.length + completedCustomTasks.length;
            
            const completedTasksTabCount = document.getElementById('completedTasksTabCount');
            if (completedTasksTabCount) {
                completedTasksTabCount.textContent = totalCompleted;
            }
        }

        function updateReferralDisplay() {
            document.getElementById('userReferralCode').textContent = gameState.referralCode;
            document.getElementById('totalReferrals').textContent = gameState.referrals.length;
            document.getElementById('referralEarnings').textContent = gameState.referralEarnings;
            
            const referralList = document.getElementById('referralList');
            if (gameState.referrals.length === 0) {
                referralList.innerHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hali referrallaringiz yo\'q. Do\'stlaringizni taklif qiling!</div>';
            } else {
                referralList.innerHTML = gameState.referrals.map(referral => `
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 12px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold;">${referral.name}</div>
                            <div style="font-size: 12px; color: #ccc;">Level ${referral.level} ‚Ä¢ ${referral.totalTaps} taps</div>
                        </div>
                        <div style="color: #00ff88; font-weight: bold;">+${referral.earnings} DRC</div>
                    </div>
                `).join('');
            }
        }

        function updateLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            const playerRank = document.getElementById('playerRank');
            const currentPlayerId = getUniquePlayerId();
            
            // Combine current player with global players
            const allPlayers = [...globalPlayers, {
                id: currentPlayerId,
                name: gameState.playerName,
                balance: gameState.balance,
                referrals: gameState.referrals.length,
                level: gameState.level,
                totalTaps: gameState.totalTaps,
                country: gameState.country,
                isCurrentPlayer: true,
                isOnline: true
            }];
            
            // Sort by balance
            allPlayers.sort((a, b) => (b.balance || 0) - (a.balance || 0));
            
            // Find current player rank
            const currentPlayerIndex = allPlayers.findIndex(p => p.isCurrentPlayer);
            playerRank.textContent = `#${currentPlayerIndex + 1}`;
            
            // Display top 10
            const top10 = allPlayers.slice(0, 10);
            leaderboardList.innerHTML = top10.map((player, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other';
                const isCurrentPlayer = player.isCurrentPlayer ? 'style="border: 2px solid #00ff88;"' : '';
                const clickable = !player.isCurrentPlayer ? 'onclick="showPlayerProfile(' + JSON.stringify(player).replace(/"/g, '&quot;') + ', ' + (index + 1) + ')" style="cursor: pointer;"' : '';
                
                return `
                    <div class="condition-item" ${isCurrentPlayer} ${clickable}>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px;" class="${rankClass}">
                                ${index + 1}
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #00ff88;">${player.name} ${player.isCurrentPlayer ? '(Siz)' : ''}</div>
                                <div style="font-size: 12px; color: #ccc;">
                                    Level ${player.level || 1} ‚Ä¢ ${player.country || 'UZ'} 
                                    ${player.isOnline ? 'üü¢' : 'üî¥'}
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 18px; font-weight: bold; color: #00ff88;">
                            ${(player.balance || 0).toLocaleString()} DRC
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateProfileDisplay() {
            // Update basic profile info
            const profilePlayerName = document.getElementById('profilePlayerName');
            const profilePlayerId = document.getElementById('profilePlayerId');
            const profileJoinDate = document.getElementById('profileJoinDate');
            
            if (profilePlayerName) profilePlayerName.textContent = gameState.playerName;
            if (profilePlayerId) profilePlayerId.textContent = `ID: ${getUniquePlayerId().substring(0, 12)}...`;
            if (profileJoinDate) {
                const joinDate = localStorage.getItem('dragonCoinJoinDate') || new Date().toLocaleDateString();
                if (!localStorage.getItem('dragonCoinJoinDate')) {
                    localStorage.setItem('dragonCoinJoinDate', joinDate);
                }
                profileJoinDate.textContent = joinDate;
            }
            
            // Update detailed stats
            const profileBalance = document.getElementById('profileBalance');
            const profileLevel = document.getElementById('profileLevel');
            const profileLevelName = document.getElementById('profileLevelName');
            const profileTotalTaps = document.getElementById('profileTotalTaps');
            const profileReferrals = document.getElementById('profileReferrals');
            
            if (profileBalance) profileBalance.textContent = gameState.balance.toLocaleString();
            if (profileLevel) profileLevel.textContent = gameState.level;
            if (profileLevelName) profileLevelName.textContent = levelSystem[gameState.level].name;
            if (profileTotalTaps) profileTotalTaps.textContent = gameState.totalTaps.toLocaleString();
            if (profileReferrals) profileReferrals.textContent = gameState.referrals.length;
            
            // Update game statistics
            const profileTapPower = document.getElementById('profileTapPower');
            const profileEnergy = document.getElementById('profileEnergy');
            const profileCompletedTasks = document.getElementById('profileCompletedTasks');
            const profileReferralEarnings = document.getElementById('profileReferralEarnings');
            
            if (profileTapPower) profileTapPower.textContent = gameState.tapPower;
            if (profileEnergy) profileEnergy.textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            
            const completedTasksCount = Object.values(gameState.completedTasks).filter(Boolean).length;
            if (profileCompletedTasks) profileCompletedTasks.textContent = completedTasksCount;
            if (profileReferralEarnings) profileReferralEarnings.textContent = gameState.referralEarnings;
            
            // Update achievements
            updateAchievements();
            
            // Update language display
            const currentLanguageDisplay = document.getElementById('currentLanguageDisplay');
            if (currentLanguageDisplay) {
                currentLanguageDisplay.textContent = `${countryFlags[currentLanguage]} ${currentLanguage.toUpperCase()}`;
            }
            
            // Update Firebase sync status
            const firebaseSyncStatus = document.getElementById('firebaseSyncStatus');
            if (firebaseSyncStatus) {
                if (firebaseConnected) {
                    firebaseSyncStatus.innerHTML = '<span style="color: #00ff88;">Ulandi ‚úÖ</span>';
                } else {
                    firebaseSyncStatus.innerHTML = '<span style="color: #ff6b35;">O\'chiq ‚ùå</span>';
                }
            }
        }

        function updateAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            const achievementsCount = document.getElementById('achievementsCount');
            
            const achievements = [];
            
            // Level achievements
            if (gameState.level >= 2) achievements.push({ name: 'Birinchi Level Up', desc: 'Level 2 ga yeting', icon: 'ü•â' });
            if (gameState.level >= 5) achievements.push({ name: 'Platina O\'yinchi', desc: 'Level 5 ga yeting', icon: 'ü•à' });
            if (gameState.level >= 10) achievements.push({ name: 'Afsonaviy Dragon', desc: 'Level 10 ga yeting', icon: 'ü•á' });
            
            // Tap achievements
            if (gameState.totalTaps >= 100) achievements.push({ name: 'Yuz Tap', desc: '100 marta tap qiling', icon: 'üëÜ' });
            if (gameState.totalTaps >= 1000) achievements.push({ name: 'Ming Tap', desc: '1000 marta tap qiling', icon: 'üí™' });
            if (gameState.totalTaps >= 10000) achievements.push({ name: 'O\'n Ming Tap', desc: '10000 marta tap qiling', icon: 'üî•' });
            
            // Balance achievements
            if (gameState.balance >= 1000) achievements.push({ name: 'Birinchi Ming', desc: '1000 coin to\'plang', icon: 'üí∞' });
            if (gameState.balance >= 10000) achievements.push({ name: 'O\'n Ming Coin', desc: '10000 coin to\'plang', icon: 'üíé' });
            if (gameState.balance >= 100000) achievements.push({ name: 'Yuz Ming Coin', desc: '100000 coin to\'plang', icon: 'üëë' });
            
            // Task achievements
            const completedTasksCount = Object.values(gameState.completedTasks).filter(Boolean).length;
            if (completedTasksCount >= 1) achievements.push({ name: 'Birinchi Vazifa', desc: 'Birinchi vazifani bajaring', icon: '‚úÖ' });
            if (completedTasksCount >= 3) achievements.push({ name: 'Vazifa Ustasi', desc: '3 ta vazifa bajaring', icon: 'üéØ' });
            if (completedTasksCount >= 7) achievements.push({ name: 'Barcha Vazifalar', desc: 'Barcha vazifalarni bajaring', icon: 'üèÜ' });
            
            // Referral achievements
            if (gameState.referrals.length >= 1) achievements.push({ name: 'Birinchi Referral', desc: 'Birinchi do\'stni taklif qiling', icon: 'üë•' });
            if (gameState.referrals.length >= 5) achievements.push({ name: 'Do\'stlar Jamoasi', desc: '5 ta do\'st taklif qiling', icon: 'ü§ù' });
            if (gameState.referrals.length >= 10) achievements.push({ name: 'Referral Qiroli', desc: '10 ta do\'st taklif qiling', icon: 'üëë' });
            
            achievementsCount.textContent = achievements.length;
            
            if (achievements.length === 0) {
                achievementsList.innerHTML = '<div style="text-align: center; color: #ccc; padding: 20px;">Hali yutuqlaringiz yo\'q. O\'ynashda davom eting!</div>';
            } else {
                achievementsList.innerHTML = achievements.map(achievement => `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: rgba(255, 215, 0, 0.05); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 215, 0, 0.2);">
                        <div style="font-size: 24px;">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: #FFD700;">${achievement.name}</div>
                            <div style="font-size: 12px; color: #ccc;">${achievement.desc}</div>
                        </div>
                        <div style="color: #FFD700; font-size: 18px;">üèÜ</div>
                    </div>
                `).join('');
            }
        }

        function showLeaderboard(type) {
            const coinsTab = document.getElementById('coinsLeaderboard');
            const referralsTab = document.getElementById('referralsLeaderboard');
            
            if (type === 'coins') {
                coinsTab.classList.add('active');
                referralsTab.classList.remove('active');
            } else {
                referralsTab.classList.add('active');
                coinsTab.classList.remove('active');
            }
            
            updateLeaderboard();
        }

        function copyReferralLink() {
            const referralCode = gameState.referralCode;
            const link = `https://t.me/Dragon_coin_money_bot?start=ref_${referralCode}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('‚úÖ Referral link nusxalandi!', 'success');
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('‚úÖ Referral link nusxalandi!', 'success');
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function checkLevelUp() {
            const currentLevelData = levelSystem[gameState.level];
            const nextLevelData = levelSystem[gameState.level + 1];
            
            if (nextLevelData && gameState.totalTaps >= nextLevelData.tapsRequired) {
                gameState.level++;
                showNotification(`üéâ Level Up! Level ${gameState.level} - ${levelSystem[gameState.level].name}`, 'success');
                updateUI();
            }
        }

        function updateUI() {
            // Update balance
            const balanceEl = document.getElementById('balance');
            if (balanceEl) balanceEl.textContent = gameState.balance.toLocaleString();
            
            // Update energy
            const energyPercentage = (gameState.energy / gameState.maxEnergy) * 100;
            const energyProgress = document.getElementById('energyProgress');
            const energyText = document.getElementById('energyText');
            if (energyProgress) energyProgress.style.width = energyPercentage + '%';
            if (energyText) energyText.textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            
            // Update stats
            const tapPowerEl = document.getElementById('tapPower');
            const totalTapsEl = document.getElementById('totalTaps');
            const levelEl = document.getElementById('level');
            const referralCountEl = document.getElementById('referralCount');
            
            if (tapPowerEl) tapPowerEl.textContent = gameState.tapPower;
            if (totalTapsEl) totalTapsEl.textContent = gameState.totalTaps.toLocaleString();
            if (levelEl) levelEl.textContent = gameState.level;
            if (referralCountEl) referralCountEl.textContent = gameState.referrals.length;
            
            // Update player name in header
            const playerNameEl = document.getElementById('playerName');
            if (playerNameEl) playerNameEl.textContent = gameState.playerName;
            
            // Update level info
            const currentLevelData = levelSystem[gameState.level];
            const nextLevelData = levelSystem[gameState.level + 1];
            
            const levelBadge = document.getElementById('levelBadge');
            const levelName = document.getElementById('levelName');
            const currentLevelDisplay = document.getElementById('currentLevelDisplay');
            
            if (levelBadge) levelBadge.textContent = `Level ${gameState.level}`;
            if (levelName) levelName.textContent = currentLevelData.name;
            if (currentLevelDisplay) currentLevelDisplay.textContent = `Level ${gameState.level} - ${currentLevelData.name}`;
            
            const nextLevelDisplay = document.getElementById('nextLevelDisplay');
            const currentTapsDisplay = document.getElementById('currentTapsDisplay');
            const requiredTapsDisplay = document.getElementById('requiredTapsDisplay');
            const levelProgressBar = document.getElementById('levelProgressBar');
            
            if (nextLevelData) {
                if (nextLevelDisplay) nextLevelDisplay.textContent = `Next: Level ${gameState.level + 1} - ${nextLevelData.name}`;
                if (currentTapsDisplay) currentTapsDisplay.textContent = `${gameState.totalTaps} taps`;
                if (requiredTapsDisplay) requiredTapsDisplay.textContent = `${nextLevelData.tapsRequired} taps kerak`;
                
                const progress = ((gameState.totalTaps - currentLevelData.tapsRequired) / (nextLevelData.tapsRequired - currentLevelData.tapsRequired)) * 100;
                if (levelProgressBar) levelProgressBar.style.width = Math.max(0, Math.min(100, progress)) + '%';
            } else {
                if (nextLevelDisplay) nextLevelDisplay.textContent = 'Max Level!';
                if (levelProgressBar) levelProgressBar.style.width = '100%';
            }
        }

        // Optimized UI update for mobile - only updates essential elements during tapping
        function updateUIOptimized() {
            // Only update critical elements during rapid tapping
            const balanceEl = document.getElementById('balance');
            if (balanceEl) balanceEl.textContent = gameState.balance.toLocaleString();
            
            const energyPercentage = (gameState.energy / gameState.maxEnergy) * 100;
            const energyProgress = document.getElementById('energyProgress');
            const energyText = document.getElementById('energyText');
            if (energyProgress) energyProgress.style.width = energyPercentage + '%';
            if (energyText) energyText.textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            
            // Update tap count less frequently
            const totalTapsEl = document.getElementById('totalTaps');
            if (totalTapsEl && gameState.totalTaps % 5 === 0) {
                totalTapsEl.textContent = gameState.totalTaps.toLocaleString();
            }
        }

        function saveGameState() {
            localStorage.setItem('dragonCoinGameState', JSON.stringify(gameState));
            localStorage.setItem('dragonCoinLanguage', currentLanguage);
            
            if (firebaseConnected) {
                savePlayerToFirebase();
            }
        }

        function loadGameState() {
            const saved = localStorage.getItem('dragonCoinGameState');
            const savedLanguage = localStorage.getItem('dragonCoinLanguage');
            
            if (saved) {
                const loadedState = JSON.parse(saved);
                gameState = { ...gameState, ...loadedState };
            }
            
            if (savedLanguage) {
                currentLanguage = savedLanguage;
                updateLanguageDisplay();
                translatePage();
            }
        }

        // Energy regeneration
        function startEnergyRegeneration() {
            setInterval(() => {
                if (gameState.energy < gameState.maxEnergy) {
                    gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 1);
                    updateUI();
                }
            }, gameState.rechargeSpeed); // Use dynamic recharge speed
        }

        // Initialize game
        function initGame() {
            console.log('üéÆ O\'yin boshlanmoqda...');
            
            // First get Telegram user data and update name
            const tgData = getTelegramUserData();
            console.log('üì± Telegram ma\'lumotlari:', tgData);
            
            if (tgData && tgData.username) {
                console.log('‚úÖ Telegram nomini o\'rnatish:', tgData.username);
                gameState.playerName = tgData.username;
            } else {
                console.log('‚ö†Ô∏è Telegram nomi topilmadi, standart nom qoldiriladi:', gameState.playerName);
            }
            
            detectCountryAndLanguage();
            loadGameState();
            
            // Update name again after loading state (in case Telegram data is newer)
            if (tgData && tgData.username) {
                console.log('üîÑ Nomni qayta yangilash:', tgData.username);
                gameState.playerName = tgData.username;
            }
            
            console.log('üë§ Yakuniy foydalanuvchi nomi:', gameState.playerName);
            
            updateUI();
            updateTasksDisplay();
            startEnergyRegeneration();
            initializeFirebaseConnection();
            checkAdminAccess();
            
            // Process referral if exists
            processReferralFromURL();
            
            // Auto-save every 30 seconds
            setInterval(saveGameState, 30000);
            
            // Start periodic Firebase sync checking
            setTimeout(() => {
                loadGlobalTaskSettings();
            }, 3000); // Start checking after 3 seconds
        }
        
        function processReferralFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const startParam = urlParams.get('start');
            
            if (startParam && startParam.startsWith('ref_')) {
                const referralCode = startParam.substring(4);
                if (referralCode && !gameState.referredBy) {
                    gameState.referredBy = referralCode;
                    // Add referral bonus
                    gameState.balance += 500;
                    showNotification('üéâ Referral bonusi! +500 DRC olindi!', 'success');
                    saveGameState();
                }
            }
        }

        // Player profile modal functions
        function showPlayerProfile(player, rank) {
            const modal = document.getElementById('playerProfileModal');
            
            // Update modal content
            document.getElementById('modalPlayerName').textContent = player.name;
            document.getElementById('modalPlayerCountry').textContent = `${countryFlags[player.country?.toLowerCase()] || 'üåç'} ${player.country || 'Unknown'}`;
            document.getElementById('modalPlayerStatus').textContent = player.isOnline ? 'üü¢ Online' : 'üî¥ Offline';
            document.getElementById('modalPlayerBalance').textContent = (player.balance || 0).toLocaleString();
            document.getElementById('modalPlayerLevel').textContent = player.level || 1;
            document.getElementById('modalPlayerLevelName').textContent = levelSystem[player.level || 1]?.name || 'Wood';
            document.getElementById('modalPlayerTaps').textContent = (player.totalTaps || 0).toLocaleString();
            document.getElementById('modalPlayerReferrals').textContent = player.referrals || 0;
            document.getElementById('modalPlayerRank').textContent = `#${rank}`;
            
            // Calculate last seen
            const lastSeen = player.lastUpdate ? new Date(player.lastUpdate) : new Date();
            const timeDiff = Date.now() - lastSeen.getTime();
            const minutesAgo = Math.floor(timeDiff / (1000 * 60));
            const hoursAgo = Math.floor(timeDiff / (1000 * 60 * 60));
            const daysAgo = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            let lastSeenText = 'Hozir';
            if (player.isOnline) {
                lastSeenText = 'Hozir';
            } else if (minutesAgo < 60) {
                lastSeenText = `${minutesAgo} daqiqa oldin`;
            } else if (hoursAgo < 24) {
                lastSeenText = `${hoursAgo} soat oldin`;
            } else {
                lastSeenText = `${daysAgo} kun oldin`;
            }
            
            document.getElementById('modalPlayerLastSeen').textContent = lastSeenText;
            
            // Player type
            const playerType = player.id?.startsWith('tg_') ? 'Telegram User' : 
                              player.id?.startsWith('demo_') ? 'Demo Player' : 'Real Player';
            document.getElementById('modalPlayerType').textContent = playerType;
            
            // Show modal
            modal.style.display = 'block';
            
            // Store current player for challenge
            window.currentModalPlayer = player;
        }

        function closePlayerModal() {
            document.getElementById('playerProfileModal').style.display = 'none';
            window.currentModalPlayer = null;
        }

        function challengePlayer() {
            if (!window.currentModalPlayer) return;
            
            const player = window.currentModalPlayer;
            showNotification(`üéØ ${player.name} ga raqobat e'lon qilindi! Tez orada raqobat tizimi ishga tushadi.`, 'success');
            closePlayerModal();
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('playerProfileModal');
            if (event.target === modal) {
                closePlayerModal();
            }
        });

        // Admin functions
        function checkAdminAccess() {
            const tgData = getTelegramUserData();
            const adminUsernames = ['@H08_09']; // Admin usernames
            
            if (tgData && (adminUsernames.includes(tgData.username) || tgData.username === 'H08_09')) {
                document.getElementById('adminTab').style.display = 'block';
                return true;
            }
            return false;
        }

        function updateAdminDisplay() {
            // Calculate system statistics
            const allPlayers = [...globalPlayers, {
                balance: gameState.balance,
                totalTaps: gameState.totalTaps,
                referrals: gameState.referrals.length,
                completedTasks: Object.values(gameState.completedTasks).filter(Boolean).length,
                isOnline: true
            }];

            const totalPlayers = allPlayers.length;
            const onlinePlayers = allPlayers.filter(p => p.isOnline).length;
            const totalCoins = allPlayers.reduce((sum, p) => sum + (p.balance || 0), 0);
            const totalTaps = allPlayers.reduce((sum, p) => sum + (p.totalTaps || 0), 0);
            const totalReferrals = allPlayers.reduce((sum, p) => sum + (p.referrals || 0), 0);
            const totalCompletedTasks = allPlayers.reduce((sum, p) => sum + (p.completedTasks || 0), 0);

            // Update display
            document.getElementById('totalPlayersCount').textContent = totalPlayers;
            document.getElementById('onlinePlayersCount').textContent = onlinePlayers;
            document.getElementById('totalCoinsCount').textContent = totalCoins.toLocaleString();
            document.getElementById('totalTapsSystem').textContent = totalTaps.toLocaleString();
            document.getElementById('totalReferralsSystem').textContent = totalReferrals;
            document.getElementById('completedTasksSystem').textContent = totalCompletedTasks;
            document.getElementById('activeBoostsSystem').textContent = '0'; // Placeholder

            // Update recent activity
            updateRecentActivity();
        }

        function updateRecentActivity() {
            const activities = [
                { time: '2 daqiqa oldin', action: 'Yangi o\'yinchi ro\'yxatdan o\'tdi', player: 'CryptoKing' },
                { time: '5 daqiqa oldin', action: 'Level 5 ga yetdi', player: 'DragonMaster' },
                { time: '10 daqiqa oldin', action: 'Referral bonus oldi', player: 'TapLegend' },
                { time: '15 daqiqa oldin', action: 'Boost sotib oldi', player: 'CoinHunter' },
                { time: '20 daqiqa oldin', action: 'Vazifa bajardi', player: 'GoldDigger' }
            ];

            const recentActivityList = document.getElementById('recentActivityList');
            recentActivityList.innerHTML = activities.map(activity => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: bold; color: #00ff88;">${activity.player}</div>
                        <div style="font-size: 12px; color: #ccc;">${activity.action}</div>
                    </div>
                    <div style="font-size: 12px; color: #ccc;">${activity.time}</div>
                </div>
            `).join('');
        }

        // Custom tasks system
        let customTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');

        function adminAction(action) {
            switch (action) {
                case 'addCoins':
                    const playerName = prompt('O\'yinchi nomini kiriting:');
                    const coinAmount = prompt('Coin miqdorini kiriting:');
                    if (playerName && coinAmount && !isNaN(coinAmount)) {
                        // In a real implementation, this would update the specific player's data
                        showNotification(`‚úÖ ${playerName} ga ${coinAmount} coin qo'shildi!`, 'success');
                    }
                    break;
                case 'resetPlayer':
                    const resetPlayerName = prompt('Qayta boshlanadigan o\'yinchi nomini kiriting:');
                    if (resetPlayerName && confirm(`${resetPlayerName} o'yinchisini qayta boshlashni tasdiqlaysizmi?`)) {
                        showNotification(`‚úÖ ${resetPlayerName} o'yinchisi qayta boshlandi!`, 'success');
                    }
                    break;
                case 'broadcastMessage':
                    const message = prompt('Barcha o\'yinchilarga yuboriladigan xabarni kiriting:');
                    if (message) {
                        showNotification(`üì¢ Xabar barcha o'yinchilarga yuborildi: "${message}"`, 'success');
                    }
                    break;
                case 'systemMaintenance':
                    if (confirm('Tizimni texnik xizmatga o\'tkazishni tasdiqlaysizmi?')) {
                        showNotification('üîß Tizim texnik xizmat rejimiga o\'tkazildi!', 'success');
                    }
                    break;
                case 'addTask':
                    showAddTaskModal();
                    break;
                case 'removeTask':
                    showRemoveTaskModal();
                    break;
                case 'editTask':
                    showEditTaskModal();
                    break;
                case 'viewTasks':
                    showViewTasksModal();
                    break;
            }
        }

        function showAddTaskModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="addTask"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'addTask');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; border: 2px solid rgba(0,255,136,0.3); box-shadow: 0 0 50px rgba(0,255,136,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #00ff88; margin: 0;">‚ûï Yangi Vazifa Qo'shish</h3>
                        <button onclick="closeAddTaskModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa turi:</label>
                        <select id="taskType" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                            <option value="telegram">üì± Telegram kanalga obuna</option>
                            <option value="youtube">üì∫ YouTube kanalga obuna</option>
                            <option value="code">üîê Maxsus kod kiritish</option>
                            <option value="website">üåê Websitega tashrif</option>
                            <option value="social">üì≤ Ijtimoiy tarmoq</option>
                            <option value="level">üèÜ Level vazifasi</option>
                            <option value="referral">üë• Referral vazifasi</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa nomi:</label>
                        <input type="text" id="taskName" placeholder="Masalan: Dragon Coin kanalga obuna bo'ling" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Tavsif:</label>
                        <input type="text" id="taskDesc" placeholder="Qo'shimcha ma'lumot" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="linkSection" style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Link/Kanal nomi:</label>
                        <input type="text" id="taskLink" placeholder="@DragonCoinChannel yoki https://..." style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Mukofot (DRC):</label>
                        <input type="number" id="taskReward" placeholder="1500" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="codeSection" style="margin-bottom: 15px; display: none;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">To'g'ri kod:</label>
                        <input type="text" id="taskCode" placeholder="DRAGON2024" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="levelSection" style="margin-bottom: 15px; display: none;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli level:</label>
                        <input type="number" id="taskLevel" placeholder="15" min="1" max="50" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="referralSection" style="margin-bottom: 15px; display: none;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli referral soni:</label>
                        <input type="number" id="taskReferralCount" placeholder="15" min="1" max="100" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="closeAddTaskModal()" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Bekor qilish</button>
                        <button onclick="addCustomTask()" style="flex: 1; background: linear-gradient(45deg, #00ff88, #00cc6a); border: none; color: #000; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Qo'shish</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show/hide sections based on task type
            document.getElementById('taskType').addEventListener('change', function() {
                const codeSection = document.getElementById('codeSection');
                const levelSection = document.getElementById('levelSection');
                const referralSection = document.getElementById('referralSection');
                const linkSection = document.getElementById('linkSection');
                
                // Hide all sections first
                codeSection.style.display = 'none';
                levelSection.style.display = 'none';
                referralSection.style.display = 'none';
                linkSection.style.display = 'block';
                
                // Show relevant section
                if (this.value === 'code') {
                    codeSection.style.display = 'block';
                } else if (this.value === 'level') {
                    levelSection.style.display = 'block';
                    linkSection.style.display = 'none';
                } else if (this.value === 'referral') {
                    referralSection.style.display = 'block';
                    linkSection.style.display = 'none';
                }
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeAddTaskModal();
                }
            });
        }

        function closeAddTaskModal() {
            const modal = document.querySelector('[data-modal="addTask"]');
            if (modal) {
                modal.remove();
            }
        }

        // YANGI: Improved addCustomTask function with better Firebase sync
        function addCustomTask() {
            const taskType = document.getElementById('taskType').value;
            const taskName = document.getElementById('taskName').value;
            const taskDesc = document.getElementById('taskDesc').value;
            const taskLink = document.getElementById('taskLink').value;
            const taskReward = parseInt(document.getElementById('taskReward').value);
            const taskCode = document.getElementById('taskCode').value;
            const taskLevel = document.getElementById('taskLevel') ? parseInt(document.getElementById('taskLevel').value) : null;
            const taskReferralCount = document.getElementById('taskReferralCount') ? parseInt(document.getElementById('taskReferralCount').value) : null;
            
            if (!taskName || !taskReward || isNaN(taskReward)) {
                showNotification('‚ùå Barcha maydonlarni to\'ldiring!', 'error');
                return;
            }
            
            // Additional validation for level and referral tasks
            if (taskType === 'level' && (!taskLevel || isNaN(taskLevel) || taskLevel < 1)) {
                showNotification('‚ùå Level raqamini to\'g\'ri kiriting!', 'error');
                return;
            }
            
            if (taskType === 'referral' && (!taskReferralCount || isNaN(taskReferralCount) || taskReferralCount < 1)) {
                showNotification('‚ùå Referral sonini to\'g\'ri kiriting!', 'error');
                return;
            }
            
            const newTask = {
                id: 'custom_' + Date.now(),
                type: taskType,
                name: taskName,
                description: taskDesc,
                link: taskLink,
                reward: taskReward,
                code: taskCode,
                level: taskLevel,
                referralCount: taskReferralCount,
                completed: false,
                dateAdded: new Date().toLocaleDateString(),
                createdBy: getUniquePlayerId() // Track who created the task
            };
            
            console.log('‚ûï Yangi vazifa qo\'shilmoqda:', newTask);
            
            customTasks.push(newTask);
            localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
            
            // Close modal first
            closeAddTaskModal();
            
            // Save to Firebase with retry mechanism
            const saveSuccess = saveGlobalTaskSettings();
            
            if (saveSuccess !== false) {
                showNotification(`‚úÖ "${taskName}" vazifasi barcha o'yinchilar uchun qo'shildi!`, 'success');
                
                // Force immediate sync check for other players
                setTimeout(() => {
                    if (firebaseConnected) {
                        // Trigger immediate update check
                        checkForGlobalTaskUpdates();
                        showNotification('üåê Vazifa barcha o\'yinchilarga yuborildi!', 'success');
                    }
                }, 500);
            } else {
                showNotification(`‚úÖ "${taskName}" vazifasi qo'shildi! (Faqat mahalliy)`, 'success');
            }
            
            // Update display immediately
            updateTasksDisplay();
            
            // Show notification about where the task was added
            const categoryName = getCategoryName(taskType);
            setTimeout(() => {
                showNotification(`üìç Vazifa "${categoryName}" bo'limiga joylashtirildi!`, 'success');
            }, 2000);
        }
        
        function getCategoryName(taskType) {
            switch(taskType) {
                case 'telegram':
                case 'youtube':
                case 'code':
                case 'website':
                case 'social':
                    return 'Asosiy Vazifalar';
                case 'level':
                    return 'Level Vazifalari';
                case 'referral':
                    return 'Referral Vazifalari';
                default:
                    return 'Maxsus Vazifalar';
            }
        }

        function showRemoveTaskModal() {
            // Load latest custom tasks
            customTasks = JSON.parse(localStorage.getItem('dragonCoinCustomTasks') || '[]');
            
            // Get all tasks (standard + custom)
            const standardTasks = [
                { id: 'taps', name: '500 marta tap qiling', reward: 1000, type: 'standard', category: 'Asosiy' },
                { id: 'level', name: 'Level 5 ga yeting', reward: 2000, type: 'standard', category: 'Asosiy' },
                { id: 'level3', name: 'Level 3 ga yeting', reward: 800, type: 'standard', category: 'Level' },
                { id: 'level7', name: 'Level 7 ga yeting', reward: 4000, type: 'standard', category: 'Level' },
                { id: 'level10', name: 'Level 10 ga yeting', reward: 8000, type: 'standard', category: 'Level' },
                { id: 'coins', name: '10000 coin to\'plang', reward: 5000, type: 'standard', category: 'Asosiy' },
                { id: 'referral', name: '5 ta do\'st taklif qiling', reward: 3000, type: 'standard', category: 'Asosiy' },
                { id: 'referral1', name: 'Birinchi do\'stni taklif qiling', reward: 500, type: 'standard', category: 'Referral' },
                { id: 'referral3', name: '3 ta do\'st taklif qiling', reward: 1500, type: 'standard', category: 'Referral' },
                { id: 'referral10', name: '10 ta do\'st taklif qiling', reward: 6000, type: 'standard', category: 'Referral' },
                { id: 'telegram', name: 'Telegram kanalga obuna bo\'ling', reward: 1500, type: 'standard', category: 'Asosiy' },
                { id: 'youtube', name: 'YouTube kanalga obuna bo\'ling', reward: 2000, type: 'standard', category: 'Asosiy' },
                { id: 'code', name: 'Maxsus kodni kiriting', reward: 5000, type: 'standard', category: 'Asosiy' }
            ];
            
            const allTasks = [
                ...standardTasks.map(task => ({
                    ...task,
                    isHidden: localStorage.getItem(`hiddenTask_${task.id}`) === 'true',
                    dateAdded: 'Dastur tomonidan'
                })),
                ...customTasks.map(task => ({
                    ...task,
                    type: 'custom',
                    category: 'Admin qo\'shgan',
                    isHidden: false
                }))
            ];
            
            if (allTasks.length === 0) {
                showNotification('‚ùå O\'chiriladigan vazifa yo\'q!', 'error');
                return;
            }
            
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="removeTask"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'removeTask');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const tasksList = allTasks.map(task => {
                const statusText = task.isHidden ? 'Yashirilgan' : 'Ko\'rinmoqda';
                const statusColor = task.isHidden ? '#ff6b35' : '#00ff88';
                const isDeleted = localStorage.getItem(`deletedTask_${task.id}`) === 'true';
                
                if (isDeleted && task.type === 'standard') {
                    return ''; // Don't show deleted standard tasks
                }
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${task.type === 'standard' ? '#FFD700' : '#00ff88'};">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: ${statusColor};">${task.name}</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 2px;">
                                ${task.reward} DRC ‚Ä¢ ${task.category} ‚Ä¢ ${task.dateAdded}
                            </div>
                            <div style="font-size: 10px; color: ${statusColor}; margin-top: 2px;">
                                ${task.type === 'standard' ? 'üìã Standart vazifa' : '‚≠ê Admin vazifasi'} ‚Ä¢ ${statusText}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${task.type === 'standard' ? `
                                <button onclick="${task.isHidden ? 'showStandardTask' : 'hideStandardTask'}('${task.id}')" style="background: ${task.isHidden ? '#00ff88' : '#FFD700'}; color: ${task.isHidden ? '#fff' : '#000'}; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px;">
                                    ${task.isHidden ? 'Ko\'rsatish' : 'Yashirish'}
                                </button>
                                <button onclick="deleteStandardTask('${task.id}')" style="background: #ff6b35; color: #fff; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px;">
                                    O'chirish
                                </button>
                            ` : `
                                <button onclick="removeCustomTask('${task.id}')" style="background: #ff6b35; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                    O'chirish
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }).filter(html => html !== '').join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; border: 2px solid rgba(255,107,53,0.3); box-shadow: 0 0 50px rgba(255,107,53,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #ff6b35; margin: 0;">üóëÔ∏è Vazifalarni Boshqarish</h3>
                        <button onclick="closeRemoveTaskModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <div style="color: #FFD700; font-weight: bold; margin-bottom: 8px;">‚ÑπÔ∏è Ma'lumot:</div>
                        <div style="font-size: 12px; color: #ccc; line-height: 1.4;">
                            ‚Ä¢ <strong>Standart vazifalar</strong> - dastur tomonidan yaratilgan, faqat yashirish/ko'rsatish mumkin<br>
                            ‚Ä¢ <strong>Admin vazifalari</strong> - siz qo'shgan, to'liq o'chirish mumkin<br>
                            ‚Ä¢ Yashirilgan vazifalar o'yinchilarga ko'rinmaydi
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="resetAllStandardTasks()" style="flex: 1; background: #FFD700; color: #000; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Barcha Standart Vazifalarni Qayta Tiklash</button>
                        <button onclick="closeRemoveTaskModal()" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Yopish</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeRemoveTaskModal();
                }
            });
        }

        function closeRemoveTaskModal() {
            const modal = document.querySelector('[data-modal="removeTask"]');
            if (modal) {
                modal.remove();
            }
        }

        // YANGI: Improved removeCustomTask function with better Firebase sync
        function removeCustomTask(taskId) {
            const taskToRemove = customTasks.find(task => task.id === taskId);
            if (!taskToRemove) return;
            
            if (confirm(`"${taskToRemove.name}" vazifasini barcha o'yinchilar uchun o'chirishni tasdiqlaysizmi?`)) {
                console.log('üóëÔ∏è Maxsus vazifa o\'chirilmoqda:', taskToRemove);
                
                customTasks = customTasks.filter(task => task.id !== taskId);
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Close modal first
                closeRemoveTaskModal();
                
                // Save to Firebase with retry mechanism
                const saveSuccess = saveGlobalTaskSettings();
                
                if (saveSuccess !== false) {
                    showNotification('‚úÖ Vazifa barcha o\'yinchilar uchun o\'chirildi!', 'success');
                    
                    // Force immediate sync check for other players
                    setTimeout(() => {
                        if (firebaseConnected) {
                            checkForGlobalTaskUpdates();
                            showNotification('üåê O\'zgarish barcha o\'yinchilarga yuborildi!', 'success');
                        }
                    }, 500);
                } else {
                    showNotification('‚úÖ Vazifa o\'chirildi! (Faqat mahalliy)', 'success');
                }
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function hideStandardTask(taskId) {
            console.log('üëÅÔ∏è Standart vazifa yashirilmoqda:', taskId);
            
            localStorage.setItem(`hiddenTask_${taskId}`, 'true');
            
            // Close modal first
            closeRemoveTaskModal();
            
            // Save to Firebase
            const saveSuccess = saveGlobalTaskSettings();
            
            if (saveSuccess !== false) {
                showNotification('‚úÖ Vazifa barcha o\'yinchilar uchun yashirildi!', 'success');
                
                // Force sync
                setTimeout(() => {
                    if (firebaseConnected) {
                        checkForGlobalTaskUpdates();
                    }
                }, 500);
            } else {
                showNotification('‚úÖ Vazifa yashirildi! (Faqat mahalliy)', 'success');
            }
            
            // Update display immediately
            updateTasksDisplay();
        }

        function showStandardTask(taskId) {
            console.log('üëÅÔ∏è Standart vazifa ko\'rsatilmoqda:', taskId);
            
            localStorage.removeItem(`hiddenTask_${taskId}`);
            
            // Close modal first
            closeRemoveTaskModal();
            
            // Save to Firebase
            const saveSuccess = saveGlobalTaskSettings();
            
            if (saveSuccess !== false) {
                showNotification('‚úÖ Vazifa barcha o\'yinchilar uchun ko\'rsatildi!', 'success');
                
                // Force sync
                setTimeout(() => {
                    if (firebaseConnected) {
                        checkForGlobalTaskUpdates();
                    }
                }, 500);
            } else {
                showNotification('‚úÖ Vazifa ko\'rsatildi! (Faqat mahalliy)', 'success');
            }
            
            // Update display immediately
            updateTasksDisplay();
        }

        function deleteStandardTask(taskId) {
            const taskNames = {
                taps: '500 marta tap qiling',
                level: 'Level 5 ga yeting',
                level3: 'Level 3 ga yeting',
                level7: 'Level 7 ga yeting',
                level10: 'Level 10 ga yeting',
                coins: '10000 coin to\'plang',
                referral: '5 ta do\'st taklif qiling',
                referral1: 'Birinchi do\'stni taklif qiling',
                referral3: '3 ta do\'st taklif qiling',
                referral10: '10 ta do\'st taklif qiling',
                telegram: 'Telegram kanalga obuna bo\'ling',
                youtube: 'YouTube kanalga obuna bo\'ling',
                code: 'Maxsus kodni kiriting'
            };
            
            const taskName = taskNames[taskId] || taskId;
            
            if (confirm(`"${taskName}" vazifasini barcha o'yinchilar uchun butunlay o'chirishni tasdiqlaysizmi?\n\nBu vazifa hech kimga ko'rinmaydi.`)) {
                console.log('üóëÔ∏è Standart vazifa o\'chirilmoqda:', taskId);
                
                localStorage.setItem(`deletedTask_${taskId}`, 'true');
                
                // Close modal first
                closeRemoveTaskModal();
                
                // Save to Firebase
                const saveSuccess = saveGlobalTaskSettings();
                
                if (saveSuccess !== false) {
                    showNotification('‚úÖ Vazifa barcha o\'yinchilar uchun o\'chirildi!', 'success');
                    
                    // Force sync
                    setTimeout(() => {
                        if (firebaseConnected) {
                            checkForGlobalTaskUpdates();
                        }
                    }, 500);
                } else {
                    showNotification('‚úÖ Vazifa o\'chirildi! (Faqat mahalliy)', 'success');
                }
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function resetAllStandardTasks() {
            if (confirm('Barcha standart vazifalarni barcha o\'yinchilar uchun qayta tiklashni tasdiqlaysizmi?\n\nBu barcha yashirilgan va o\'chirilgan standart vazifalarni qaytaradi.')) {
                console.log('üîÑ Barcha standart vazifalar qayta tiklanmoqda');
                
                const standardTaskIds = ['taps', 'level', 'level3', 'level7', 'level10', 'coins', 'referral', 'referral1', 'referral3', 'referral10', 'telegram', 'youtube', 'code'];
                
                standardTaskIds.forEach(taskId => {
                    localStorage.removeItem(`hiddenTask_${taskId}`);
                    localStorage.removeItem(`deletedTask_${taskId}`);
                });
                
                // Close modal first
                closeRemoveTaskModal();
                
                // Save to Firebase
                const saveSuccess = saveGlobalTaskSettings();
                
                if (saveSuccess !== false) {
                    showNotification('‚úÖ Barcha vazifalar barcha o\'yinchilar uchun qayta tiklandi!', 'success');
                    
                    // Force sync
                    setTimeout(() => {
                        if (firebaseConnected) {
                            checkForGlobalTaskUpdates();
                        }
                    }, 500);
                } else {
                    showNotification('‚úÖ Barcha vazifalar qayta tiklandi! (Faqat mahalliy)', 'success');
                }
                
                // Update display immediately
                updateTasksDisplay();
            }
        }

        function showViewTasksModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="viewTasks"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'viewTasks');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const allTasks = [
                ...Object.entries(gameState.completedTasks).map(([key, completed]) => ({
                    name: getTaskName(key),
                    type: 'Standart',
                    completed: completed,
                    reward: getTaskReward(key)
                })),
                ...customTasks.map(task => ({
                    name: task.name,
                    type: 'Maxsus',
                    completed: task.completed,
                    reward: task.reward
                }))
            ];
            
            const tasksList = allTasks.map(task => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${task.completed ? '#00ff88' : '#ff6b35'};">
                    <div>
                        <div style="font-weight: bold; color: ${task.completed ? '#00ff88' : '#fff'};">${task.name}</div>
                        <div style="font-size: 12px; color: #ccc;">${task.type} vazifa ‚Ä¢ ${task.reward} DRC</div>
                    </div>
                    <div style="color: ${task.completed ? '#00ff88' : '#ff6b35'}; font-size: 18px;">
                        ${task.completed ? '‚úÖ' : '‚è≥'}
                    </div>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; border: 2px solid rgba(255,215,0,0.3); box-shadow: 0 0 50px rgba(255,215,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #FFD700; margin: 0;">üìã Barcha Vazifalar</h3>
                        <button onclick="closeViewTasksModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; text-align: center;">
                        <div style="flex: 1; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${allTasks.filter(t => t.completed).length}</div>
                            <div style="font-size: 12px; color: #ccc;">Bajarilgan</div>
                        </div>
                        <div style="flex: 1; padding: 15px; background: rgba(255,107,53,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #ff6b35;">${allTasks.filter(t => !t.completed).length}</div>
                            <div style="font-size: 12px; color: #ccc;">Kutilmoqda</div>
                        </div>
                        <div style="flex: 1; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FFD700;">${allTasks.length}</div>
                            <div style="font-size: 12px; color: #ccc;">Jami</div>
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="clearAllCustomTasks()" style="flex: 1; background: #ff6b35; color: #fff; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Barcha Maxsus Vazifalarni O'chirish</button>
                        <button onclick="closeViewTasksModal()" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Yopish</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeViewTasksModal();
                }
            });
        }

        function closeViewTasksModal() {
            const modal = document.querySelector('[data-modal="viewTasks"]');
            if (modal) {
                modal.remove();
            }
        }

        function clearAllCustomTasks() {
            if (confirm('Barcha maxsus vazifalarni barcha o\'yinchilar uchun o\'chirishni tasdiqlaysizmi? Bu amalni bekor qilib bo\'lmaydi!')) {
                console.log('üóëÔ∏è Barcha maxsus vazifalar o\'chirilmoqda');
                
                customTasks = [];
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Close modal first
                closeViewTasksModal();
                
                // Save to Firebase
                const saveSuccess = saveGlobalTaskSettings();
                
                if (saveSuccess !== false) {
                    showNotification('‚úÖ Barcha maxsus vazifalar barcha o\'yinchilar uchun o\'chirildi!', 'success');
                    
                    // Force sync
                    setTimeout(() => {
                        if (firebaseConnected) {
                            checkForGlobalTaskUpdates();
                        }
                    }, 500);
                } else {
                    showNotification('‚úÖ Barcha maxsus vazifalar o\'chirildi! (Faqat mahalliy)', 'success');
                }
                
                updateTasksDisplay();
            }
        }

        function getTaskName(taskKey) {
            const names = {
                taps: '500 marta tap qiling',
                level: 'Level 5 ga yeting',
                level3: 'Level 3 ga yeting',
                level7: 'Level 7 ga yeting',
                level10: 'Level 10 ga yeting',
                coins: '10000 coin to\'plang',
                referral: '5 ta do\'st taklif qiling',
                referral1: 'Birinchi do\'stni taklif qiling',
                referral3: '3 ta do\'st taklif qiling',
                referral10: '10 ta do\'st taklif qiling',
                telegram: 'Telegram kanalga obuna bo\'ling',
                youtube: 'YouTube kanalga obuna bo\'ling',
                code: 'Maxsus kodni kiriting'
            };
            return names[taskKey] || taskKey;
        }

        function getTaskReward(taskKey) {
            const rewards = {
                taps: 1000,
                level: 2000,
                level3: 800,
                level7: 4000,
                level10: 8000,
                coins: 5000,
                referral: 3000,
                referral1: 500,
                referral3: 1500,
                referral10: 6000,
                telegram: 1500,
                youtube: 2000,
                code: 5000
            };
            return rewards[taskKey] || 0;
        }

        function showEditTaskModal() {
            if (customTasks.length === 0) {
                showNotification('‚ùå Tahrirlanadigan vazifa yo\'q!', 'error');
                return;
            }
            
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('[data-modal="editTask"]');
            existingModals.forEach(modal => modal.remove());
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'editTask');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            const tasksList = customTasks.map(task => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: bold; color: #00ff88;">${task.name}</div>
                        <div style="font-size: 12px; color: #ccc;">${task.reward} DRC ‚Ä¢ ${task.type} ‚Ä¢ ${task.dateAdded}</div>
                    </div>
                    <button onclick="editCustomTask('${task.id}')" style="background: #00ff88; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Tahrirlash</button>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; border: 2px solid rgba(0,255,136,0.3); box-shadow: 0 0 50px rgba(0,255,136,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #00ff88; margin: 0;">‚úèÔ∏è Vazifalarni Tahrirlash</h3>
                        <button onclick="closeEditTaskModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${tasksList}
                    </div>
                    
                    <button onclick="closeEditTaskModal()" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; margin-top: 15px;">Yopish</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditTaskModal();
                }
            });
        }

        function closeEditTaskModal() {
            const modal = document.querySelector('[data-modal="editTask"]');
            if (modal) {
                modal.remove();
            }
        }

        function editCustomTask(taskId) {
            const task = customTasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Close current modal
            closeEditTaskModal();
            
            const modal = document.createElement('div');
            modal.setAttribute('data-modal', 'editTaskForm');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2001; backdrop-filter: blur(10px);
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(10,10,15,0.95); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; border: 2px solid rgba(0,255,136,0.3); box-shadow: 0 0 50px rgba(0,255,136,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #00ff88; margin: 0;">‚úèÔ∏è Vazifani Tahrirlash</h3>
                        <button onclick="closeEditTaskFormModal()" style="background: none; border: none; color: #ff6b35; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa turi:</label>
                        <select id="editTaskType" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                            <option value="telegram" ${task.type === 'telegram' ? 'selected' : ''}>üì± Telegram kanalga obuna</option>
                            <option value="youtube" ${task.type === 'youtube' ? 'selected' : ''}>üì∫ YouTube kanalga obuna</option>
                            <option value="code" ${task.type === 'code' ? 'selected' : ''}>üîê Maxsus kod kiritish</option>
                            <option value="website" ${task.type === 'website' ? 'selected' : ''}>üåê Websitega tashrif</option>
                            <option value="social" ${task.type === 'social' ? 'selected' : ''}>üì≤ Ijtimoiy tarmoq</option>
                            <option value="level" ${task.type === 'level' ? 'selected' : ''}>üèÜ Level vazifasi</option>
                            <option value="referral" ${task.type === 'referral' ? 'selected' : ''}>üë• Referral vazifasi</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Vazifa nomi:</label>
                        <input type="text" id="editTaskName" value="${task.name}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Tavsif:</label>
                        <input type="text" id="editTaskDesc" value="${task.description || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editLinkSection" style="margin-bottom: 15px; display: ${['telegram', 'youtube', 'website', 'social'].includes(task.type) ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Link/Kanal nomi:</label>
                        <input type="text" id="editTaskLink" value="${task.link || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Mukofot (DRC):</label>
                        <input type="number" id="editTaskReward" value="${task.reward}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editCodeSection" style="margin-bottom: 15px; display: ${task.type === 'code' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">To'g'ri kod:</label>
                        <input type="text" id="editTaskCode" value="${task.code || ''}" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editLevelSection" style="margin-bottom: 15px; display: ${task.type === 'level' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli level:</label>
                        <input type="number" id="editTaskLevel" value="${task.level || ''}" min="1" max="50" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div id="editReferralSection" style="margin-bottom: 15px; display: ${task.type === 'referral' ? 'block' : 'none'};">
                        <label style="display: block; color: #ccc; margin-bottom: 5px;">Kerakli referral soni:</label>
                        <input type="number" id="editTaskReferralCount" value="${task.referralCount || ''}" min="1" max="100" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff;">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="closeEditTaskFormModal()" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer;">Bekor qilish</button>
                        <button onclick="saveEditedTask('${taskId}')" style="flex: 1; background: linear-gradient(45deg, #00ff88, #00cc6a); border: none; color: #000; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Saqlash</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show/hide sections based on task type
            document.getElementById('editTaskType').addEventListener('change', function() {
                const codeSection = document.getElementById('editCodeSection');
                const levelSection = document.getElementById('editLevelSection');
                const referralSection = document.getElementById('editReferralSection');
                const linkSection = document.getElementById('editLinkSection');
                
                // Hide all sections first
                codeSection.style.display = 'none';
                levelSection.style.display = 'none';
                referralSection.style.display = 'none';
                linkSection.style.display = 'block';
                
                // Show relevant section
                if (this.value === 'code') {
                    codeSection.style.display = 'block';
                } else if (this.value === 'level') {
                    levelSection.style.display = 'block';
                    linkSection.style.display = 'none';
                } else if (this.value === 'referral') {
                    referralSection.style.display = 'block';
                    linkSection.style.display = 'none';
                }
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditTaskFormModal();
                }
            });
        }

        function closeEditTaskFormModal() {
            const modal = document.querySelector('[data-modal="editTaskForm"]');
            if (modal) {
                modal.remove();
            }
        }

        // YANGI: Improved saveEditedTask function with better Firebase sync
        function saveEditedTask(taskId) {
            const taskType = document.getElementById('editTaskType').value;
            const taskName = document.getElementById('editTaskName').value;
            const taskDesc = document.getElementById('editTaskDesc').value;
            const taskLink = document.getElementById('editTaskLink') ? document.getElementById('editTaskLink').value : '';
            const taskReward = parseInt(document.getElementById('editTaskReward').value);
            const taskCode = document.getElementById('editTaskCode') ? document.getElementById('editTaskCode').value : '';
            const taskLevel = document.getElementById('editTaskLevel') ? parseInt(document.getElementById('editTaskLevel').value) : null;
            const taskReferralCount = document.getElementById('editTaskReferralCount') ? parseInt(document.getElementById('editTaskReferralCount').value) : null;
            
            if (!taskName || !taskReward || isNaN(taskReward)) {
                showNotification('‚ùå Barcha maydonlarni to\'ldiring!', 'error');
                return;
            }
            
            // Additional validation for level and referral tasks
            if (taskType === 'level' && (!taskLevel || isNaN(taskLevel) || taskLevel < 1)) {
                showNotification('‚ùå Level raqamini to\'g\'ri kiriting!', 'error');
                return;
            }
            
            if (taskType === 'referral' && (!taskReferralCount || isNaN(taskReferralCount) || taskReferralCount < 1)) {
                showNotification('‚ùå Referral sonini to\'g\'ri kiriting!', 'error');
                return;
            }
            
            const taskIndex = customTasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                console.log('‚úèÔ∏è Maxsus vazifa tahrirlanmoqda:', taskId);
                
                customTasks[taskIndex] = {
                    ...customTasks[taskIndex],
                    type: taskType,
                    name: taskName,
                    description: taskDesc,
                    link: taskLink,
                    reward: taskReward,
                    code: taskCode,
                    level: taskLevel,
                    referralCount: taskReferralCount,
                    lastEdited: new Date().toLocaleDateString(),
                    editedBy: getUniquePlayerId()
                };
                
                localStorage.setItem('dragonCoinCustomTasks', JSON.stringify(customTasks));
                
                // Close modal first
                closeEditTaskFormModal();
                
                // Save to Firebase
                const saveSuccess = saveGlobalTaskSettings();
                
                if (saveSuccess !== false) {
                    showNotification(`‚úÖ "${taskName}" vazifasi barcha o'yinchilar uchun tahrirlandi!`, 'success');
                    
                    // Force sync
                    setTimeout(() => {
                        if (firebaseConnected) {
                            checkForGlobalTaskUpdates();
                            showNotification('üåê O\'zgarish barcha o\'yinchilarga yuborildi!', 'success');
                        }
                    }, 500);
                } else {
                    showNotification(`‚úÖ "${taskName}" vazifasi tahrirlandi! (Faqat mahalliy)`, 'success');
                }
                
                // Update display immediately
                updateTasksDisplay();
                
                // Show notification about category change if applicable
                const categoryName = getCategoryName(taskType);
                setTimeout(() => {
                    showNotification(`üìç Vazifa "${categoryName}" bo'limiga ko'chirildi!`, 'success');
                }, 2000);
            }
        }

        // Progressive boost system
        const boostLevels = {
            tapPower: [
                { level: 2, value: 2, cost: 1000, description: '+1 coin per tap' },
                { level: 3, value: 3, cost: 2500, description: '+2 coins per tap' },
                { level: 5, value: 5, cost: 6000, description: '+4 coins per tap' },
                { level: 10, value: 10, cost: 15000, description: '+9 coins per tap' }
            ],
            energy: [
                { level: 2, value: 1500, cost: 1500, description: '1,500 max energy' },
                { level: 3, value: 2500, cost: 3500, description: '2,500 max energy' },
                { level: 5, value: 5000, cost: 8500, description: '5,000 max energy' }
            ],
            multitap: [
                { level: 2, value: 2, cost: 2000, description: '+1 tap per click' },
                { level: 3, value: 3, cost: 5000, description: '+2 taps per click' },
                { level: 5, value: 5, cost: 12000, description: '+4 taps per click' }
            ],
            recharge: [
                { level: 2, value: 3000, cost: 3000, description: '+1 energy per 3 seconds' },
                { level: 3, value: 2000, cost: 7500, description: '+1 energy per 2 seconds' },
                { level: 5, value: 1000, cost: 18000, description: '+1 energy per 1 second' }
            ]
        };

        function getNextBoostLevel(boostType) {
            const levels = boostLevels[boostType];
            const currentLevel = gameState.boosts[boostType === 'energy' ? 'maxEnergy' : boostType];
            
            for (let boost of levels) {
                if (boostType === 'tapPower' && boost.value > currentLevel) return boost;
                if (boostType === 'energy' && boost.value > currentLevel) return boost;
                if (boostType === 'multitap' && boost.value > currentLevel) return boost;
                if (boostType === 'recharge' && boost.value < gameState.rechargeSpeed) return boost;
            }
            return null; // Max level reached
        }

        function buyCurrentTapPowerBoost() {
            const nextBoost = getNextBoostLevel('tapPower');
            if (!nextBoost) {
                showNotification('‚úÖ Tap Power maksimal darajada!', 'success');
                return;
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification('‚ùå Yetarli coin yo\'q!', 'error');
                return;
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.tapPower = nextBoost.value;
            gameState.tapPower = nextBoost.value;
            
            showNotification(`‚úÖ Tap Power Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentEnergyBoost() {
            const nextBoost = getNextBoostLevel('energy');
            if (!nextBoost) {
                showNotification('‚úÖ Energy maksimal darajada!', 'success');
                return;
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification('‚ùå Yetarli coin yo\'q!', 'error');
                return;
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.maxEnergy = nextBoost.value;
            gameState.maxEnergy = nextBoost.value;
            gameState.energy = nextBoost.value; // Fill energy when upgrading
            
            showNotification(`‚úÖ Max Energy Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentMultitapBoost() {
            const nextBoost = getNextBoostLevel('multitap');
            if (!nextBoost) {
                showNotification('‚úÖ Multitap maksimal darajada!', 'success');
                return;
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification('‚ùå Yetarli coin yo\'q!', 'error');
                return;
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.boosts.multitap = nextBoost.value;
            gameState.multitap = nextBoost.value;
            
            showNotification(`‚úÖ Multitap Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function buyCurrentRechargeBoost() {
            const nextBoost = getNextBoostLevel('recharge');
            if (!nextBoost) {
                showNotification('‚úÖ Energy Recharge maksimal darajada!', 'success');
                return;
            }
            
            if (gameState.balance < nextBoost.cost) {
                showNotification('‚ùå Yetarli coin yo\'q!', 'error');
                return;
            }
            
            gameState.balance -= nextBoost.cost;
            gameState.rechargeSpeed = nextBoost.value;
            gameState.boosts.rechargeSpeed = nextBoost.value;
            
            showNotification(`‚úÖ Energy Recharge Level ${nextBoost.level} ga oshirildi!`, 'success');
            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        // Special boosts (unchanged)
        function buyBoost(boostType, value, cost) {
            // Check if player has enough coins
            if (gameState.balance < cost) {
                showNotification('‚ùå Yetarli coin yo\'q!', 'error');
                return;
            }

            switch (boostType) {
                case 'energyRefill':
                    gameState.balance -= cost;
                    gameState.energy = gameState.maxEnergy;
                    showNotification('‚úÖ Energiya to\'ldirildi!', 'success');
                    break;

                case 'turbo':
                    gameState.balance -= cost;
                    gameState.activeBoosts.turbo = {
                        active: true,
                        endTime: Date.now() + (20 * 1000) // 20 seconds
                    };
                    showNotification('‚úÖ Turbo 20 soniyaga faollashtirildi!', 'success');
                    break;
            }

            updateUI();
            updateBoostDisplay();
            saveGameState();
        }

        function updateBoostDisplay() {
            // Update current boost status
            document.getElementById('currentTapPower').textContent = gameState.boosts.tapPower;
            document.getElementById('currentMaxEnergy').textContent = gameState.boosts.maxEnergy;
            document.getElementById('currentMultitap').textContent = gameState.boosts.multitap;

            // Update progressive boost displays
            updateProgressiveBoostDisplay('tapPower', 'tapPowerBoostCurrent');
            updateProgressiveBoostDisplay('energy', 'energyBoostCurrent');
            updateProgressiveBoostDisplay('multitap', 'multitapBoostCurrent');
            updateProgressiveBoostDisplay('recharge', 'rechargeBoostCurrent');

            // Update active boosts
            updateActiveBoosts();
        }

        function updateProgressiveBoostDisplay(boostType, elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const nextBoost = getNextBoostLevel(boostType);
            
            if (!nextBoost) {
                // Max level reached
                element.innerHTML = `
                    <div class="condition-text">
                        <div style="font-weight: bold; color: #00ff88;">‚úÖ ${getBoostTitle(boostType)} - MAX LEVEL</div>
                        <div style="font-size: 12px; color: #ccc;">Maksimal darajaga yetildi</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="color: #00ff88; font-weight: bold;">MAX</div>
                        <div class="condition-status condition-completed"></div>
                    </div>
                `;
                element.classList.add('completed');
                element.onclick = null;
            } else {
                // Show next level
                const canAfford = gameState.balance >= nextBoost.cost;
                element.innerHTML = `
                    <div class="condition-text">
                        <div style="font-weight: bold;">${getBoostEmoji(boostType, nextBoost.level)} ${getBoostTitle(boostType)} Level ${nextBoost.level}</div>
                        <div style="font-size: 12px; color: #ccc;">${nextBoost.description}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="condition-reward" style="color: ${canAfford ? '#00ff88' : '#ff6b35'}">${nextBoost.cost.toLocaleString()} DRC</div>
                        <div class="condition-status ${canAfford ? 'condition-completed' : 'condition-pending'}"></div>
                    </div>
                `;
                element.classList.remove('completed');
                if (canAfford) {
                    element.classList.add('task-ready');
                } else {
                    element.classList.remove('task-ready');
                }
            }
        }

        function getBoostTitle(boostType) {
            switch (boostType) {
                case 'tapPower': return 'Tap Power';
                case 'energy': return 'Energy Limit';
                case 'multitap': return 'Multitap';
                case 'recharge': return 'Energy Recharge';
                default: return 'Boost';
            }
        }

        function getBoostEmoji(boostType, level) {
            const emojis = {
                tapPower: '‚ö°',
                energy: 'üîã',
                multitap: 'üëÜ',
                recharge: '‚ö°'
            };
            return emojis[boostType].repeat(Math.min(level - 1, 3));
        }

        function updateActiveBoosts() {
            const activeBoostsSection = document.getElementById('activeBoostsSection');
            const activeBoostsList = document.getElementById('activeBoostsList');
            
            const activeBoosts = [];
            const now = Date.now();
            
            // Check turbo
            if (gameState.activeBoosts.turbo.active && gameState.activeBoosts.turbo.endTime > now) {
                const timeLeft = Math.ceil((gameState.activeBoosts.turbo.endTime - now) / 1000);
                activeBoosts.push({
                    name: 'üöÄ Turbo',
                    timeLeft: `${timeLeft} soniya qoldi`
                });
            } else if (gameState.activeBoosts.turbo.active) {
                gameState.activeBoosts.turbo.active = false;
            }
            
            if (activeBoosts.length > 0) {
                activeBoostsSection.style.display = 'block';
                activeBoostsList.innerHTML = activeBoosts.map(boost => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0, 255, 136, 0.05); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(0, 255, 136, 0.2);">
                        <div style="font-weight: bold; value: #00ff88;">${boost.name}</div>
                        <div style="color: #ccc; font-size: 12px;">${boost.timeLeft}</div>
                    </div>
                `).join('');
            } else {
                activeBoostsSection.style.display = 'none';
            }
        }

        // Start the game when page loads
        window.addEventListener('load', initGame);
        
        // Save before page unload
        window.addEventListener('beforeunload', saveGameState);
    </script>
<script type="module" src="/dragon-coin/main.js"></script>
    <body>
  <!-- üîπ Navigatsiya tugmalari -->
  <div class="tabs">
    <button id="tab-tap">Tap</button>
    <button id="tab-leaderboard">Leaderboard</button>
    <button id="tab-admin">Admin</button>
  </div>

  <!-- üîπ Tap bo‚Äòlimi -->
  <div id="tapSection" class="section">
    <button id="tapButton">üêâ Tap</button>
  </div>

  <!-- üîπ Reyting bo‚Äòlimi -->
  <div id="leaderboardSection" class="section" style="display:none;">
    <button id="btn-leaderboard-coins">Coins Leaderboard</button>
    <button id="btn-leaderboard-referrals">Referrals Leaderboard</button>
    <div id="leaderboardList"></div>
  </div>

  <!-- üîπ Admin bo‚Äòlimi -->
  <div id="adminSection" class="section" style="display:none;">
    <button data-action="addCoins">Add Coins</button>
    <button data-action="resetPlayer">Reset Player</button>
    <button data-action="addTask">Add Task</button>
    <button data-action="removeTask">Remove Task</button>
    <button data-action="editTask">Edit Task</button>
    <button data-action="viewTasks">View Tasks</button>
  </div>

  <!-- üîπ Custom vazifalar ro‚Äòyxati -->
  <div id="customTasksList"></div>

  <!-- üîπ JavaScript ulanish -->
  <script type="module" src="/dragon-coin/main.js"></script>
</body>
</html>
